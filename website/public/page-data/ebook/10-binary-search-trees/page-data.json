{"componentChunkName":"component---src-templates-ebook-page-js","path":"/ebook/10-binary-search-trees/","webpackCompilationHash":"8913fc5500708dd393f4","result":{"data":{"site":{"siteMetadata":{"title":"Another C Library"}},"markdownRemark":{"id":"7084dd2c-2755-5268-918d-c3af4aea7e6d","html":"<p>Copyright 2019 Andy Curtis &#x26; Daniel Curtis</p>\n<h1 id=\"binary-search-trees\"><a href=\"#binary-search-trees\" aria-label=\"binary search trees permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Binary Search Trees</h1>\n<h2 id=\"the-basic-structure\"><a href=\"#the-basic-structure\" aria-label=\"the basic structure permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The basic structure</h2>\n<p>A binary search tree is similar to a linked list in that nodes are linked together.  The difference is that each node has two children.  The children are generally understood as being left and right, where the left is less than the given node, and the right is greater.  Trees in computer science generally grow from a root down (unlike trees in nature which grow up from the root).  This is likely because in a binary search tree, the root is considered the top of the tree.  In binary search trees, each child node is aware of its parent node. In the following example, B is aware of D as a parent, A as a left child, and C as a right child.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">                D\n              /   \\\n             B     H\n            / \\   / \\\n           A   C G   I\n                /\n               E\n                 \\\n                   F     </code></pre></div>\n<p>In the example above, the root is D, and the left of D is B, right is H.  Each node refers to up to three other nodes.  For example, the B node refers to D, A, and C.  D is B's parent.  A is B's left child and C is B's right child.  Before continuing too much with theory, we will build out a binary search tree.  Just like before, the only files that will be changed are doubly<em>linked</em>list.c will be renamed binary<em>search</em>tree.c, and the Makefile will have DATA<em>STRUCTURE defined as binary</em>search_tree.  The binary search tree is much simpler than the red-black tree, but it isn't entirely without complexity.</p>\n<p>The code that follows can be found in illustrations/10<em>binary</em>search<em>trees/1</em>binary<em>search</em>tree</p>\n<p>First, let's define the structure of the node.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">node_s</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">node_s</span> <span class=\"token operator\">*</span>parent<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">node_s</span> <span class=\"token operator\">*</span>left<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">node_s</span> <span class=\"token operator\">*</span>right<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">char</span> key<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> node_t<span class=\"token punctuation\">;</span></code></pre></div>\n<p>For a binary search tree, instead of thinking in next and previous, we think in terms of two children and a parent.  The children are considered left and right.  We could name the nodes left<em>child and right</em>child, and that would indeed be a more precise name.  However, left and right have become common names of the left and right children, so we will use left and right.   A linked list can be sorted if the insert method inserts the node in the right place to maintain a sorted list.  It doesn't have to be, and indeed, it frequently is not sorted.  The binary search tree is sorted.  In a binary search tree, the root might not be the first element in the list of nodes (if you are considering sort order).  In the example above, D is the root, but A would be the first node in the sorted set.  Linked lists always maintain that the root node is the first node in the list.  In a binary search tree, the root node is rarely the first node within the sorted set.  It only happens when the root is the leftmost node in the tree.</p>\n<p>A binary search tree can be empty, much like a linked list can be empty.  If it is empty, it doesn't have any nodes.  Just like a linked list, where you need to create a reference to some part of the list (typically the beginning), you need to maintain a link to the root of the tree.  This is just a pointer to the current root node, which can change depending upon your tree operations.  Initializing the root node to NULL indicates that the tree is empty.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">node_t <span class=\"token operator\">*</span>root <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>To build the tree, we will need functionality to insert new nodes.  For now, we will assume that our tree maintains unique keys (no duplicate letters).  In a binary search tree insert method, you first find the place where the node would go, and then if it doesn't already exist, you add the node.  It is often a good idea to search for the node before inserting.  This will eliminate the need to create and destroy the node needlessly if it already existed.  It also is easier to understand the find method, so it comes next.</p>\n<h1 id=\"find\"><a href=\"#find\" aria-label=\"find permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Find</h1>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">node_t <span class=\"token operator\">*</span><span class=\"token function\">node_find</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> key<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span>root<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key <span class=\"token operator\">&lt;</span> root<span class=\"token operator\">-></span>key<span class=\"token punctuation\">)</span>\n      root <span class=\"token operator\">=</span> root<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key <span class=\"token operator\">></span> root<span class=\"token operator\">-></span>key<span class=\"token punctuation\">)</span>\n      root <span class=\"token operator\">=</span> root<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">else</span>\n      <span class=\"token keyword\">return</span> root<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>You may notice in the code above that the root is no longer the root once it is assigned to its left or right node.  In a binary search tree, you can call the find method with any node in the tree, and it will search that node and all of its children.  This fact generally isn't useful, but it is good to understand it as you think about how binary search trees work.  The node_find method above can be converted to a recursive function.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">node_t <span class=\"token operator\">*</span><span class=\"token function\">node_find</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> key<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span>root<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key <span class=\"token operator\">&lt;</span> root<span class=\"token operator\">-></span>key<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">node_find</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> root<span class=\"token operator\">-></span>left<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key <span class=\"token operator\">></span> root<span class=\"token operator\">-></span>key<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">node_find</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> root<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">else</span>\n    <span class=\"token keyword\">return</span> root<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The recursive method requires less code but is less efficient as the recursion requires more stack manipulation.  Recursive functions are extremely powerful, but when they can be represented as a non-recursive method that is more efficient, it is usually best to use the non-recursive method.</p>\n<h1 id=\"insert\"><a href=\"#insert\" aria-label=\"insert permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Insert</h1>\n<p>The node_insert method will require a pointer to the root pointer so that it can potentially modify what the root is. Insert works much like find, except that it needs to find the spot where the new node can fit.  To find that spot, the parent of that spot must be saved and the actual spot itself.  Because the spot where the new node can fit will be NULL, you can use the parent pointer from a given node.  Once a place is found, the node to insert's parent is to set to the saved parent, the left and right pointers are set to NULL, and the spot is set to reference the node.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdbool.h></span></span>\n\nbool <span class=\"token function\">node_insert</span><span class=\"token punctuation\">(</span>node_t <span class=\"token operator\">*</span>node_to_insert<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span><span class=\"token operator\">*</span>root<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  node_t <span class=\"token operator\">*</span><span class=\"token operator\">*</span>n <span class=\"token operator\">=</span> root<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>parent <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    parent <span class=\"token operator\">=</span> <span class=\"token operator\">*</span>n<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node_to_insert<span class=\"token operator\">-></span>key <span class=\"token operator\">&lt;</span> parent<span class=\"token operator\">-></span>key<span class=\"token punctuation\">)</span>\n      n <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span><span class=\"token punctuation\">(</span>parent<span class=\"token operator\">-></span>left<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node_to_insert<span class=\"token operator\">-></span>key <span class=\"token operator\">></span> parent<span class=\"token operator\">-></span>key<span class=\"token punctuation\">)</span>\n      n <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span><span class=\"token punctuation\">(</span>parent<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">else</span>\n      <span class=\"token keyword\">return</span> false<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  node_to_insert<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">;</span>\n  node_to_insert<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> node_to_insert<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n  <span class=\"token operator\">*</span>n <span class=\"token operator\">=</span> node_to_insert<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> true<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"first-last-next-previous\"><a href=\"#first-last-next-previous\" aria-label=\"first last next previous permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>First, Last, Next, Previous</h2>\n<p>Before getting to erasing nodes, I'm going to cover basic iteration.  Iteration is needed to solve one case of erasing nodes, so we will cover iteration first.</p>\n<p>To find the first node in a tree, you simply traverse all of the left pointers until there are no more.  </p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">node_t <span class=\"token operator\">*</span><span class=\"token function\">node_first</span><span class=\"token punctuation\">(</span>node_t <span class=\"token operator\">*</span>n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>n<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>n<span class=\"token operator\">-></span>left<span class=\"token punctuation\">)</span>\n    n <span class=\"token operator\">=</span> n<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> n<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Similarly, to find the last node in a tree, you traverse all of the right pointers until there are no more.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">node_t <span class=\"token operator\">*</span><span class=\"token function\">node_last</span><span class=\"token punctuation\">(</span>node_t <span class=\"token operator\">*</span>n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>n<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>n<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span>\n    n <span class=\"token operator\">=</span> n<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> n<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>To find the next node, consider if the current node has a right node.  If it does, then find the leftmost node from the right node.  Otherwise, find the first parent where the child is on the left.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">node_t <span class=\"token operator\">*</span><span class=\"token function\">node_next</span><span class=\"token punctuation\">(</span>node_t <span class=\"token operator\">*</span>n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>n<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    n <span class=\"token operator\">=</span> n<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>n<span class=\"token operator\">-></span>left<span class=\"token punctuation\">)</span>\n      n <span class=\"token operator\">=</span> n<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>n<span class=\"token operator\">-></span>parent <span class=\"token operator\">&amp;&amp;</span> n<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>right <span class=\"token operator\">==</span> n<span class=\"token punctuation\">)</span>\n    n <span class=\"token operator\">=</span> n<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> n<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>To find the previous node, swap left and right from node_next.  Also, note that previous is supported.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">bool <span class=\"token function\">node_previous_supported</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> true<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\nnode_t <span class=\"token operator\">*</span><span class=\"token function\">node_previous</span><span class=\"token punctuation\">(</span>node_t <span class=\"token operator\">*</span>n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>n<span class=\"token operator\">-></span>left<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    n <span class=\"token operator\">=</span> n<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>n<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span>\n      n <span class=\"token operator\">=</span> n<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>n<span class=\"token operator\">-></span>parent <span class=\"token operator\">&amp;&amp;</span> n<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">==</span> n<span class=\"token punctuation\">)</span>\n    n <span class=\"token operator\">=</span> n<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> n<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"erase\"><a href=\"#erase\" aria-label=\"erase permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Erase</h2>\n<p>Erasing nodes is a bit more complicated than insertion because the tree may need to be shuffled a bit for nodes that have children.  Consider our example from before:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">                D\n              /   \\\n             B     H\n            / \\   / \\\n           A   C G   I\n                /\n               E\n                 \\\n                   F     </code></pre></div>\n<p>It is erasing leaf nodes (nodes without any children are easy).  A, C, F, and I can be erased by simply removing the link from their parent to them.  Erasing nodes that have only one child are relatively simple.  You just replace the child.  To erase E, you would replace E with F.  Replacing nodes with two children isn't too difficult.  Consider removing H.  If you replaced H with I, the tree would still be intact.  Replacing D is a bit more challenging as H has two children, and if you replaced D with H, how could H point to B, I, and G.  It isn't that big of a problem.  If you reconsider what happened when replacing H with I, you might discover that you were replacing H with the next in order value (which would be I).  If we look for the next in order value after D, you would see that it is E.  E has a child F, so F will first take E's place.  Next, E can take D's place.  The rules are:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1.  If a node is a leaf, unlink it from its parent\n2.  If a node only has one child, replace the node with the child\n3.  If a node has two children, find the next inorder node and unlink it first\n    using rules 1 and 2.  Next, replace the node with the node that was just\n    unlinked.</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">bool <span class=\"token function\">node_erase</span><span class=\"token punctuation\">(</span>node_t <span class=\"token operator\">*</span>node_to_erase<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span><span class=\"token operator\">*</span>root<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>left<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// case 3</span>\n      node_t <span class=\"token operator\">*</span>next <span class=\"token operator\">=</span> <span class=\"token function\">node_next</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">node_erase</span><span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">==</span> node_to_erase<span class=\"token punctuation\">)</span>\n          node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> next<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">else</span>\n          node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> next<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">else</span>\n        <span class=\"token operator\">*</span>root <span class=\"token operator\">=</span> next<span class=\"token punctuation\">;</span>\n\n      next<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n      next<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span>\n      next<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>\n      next<span class=\"token operator\">-></span>left<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> next<span class=\"token punctuation\">;</span>\n      next<span class=\"token operator\">-></span>right<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> next<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// case 2</span>\n      node_to_erase<span class=\"token operator\">-></span>left<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">==</span> node_to_erase<span class=\"token punctuation\">)</span>\n          node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">else</span>\n          node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">else</span>\n        <span class=\"token operator\">*</span>root <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span>           \n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// case 2</span>\n    node_to_erase<span class=\"token operator\">-></span>right<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">==</span> node_to_erase<span class=\"token punctuation\">)</span>\n        node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">else</span>\n        node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span>\n      <span class=\"token operator\">*</span>root <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>     \n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// case 1</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">==</span> node_to_erase<span class=\"token punctuation\">)</span>\n        node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">else</span>\n        node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span>\n      <span class=\"token operator\">*</span>root <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>    \n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> true<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The above code could be improved.  First, there is some repeated code.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">==</span> node_to_erase<span class=\"token punctuation\">)</span>\n    node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">else</span>\n    node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span>\n  <span class=\"token operator\">*</span>root <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>and</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">==</span> node_to_erase<span class=\"token punctuation\">)</span>\n    node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">else</span>\n    node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span>\n  <span class=\"token operator\">*</span>root <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>     </code></pre></div>\n<p>and</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">node_to_erase<span class=\"token operator\">-></span>left<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">==</span> node_to_erase<span class=\"token punctuation\">)</span>\n    node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">else</span>\n    node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span>\n  <span class=\"token operator\">*</span>root <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span></code></pre></div>\n<p>and</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">==</span> node_to_erase<span class=\"token punctuation\">)</span>\n    node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> next<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">else</span>\n    node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> next<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span>\n  <span class=\"token operator\">*</span>root <span class=\"token operator\">=</span> next<span class=\"token punctuation\">;</span>\n\nnext<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span></code></pre></div>\n<p>are very similar. The only difference is whether NULL, node<em>to</em>erase->right, node<em>to</em>erase->left, and next get's assigned.</p>\n<p>The following function could simplify the code.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">static</span> <span class=\"token keyword\">inline</span> <span class=\"token keyword\">void</span> <span class=\"token function\">replace_node_with_child</span><span class=\"token punctuation\">(</span>node_t <span class=\"token operator\">*</span>child<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span>node<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span><span class=\"token operator\">*</span>root <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  node_t <span class=\"token operator\">*</span>parent <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">==</span> node<span class=\"token punctuation\">)</span>\n      parent<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> child<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">else</span>\n      parent<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> child<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">else</span>\n    <span class=\"token operator\">*</span>root <span class=\"token operator\">=</span> child<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>child<span class=\"token punctuation\">)</span>\n    child<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The new node_erase would look like</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">bool <span class=\"token function\">node_erase</span><span class=\"token punctuation\">(</span>node_t <span class=\"token operator\">*</span>node_to_erase<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span><span class=\"token operator\">*</span>root<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>left<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// case 3</span>\n      node_t <span class=\"token operator\">*</span>next <span class=\"token operator\">=</span> <span class=\"token function\">node_next</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">node_erase</span><span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">replace_node_with_child</span><span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">,</span> node_to_erase<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      next<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span>\n      next<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>\n      next<span class=\"token operator\">-></span>left<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> next<span class=\"token punctuation\">;</span>\n      next<span class=\"token operator\">-></span>right<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> next<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span>\n      <span class=\"token function\">replace_node_with_child</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>left<span class=\"token punctuation\">,</span> node_to_erase<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">replace_node_with_child</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token operator\">-></span>right<span class=\"token punctuation\">,</span> node_to_erase<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">else</span>\n    <span class=\"token function\">replace_node_with_child</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> node_to_erase<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> true<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>A tiny optimization can be made by not allowing NULL to be passed in as the child.  We can avoid the if(child) check-in replace<em>node</em>with_child.  </p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">static</span> <span class=\"token keyword\">inline</span> <span class=\"token keyword\">void</span> <span class=\"token function\">replace_node_with_child</span><span class=\"token punctuation\">(</span>node_t <span class=\"token operator\">*</span>child<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span>node<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span><span class=\"token operator\">*</span>root <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  node_t <span class=\"token operator\">*</span>parent <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">==</span> node<span class=\"token punctuation\">)</span>\n      parent<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> child<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">else</span>\n      parent<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> child<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">else</span>\n    <span class=\"token operator\">*</span>root <span class=\"token operator\">=</span> child<span class=\"token punctuation\">;</span>\n\n  child<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>that means that</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">else</span>\n  <span class=\"token function\">replace_node_with_child</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> node_to_erase<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>gets replaced with</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  node_t <span class=\"token operator\">*</span>parent <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">==</span> node<span class=\"token punctuation\">)</span>\n      parent<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">else</span>\n      parent<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">else</span>\n    <span class=\"token operator\">*</span>root <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Recursion isn't always a bad thing, but it can make code harder to follow.  The remaining code in the node_erase method is:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">node_t <span class=\"token operator\">*</span>next <span class=\"token operator\">=</span> <span class=\"token function\">node_next</span><span class=\"token punctuation\">(</span>node_to_erase<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">node_erase</span><span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">replace_node_with_child</span><span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">,</span> node_to_erase<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nnext<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span>\nnext<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> node_to_erase<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>\nnext<span class=\"token operator\">-></span>left<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> next<span class=\"token punctuation\">;</span>\nnext<span class=\"token operator\">-></span>right<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> next<span class=\"token punctuation\">;</span></code></pre></div>\n<p>How many times will node<em>erase be called?  Due to how the successor works, it will be exactly one time (because it will be an only child if node</em>to_erase isn't considered).  I've flipped the cases so that the easy cases are first.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">bool <span class=\"token function\">node_erase</span><span class=\"token punctuation\">(</span>node_t <span class=\"token operator\">*</span>node<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span><span class=\"token operator\">*</span>root<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>node<span class=\"token operator\">-></span>left<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* node has one right child */</span>\n      <span class=\"token function\">replace_node_with_child</span><span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>right<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* node has no children, unlink from parent */</span>\n      node_t <span class=\"token operator\">*</span>parent <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">==</span> node<span class=\"token punctuation\">)</span>\n          parent<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">else</span>\n          parent<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* no children, no parent, tree is now empty */</span>\n        <span class=\"token operator\">*</span>root <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>node<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* node has one left child */</span>\n    <span class=\"token function\">replace_node_with_child</span><span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>left<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">,</span> root <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* node has left and right child */</span>\n    <span class=\"token comment\">// remaining code...</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> true<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The remaining code will find the successor (or the next inorder node).</p>\n<ol>\n<li>If the successor is to the right of the node<em>to</em>erase, then alter the successor's parent to be the same as the node and link successor's left to the node's left.</li>\n<li>Otherwise, the successor will be to the left of the node<em>to</em>erase's right node. Link the successor's parent's left to the successor's right child.  If the successor's right child is not NULL, link it to the successor's parent.  Fully replace the node<em>to</em>erase with the successor.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">node_t <span class=\"token operator\">*</span>successor <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>successor<span class=\"token operator\">-></span>left<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* successor is to the right of node */</span>\n  <span class=\"token function\">replace_node_with_child</span><span class=\"token punctuation\">(</span>successor<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  successor<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span>\n  successor<span class=\"token operator\">-></span>left<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> successor<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>successor<span class=\"token operator\">-></span>left<span class=\"token punctuation\">)</span>\n    successor <span class=\"token operator\">=</span> successor<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span>\n\n  successor<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> successor<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>successor<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span>\n    successor<span class=\"token operator\">-></span>right<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> successor<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* replace node with successor */</span>\n  <span class=\"token function\">replace_node_with_child</span><span class=\"token punctuation\">(</span>successor<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  successor<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span>\n  successor<span class=\"token operator\">-></span>left<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> successor<span class=\"token punctuation\">;</span>\n  successor<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>\n  successor<span class=\"token operator\">-></span>right<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> successor<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The final node_erase looks like</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">static</span> <span class=\"token keyword\">inline</span> <span class=\"token keyword\">void</span> <span class=\"token function\">replace_node_with_child</span><span class=\"token punctuation\">(</span>node_t <span class=\"token operator\">*</span>child<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span>node<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span><span class=\"token operator\">*</span>root <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  node_t <span class=\"token operator\">*</span>parent <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">==</span> node<span class=\"token punctuation\">)</span>\n      parent<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> child<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">else</span>\n      parent<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> child<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">else</span>\n    <span class=\"token operator\">*</span>root <span class=\"token operator\">=</span> child<span class=\"token punctuation\">;</span>\n\n  child<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nbool <span class=\"token function\">node_erase</span><span class=\"token punctuation\">(</span>node_t <span class=\"token operator\">*</span>node<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span><span class=\"token operator\">*</span>root<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>node<span class=\"token operator\">-></span>left<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* node has one right child */</span>\n      <span class=\"token function\">replace_node_with_child</span><span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>right<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* node has no children, unlink from parent */</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        node_t <span class=\"token operator\">*</span>parent <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">==</span> node<span class=\"token punctuation\">)</span>\n          parent<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">else</span>\n          parent<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* no children, no parent, tree is now empty */</span>\n        <span class=\"token operator\">*</span>root <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>node<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* node has one left child */</span>\n    <span class=\"token function\">replace_node_with_child</span><span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>left<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">,</span> root <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* node has left and right child */</span>\n    node_t <span class=\"token operator\">*</span>successor <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>successor<span class=\"token operator\">-></span>left<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* successor is to the right of node */</span>\n      <span class=\"token function\">replace_node_with_child</span><span class=\"token punctuation\">(</span>successor<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      successor<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span>\n      successor<span class=\"token operator\">-></span>left<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> successor<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>successor<span class=\"token operator\">-></span>left<span class=\"token punctuation\">)</span>\n        successor <span class=\"token operator\">=</span> successor<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span>\n\n      successor<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> successor<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>successor<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span>\n        successor<span class=\"token operator\">-></span>right<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> successor<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">/* replace node with successor */</span>\n      <span class=\"token function\">replace_node_with_child</span><span class=\"token punctuation\">(</span>successor<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      successor<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span>\n      successor<span class=\"token operator\">-></span>left<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> successor<span class=\"token punctuation\">;</span>\n      successor<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>\n      successor<span class=\"token operator\">-></span>right<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> successor<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> true<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"postorder-iteration\"><a href=\"#postorder-iteration\" aria-label=\"postorder iteration permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Postorder iteration</h2>\n<p>Postorder iteration means to iterate through a tree visiting the left and the right nodes before each root.  Postorder starts from the left deepest node of the tree and then iterates through children before parents.  Given the following example, the iteration will look like.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">        D9\n     /      \\\n    B3       H8\n  /   \\    /   \\\n A1    C2 G6     I7\n         /\n        E5\n          \\\n           F4</code></pre></div>\n<p>or</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ACBEGFD</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Start with the left deepest node, which is A.\nSince A is the left child of B, look for the left deepest node under C which is C\nSince C is the right child of B, B is next\nSince D is the left child of B, look for the left deepest node under H which is F\nSince F is the right child of E, E is next\nSince G is the left child of G and there isn&#39;t a right child, G is next\nSince G is the left child of H, look for the left deepest node under I which is I\nSince I is the right child of H, H is next\nSince H is the right child of D, D is next\nSince D has no parent, we are done</code></pre></div>\n<p>The left deepest node is where you always choose a child if it exists, preferring the left child over the right.  Because this is an internal function, it is safe to assume that (n) will not be NULL.  The function is made static because it is only used within the c file and inline for potential performance.  For example, F is the left deepest node of H.  If a node has no children, that node is returned.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">static</span> <span class=\"token keyword\">inline</span> node_t <span class=\"token operator\">*</span><span class=\"token function\">left_deepest_node</span><span class=\"token punctuation\">(</span>node_t <span class=\"token operator\">*</span>n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">-></span>left<span class=\"token punctuation\">)</span>\n      n <span class=\"token operator\">=</span> n<span class=\"token operator\">-></span>left<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span>\n      n <span class=\"token operator\">=</span> n<span class=\"token operator\">-></span>right<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">else</span>\n      <span class=\"token keyword\">return</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In explaining the traversal above, 4 patterns exist.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1.  Start with left deepest node\n2.  If node is a left child of parent and there is a right child, look for the\n    left deepest node under right child, otherwise use parent.\n3.  If node is right child, use parent\n4.  If node has no parent, we are done</code></pre></div>\n<p>Statements 2-4 are used for finding next nodes in postorder iteration.  Statement 3 and statement 4 are the same in as much as every node has a parent; it just may be that the parent is NULL.  The otherwise element of statement 2 also returns the parent.  The first part of statement 2 is the only case where something other than the parent is returned.  Given this, we can state the following about find next nodes in postorder iteration.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">If node&#39;s parent is not NULL and the node is a left child of its parent and\nthere is a right child, return the left deepest node of the right child of the\nnode&#39;s parent, otherwise return the node&#39;s parent.</code></pre></div>\n<p>If a tree is destroyed using postorder iteration, all of the children are destroyed before parents, so the tree remains intact throughout the destruction.  The node<em>first</em>to<em>erase (or first in postorder iteration) calls the left</em>deepest_node method above if n is not NULL.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">node_t <span class=\"token operator\">*</span><span class=\"token function\">node_first_to_erase</span><span class=\"token punctuation\">(</span>node_t <span class=\"token operator\">*</span>n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>n<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">left_deepest_node</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The node<em>next</em>to_erase (or next in postorder iteration) uses our statement above.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">node_t <span class=\"token operator\">*</span><span class=\"token function\">node_next_to_erase</span><span class=\"token punctuation\">(</span>node_t <span class=\"token operator\">*</span>n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  node_t <span class=\"token operator\">*</span>parent <span class=\"token operator\">=</span> n<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>parent <span class=\"token operator\">&amp;&amp;</span> n <span class=\"token operator\">==</span> parent<span class=\"token operator\">-></span>left <span class=\"token operator\">&amp;&amp;</span> parent<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">left_deepest_node</span><span class=\"token punctuation\">(</span>parent<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">else</span>\n    <span class=\"token keyword\">return</span> parent<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"printing-a-binary-tree\"><a href=\"#printing-a-binary-tree\" aria-label=\"printing a binary tree permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Printing a binary tree</h2>\n<p>The last function to build is a method to print the tree.  It presented a different kind of challenge that programmers often face and so I'm separating it.  To print the binary search tree, I've implemented an approach that requires copying the tree into a different structure. Because we have built the ac<em>allocator and the ac</em>pool, I've decided to use them.  To demonstrate how they can be useful, I've commented out the free and ac<em>pool</em>destroy calls.  Before getting into how to print, let's review the changes to test<em>data</em>structure.c and data_structure.h.</p>\n<p>data<em>structure.h includes \"ac</em>pool.h\"</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ac_pool.h\"</span></span></code></pre></div>\n<p>and node<em>print takes a pointer to ac</em>pool_t *pool</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token function\">node_print</span><span class=\"token punctuation\">(</span>node_t <span class=\"token operator\">*</span>root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>becomes</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token function\">node_print</span><span class=\"token punctuation\">(</span>ac_pool_t <span class=\"token operator\">*</span>pool<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span>root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The test<em>data</em>structure.c needs to incorporate the pool.</p>\n<p>In the main function, the pool needs initialized and destroyed.  Also, the free call gets changed to ac_free.  I've commented the free and destroy call on purpose.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">ac_pool_t <span class=\"token operator\">*</span>pool <span class=\"token operator\">=</span> <span class=\"token function\">ac_pool_init</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>arg <span class=\"token operator\">=</span> <span class=\"token function\">get_valid_characters</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">test_data_structure</span><span class=\"token punctuation\">(</span>pool<span class=\"token punctuation\">,</span> arg<span class=\"token punctuation\">,</span> repeat<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ac_free(arg);</span>\n<span class=\"token comment\">// ac_pool_destroy(pool);</span></code></pre></div>\n<p>get<em>valid</em>characters has a call to strdup which changes from</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>res <span class=\"token operator\">=</span> <span class=\"token function\">strdup</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>to</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>res <span class=\"token operator\">=</span> <span class=\"token function\">ac_strdup</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The test<em>data</em>structure definition changes from</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token function\">test_data_structure</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>arg<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> repeat<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></code></pre></div>\n<p>to</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token function\">test_data_structure</span><span class=\"token punctuation\">(</span>ac_pool_t <span class=\"token operator\">*</span>pool<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>arg<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> repeat<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></code></pre></div>\n<p>All of the calls to node_print now take the pool parameter.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token function\">node_print</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>becomes</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token function\">node_print</span><span class=\"token punctuation\">(</span>pool<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The Makefile also includes the src library to incorporate the ac_pool object.</p>\n<p>The following code is found in <i>illustrations/10<em>binary</em>search<em>trees/1</em>binary<em>search</em>tree</i></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> <span class=\"token variable\">$ac</span>/illustrations/10_binary_search_trees/1_binary_search_tree</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">make</span>\ngcc -g -O3 -I<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src -D_AC_DEBUG_MEMORY_<span class=\"token operator\">=</span>NULL <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_timer.c <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_allocator.c <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_buffer.c <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_pool.c test_data_structure.c binary_search_tree.c -o test_data_structure -DDATA_STRUCTURE<span class=\"token operator\">=</span><span class=\"token punctuation\">\\</span>\"binary_search_tree<span class=\"token punctuation\">\\</span>\"\nCreating binary_search_tree <span class=\"token keyword\">for</span> PDCBAEMLOQTRYZ\nP1\n<span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token operator\">|</span>  Q2\n<span class=\"token operator\">|</span>    <span class=\"token punctuation\">\\</span>\nD2    T3\n<span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>   <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\nC3 <span class=\"token operator\">|</span>  R4 Y4\n<span class=\"token operator\">|</span>  <span class=\"token operator\">|</span>       <span class=\"token punctuation\">\\</span>\nB4 E3       Z5\n<span class=\"token operator\">|</span>    <span class=\"token punctuation\">\\</span>        \nA5    M4\n      <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n      L5 O5\n\nprint_using_iteration: ABCDELMOPQRTYZ\nprint_using_reverse_iteration: ZYTRQPOMLEDCBA\n\n<span class=\"token number\">2527</span> byte<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> allocated <span class=\"token keyword\">in</span> <span class=\"token number\">17</span> allocations <span class=\"token punctuation\">(</span><span class=\"token number\">680</span> byte<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> overhead<span class=\"token punctuation\">)</span>\ntest_data_structure.c:244 <span class=\"token punctuation\">[</span>ac_pool<span class=\"token punctuation\">]</span> size: <span class=\"token number\">1050</span>, max_size: <span class=\"token number\">1050</span>, initial_size: <span class=\"token number\">1024</span> used: <span class=\"token number\">2152</span>\ntest_data_structure.c:204: <span class=\"token number\">15</span>\nbinary_search_tree.c:14: <span class=\"token number\">32</span>\nbinary_search_tree.c:14: <span class=\"token number\">32</span>\nbinary_search_tree.c:14: <span class=\"token number\">32</span>\nbinary_search_tree.c:14: <span class=\"token number\">32</span>\nbinary_search_tree.c:14: <span class=\"token number\">32</span>\nbinary_search_tree.c:14: <span class=\"token number\">32</span>\nbinary_search_tree.c:14: <span class=\"token number\">32</span>\nbinary_search_tree.c:14: <span class=\"token number\">32</span>\nbinary_search_tree.c:14: <span class=\"token number\">32</span>\nbinary_search_tree.c:14: <span class=\"token number\">32</span>\nbinary_search_tree.c:14: <span class=\"token number\">32</span>\nbinary_search_tree.c:14: <span class=\"token number\">32</span>\nbinary_search_tree.c:14: <span class=\"token number\">32</span>\nbinary_search_tree.c:14: <span class=\"token number\">32</span>\n<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_pool.c:121: <span class=\"token number\">1040</span></code></pre></div>\n<p>Notice that just before the program ended, that it printed 17 lines where allocations happened.  These are allocations that were not properly freed.  Let's check out the lines around 14 of binary<em>search</em>tree.c.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">node_t <span class=\"token operator\">*</span><span class=\"token function\">node_init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  node_t <span class=\"token operator\">*</span>n <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>node_t <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">ac_malloc</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>node_t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  n<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> n<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> n<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n  n<span class=\"token operator\">-></span>key <span class=\"token operator\">=</span> key<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> n<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">node_destroy</span><span class=\"token punctuation\">(</span>node_t <span class=\"token operator\">*</span>n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ac_free(n);</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Notice that the ac_free is commented out.  Let's uncomment it and run make again.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">make</span>\ngcc -g -O3 -I<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src -D_AC_DEBUG_MEMORY_<span class=\"token operator\">=</span>NULL <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_timer.c <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_allocator.c <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_buffer.c <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_pool.c test_data_structure.c binary_search_tree.c -o test_data_structure -DDATA_STRUCTURE<span class=\"token operator\">=</span><span class=\"token punctuation\">\\</span>\"binary_search_tree<span class=\"token punctuation\">\\</span>\"\nCreating binary_search_tree <span class=\"token keyword\">for</span> PDCBAEMLOQTRYZ\nP1\n<span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token operator\">|</span>  Q2\n<span class=\"token operator\">|</span>    <span class=\"token punctuation\">\\</span>\nD2    T3\n<span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>   <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\nC3 <span class=\"token operator\">|</span>  R4 Y4\n<span class=\"token operator\">|</span>  <span class=\"token operator\">|</span>       <span class=\"token punctuation\">\\</span>\nB4 E3       Z5\n<span class=\"token operator\">|</span>    <span class=\"token punctuation\">\\</span>        \nA5    M4\n      <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n      L5 O5\n\nprint_using_iteration: ABCDELMOPQRTYZ\nprint_using_reverse_iteration: ZYTRQPOMLEDCBA\n\n<span class=\"token number\">2079</span> byte<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> allocated <span class=\"token keyword\">in</span> <span class=\"token number\">3</span> allocations <span class=\"token punctuation\">(</span><span class=\"token number\">120</span> byte<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> overhead<span class=\"token punctuation\">)</span>\ntest_data_structure.c:244 <span class=\"token punctuation\">[</span>ac_pool<span class=\"token punctuation\">]</span> size: <span class=\"token number\">1050</span>, max_size: <span class=\"token number\">1050</span>, initial_size: <span class=\"token number\">1024</span> used: <span class=\"token number\">2152</span>\ntest_data_structure.c:204: <span class=\"token number\">15</span>\n<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_pool.c:121: <span class=\"token number\">1040</span></code></pre></div>\n<p>There are three lines left.  Let's consider the second one (test<em>data</em>structure.c:204).  The lines around 204 of test<em>data</em>structure.c are below.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token function\">get_valid_characters</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>res <span class=\"token operator\">=</span> <span class=\"token function\">ac_strdup</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>wp <span class=\"token operator\">=</span> res<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Line 204 is a ac<em>strdup call that ultimately gets returned from get</em>valid<em>characters.  If we look for the get</em>valid<em>characters call, we find it in the main function.  The arg is not freed (ac</em>free is commented out).  </p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">ac_pool_t <span class=\"token operator\">*</span>pool <span class=\"token operator\">=</span> <span class=\"token function\">ac_pool_init</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>arg <span class=\"token operator\">=</span> <span class=\"token function\">get_valid_characters</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">test_data_structure</span><span class=\"token punctuation\">(</span>pool<span class=\"token punctuation\">,</span> arg<span class=\"token punctuation\">,</span> repeat<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ac_free(arg);</span>\n<span class=\"token comment\">// ac_pool_destroy(pool);</span>\n<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Let's uncomment the ac_free(arg); line and run again.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">make</span>\ngcc -g -O3 -I<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src -D_AC_DEBUG_MEMORY_<span class=\"token operator\">=</span>NULL <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_timer.c <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_allocator.c <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_buffer.c <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_pool.c test_data_structure.c binary_search_tree.c -o test_data_structure -DDATA_STRUCTURE<span class=\"token operator\">=</span><span class=\"token punctuation\">\\</span>\"binary_search_tree<span class=\"token punctuation\">\\</span>\"\nCreating binary_search_tree <span class=\"token keyword\">for</span> PDCBAEMLOQTRYZ\nP1\n<span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token operator\">|</span>  Q2\n<span class=\"token operator\">|</span>    <span class=\"token punctuation\">\\</span>\nD2    T3\n<span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>   <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\nC3 <span class=\"token operator\">|</span>  R4 Y4\n<span class=\"token operator\">|</span>  <span class=\"token operator\">|</span>       <span class=\"token punctuation\">\\</span>\nB4 E3       Z5\n<span class=\"token operator\">|</span>    <span class=\"token punctuation\">\\</span>        \nA5    M4\n      <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n      L5 O5\n\nprint_using_iteration: ABCDELMOPQRTYZ\nprint_using_reverse_iteration: ZYTRQPOMLEDCBA\n\n<span class=\"token number\">2064</span> byte<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> allocated <span class=\"token keyword\">in</span> <span class=\"token number\">2</span> allocations <span class=\"token punctuation\">(</span><span class=\"token number\">80</span> byte<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> overhead<span class=\"token punctuation\">)</span>\ntest_data_structure.c:244 <span class=\"token punctuation\">[</span>ac_pool<span class=\"token punctuation\">]</span> size: <span class=\"token number\">1050</span>, max_size: <span class=\"token number\">1050</span>, initial_size: <span class=\"token number\">1024</span> used: <span class=\"token number\">2152</span>\n<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_pool.c:121: <span class=\"token number\">1040</span></code></pre></div>\n<p>The test<em>data</em>structure program allows us to print multiple binary search trees if we pass a third argument, which is the number of random trees to print (in addition to the one that is in order at the end).</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ ./test_data_structure PDCBAEMLOQTRYZ <span class=\"token number\">2</span>\nCreating binary_search_tree <span class=\"token keyword\">for</span> PDCBAEMLOQTRYZ\nL1\n<span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token operator\">|</span>  Q2\n<span class=\"token operator\">|</span>  <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token operator\">|</span>  <span class=\"token operator\">|</span>  R3\n<span class=\"token operator\">|</span>  <span class=\"token operator\">|</span>    <span class=\"token punctuation\">\\</span>\n<span class=\"token operator\">|</span>  M3    T4\n<span class=\"token operator\">|</span>    <span class=\"token punctuation\">\\</span>     <span class=\"token punctuation\">\\</span>\nC2    O4    Z5\n<span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>     <span class=\"token punctuation\">\\</span>   <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  D3    P5 Y6\n<span class=\"token operator\">|</span>    <span class=\"token punctuation\">\\</span>        \nA3    E4\n  <span class=\"token punctuation\">\\</span>     \n   B4\n\nQ1\n<span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token operator\">|</span>  R2\n<span class=\"token operator\">|</span>    <span class=\"token punctuation\">\\</span>\nB2    Y3\n<span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>   <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\nA3 <span class=\"token operator\">|</span>  T4 Z4\n   <span class=\"token operator\">|</span>       \n   M3\n   <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n   <span class=\"token operator\">|</span>  P4\n   <span class=\"token operator\">|</span>  <span class=\"token operator\">|</span>\n   <span class=\"token operator\">|</span>  O5\n   <span class=\"token operator\">|</span>    \n   C4\n     <span class=\"token punctuation\">\\</span>\n      D5\n        <span class=\"token punctuation\">\\</span>\n         E6\n           <span class=\"token punctuation\">\\</span>\n            L7\n\nP1\n<span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token operator\">|</span>  Q2\n<span class=\"token operator\">|</span>    <span class=\"token punctuation\">\\</span>\nD2    T3\n<span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>   <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\nC3 <span class=\"token operator\">|</span>  R4 Y4\n<span class=\"token operator\">|</span>  <span class=\"token operator\">|</span>       <span class=\"token punctuation\">\\</span>\nB4 E3       Z5\n<span class=\"token operator\">|</span>    <span class=\"token punctuation\">\\</span>        \nA5    M4\n      <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n      L5 O5\n\nprint_using_iteration: ABCDELMOPQRTYZ\nprint_using_reverse_iteration: ZYTRQPOMLEDCBA\n\n<span class=\"token number\">4144</span> byte<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> allocated <span class=\"token keyword\">in</span> <span class=\"token number\">4</span> allocations <span class=\"token punctuation\">(</span><span class=\"token number\">160</span> byte<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> overhead<span class=\"token punctuation\">)</span>\ntest_data_structure.c:244 <span class=\"token punctuation\">[</span>ac_pool<span class=\"token punctuation\">]</span> size: <span class=\"token number\">3150</span>, max_size: <span class=\"token number\">3150</span>, initial_size: <span class=\"token number\">1024</span> used: <span class=\"token number\">4232</span>\n<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_pool.c:121: <span class=\"token number\">1040</span>\n<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_pool.c:121: <span class=\"token number\">1040</span>\n<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_pool.c:121: <span class=\"token number\">1040</span></code></pre></div>\n<p>Notice that since we printed 3 trees, the total bytes allocated increased to 4140 bytes.  Let's review the test<em>data</em>structure function for a moment.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">void test_data_structure<span class=\"token punctuation\">(</span>ac_pool_t *pool, const char *arg, int repeat<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  printf<span class=\"token punctuation\">(</span><span class=\"token string\">\"Creating %s for %s<span class=\"token entity\" title=\"\\n\">\\n</span>\"</span>, DATA_STRUCTURE, arg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  node_t *root<span class=\"token punctuation\">;</span>\n  for<span class=\"token punctuation\">(</span> int <span class=\"token assign-left variable\">i</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span>repeat<span class=\"token punctuation\">;</span> i++ <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    // ac_pool_clear<span class=\"token punctuation\">(</span>pool<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    root <span class=\"token operator\">=</span> fill_data_structure_randomly<span class=\"token punctuation\">(</span>arg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    node_print<span class=\"token punctuation\">(</span>pool, root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    find_everything<span class=\"token punctuation\">(</span>arg, root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    find_and_erase_everything<span class=\"token punctuation\">(</span>arg, root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  // ac_pool_clear<span class=\"token punctuation\">(</span>pool<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  root <span class=\"token operator\">=</span> fill_data_structure<span class=\"token punctuation\">(</span>arg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  node_print<span class=\"token punctuation\">(</span>pool, root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  print_using_iteration<span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node_previous_supported<span class=\"token punctuation\">(</span><span class=\"token punctuation\">))</span>\n    print_using_reverse_iteration<span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  destroy_using_iteration<span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  printf<span class=\"token punctuation\">(</span><span class=\"token string\">\"<span class=\"token entity\" title=\"\\n\">\\n</span>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>For each call of node<em>print, the pool uses more memory.  However, we can clear the pool just after each print since the pool is only used for allocation within the node</em>print call.  More specifically, we can clear the pool at the beginning of the for loop to repeat building, printing, and destroying the tree, and just before we recreate the tree one last time.  If you uncomment the ac<em>pool</em>clear calls, you can go ahead and rebuild.</p>\n<p>Rebuild</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">make</span></code></pre></div>\n<p>and run again</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ ./test_data_structure PDCBAEMLOQTRYZ <span class=\"token number\">2</span>\n<span class=\"token builtin class-name\">.</span>\n<span class=\"token builtin class-name\">.</span>\n<span class=\"token builtin class-name\">.</span>\n<span class=\"token number\">2064</span> byte<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> allocated <span class=\"token keyword\">in</span> <span class=\"token number\">2</span> allocations <span class=\"token punctuation\">(</span><span class=\"token number\">80</span> byte<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> overhead<span class=\"token punctuation\">)</span>\ntest_data_structure.c:246 <span class=\"token punctuation\">[</span>ac_pool<span class=\"token punctuation\">]</span> size: <span class=\"token number\">1050</span>, max_size: <span class=\"token number\">1050</span>, initial_size: <span class=\"token number\">1024</span> used: <span class=\"token number\">2064</span>\n<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_pool.c:121: <span class=\"token number\">1040</span></code></pre></div>\n<p>You should see that the memory usage didn't grow this time.  If we uncomment the ac<em>pool</em>destroy call in the main function, we will see the following output.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">make</span>\ngcc -g -O3 -I<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src -D_AC_DEBUG_MEMORY_<span class=\"token operator\">=</span>NULL <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_timer.c <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_allocator.c <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_buffer.c <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_pool.c test_data_structure.c binary_search_tree.c -o test_data_structure -DDATA_STRUCTURE<span class=\"token operator\">=</span><span class=\"token punctuation\">\\</span>\"binary_search_tree<span class=\"token punctuation\">\\</span>\"\nCreating binary_search_tree <span class=\"token keyword\">for</span> PDCBAEMLOQTRYZ\nP1\n<span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token operator\">|</span>  Q2\n<span class=\"token operator\">|</span>    <span class=\"token punctuation\">\\</span>\nD2    T3\n<span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>   <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\nC3 <span class=\"token operator\">|</span>  R4 Y4\n<span class=\"token operator\">|</span>  <span class=\"token operator\">|</span>       <span class=\"token punctuation\">\\</span>\nB4 E3       Z5\n<span class=\"token operator\">|</span>    <span class=\"token punctuation\">\\</span>        \nA5    M4\n      <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n      L5 O5\n\nprint_using_iteration: ABCDELMOPQRTYZ\nprint_using_reverse_iteration: ZYTRQPOMLEDCBA</code></pre></div>\n<p>There are no longer any memory leaks, and the pool is being used efficiently.  It's worth noting that sometimes it is useful to comment out the destroy call to see how the pool is performing.</p>\n<p>Before moving on, it is worth looking at how unbalanced binary search trees can become.  The simplest way to do it is to put all of the keys in sequence.</p>\n<p>For example,</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ ./test_data_structure abcdefgh\nCreating binary_search_tree <span class=\"token keyword\">for</span> abcdefgh\na1\n  <span class=\"token punctuation\">\\</span>\n   b2\n     <span class=\"token punctuation\">\\</span>\n      c3\n        <span class=\"token punctuation\">\\</span>\n         d4\n           <span class=\"token punctuation\">\\</span>\n            e5\n              <span class=\"token punctuation\">\\</span>\n               f6\n                 <span class=\"token punctuation\">\\</span>\n                  g7\n                    <span class=\"token punctuation\">\\</span>\n                     h8\n\nprint_using_iteration: abcdefgh\nprint_using_reverse_iteration: hgfedcba</code></pre></div>\n<p>or</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ ./test_data_structure hgfedcba\nCreating binary_search_tree <span class=\"token keyword\">for</span> hgfedcba\nh1\n<span class=\"token operator\">|</span>\ng2\n<span class=\"token operator\">|</span>\nf3\n<span class=\"token operator\">|</span>\ne4\n<span class=\"token operator\">|</span>\nd5\n<span class=\"token operator\">|</span>\nc6\n<span class=\"token operator\">|</span>\nb7\n<span class=\"token operator\">|</span>\na8\n\nprint_using_iteration: abcdefgh\nprint_using_reverse_iteration: hgfedcba</code></pre></div>\n<p>To understand how to print a binary search tree, I've made a slight modification to the node printing function so that it can print the key a random number of times, followed by the depth.</p>\n<p>The code that follows can be found in illustrations/10<em>binary</em>search<em>trees/2</em>binary<em>search</em>tree</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> <span class=\"token variable\">$ac</span>/illustrations/10_binary_search_trees/2_binary_search_tree</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">make</span>\ngcc -g -O3 -I<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src -D_AC_DEBUG_MEMORY_<span class=\"token operator\">=</span>NULL <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_timer.c <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_allocator.c <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_buffer.c <span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/src/ac_pool.c test_data_structure.c binary_search_tree.c -o test_data_structure -DDATA_STRUCTURE<span class=\"token operator\">=</span><span class=\"token punctuation\">\\</span>\"binary_search_tree<span class=\"token punctuation\">\\</span>\"\nCreating binary_search_tree <span class=\"token keyword\">for</span> PDCBAEMLOQTRYZ\nPPPPPPPP1\n<span class=\"token operator\">|</span>        <span class=\"token punctuation\">\\</span>\nDDDDD2    QQQQQ2\n<span class=\"token operator\">|</span>     <span class=\"token punctuation\">\\</span>         <span class=\"token punctuation\">\\</span>\n<span class=\"token operator\">|</span>      EEE3      T3\n<span class=\"token operator\">|</span>          <span class=\"token punctuation\">\\</span>     <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\nCCCCCCCCC3  <span class=\"token operator\">|</span>    <span class=\"token operator\">|</span>  YYYYYYYYYYYYY4\n<span class=\"token operator\">|</span>           <span class=\"token operator\">|</span>    <span class=\"token operator\">|</span>                <span class=\"token punctuation\">\\</span>\nBBBBBBBBB4  <span class=\"token operator\">|</span>    RRRRRR4           ZZZ5\n<span class=\"token operator\">|</span>           <span class=\"token operator\">|</span>                          \n<span class=\"token operator\">|</span>           MMMMMMMMMM4\n<span class=\"token operator\">|</span>           <span class=\"token operator\">|</span>          <span class=\"token punctuation\">\\</span>\n<span class=\"token operator\">|</span>           LLLLLLLLL5  OOOOOOOOO5\n<span class=\"token operator\">|</span>                                 \nAAAAAAAAAAA5\n\nprint_using_iteration: ABCDELMOPQRTYZ\nprint_using_reverse_iteration: ZYTRQPOMLEDCBA</code></pre></div>\n<p>In the example above, AAAAAAAAAAA5 is pushed down until LLLLLLLLL5 is printed.  CCCCCCCCC3 is pushed down because it conflicts with EEE3.  RRRRRR4 is pushed down because it would conflict with YYYYYYYYYYYYY4.</p>\n<p>The way that I have designed the print function is to print the left nodes vertically below the first character of the key and the right nodes using a backslash spaced one character after the parent key.  The algorithm may not be the most optimal solution, but it does seem to work.  Technically, we don't need a print function to be able to use a binary search tree, but they are nice to visualize what is happening.  In addition to this, the solution is interesting and may lead to other solutions.</p>\n<ol>\n<li>Each node must have a position (horizontal), and that position will not change.  The node may only be pushed down.</li>\n<li>If a node conflicts with the next node on the same level (or a vertical bar), push the given node down.</li>\n<li>If a node has a right child, then add two bytes to conflict check</li>\n<li>Determine the length of each node at the beginning to simplify the computation.</li>\n</ol>\n<p>To solve this, the first thing I did is create a copy of the tree, which consists of the position of each node, the printed<em>key, the length of the printed</em>key, and the depth of the node from its parent (1 if directly beneath parent).  Because we are making a copy of the tree, we also need a parent, left, and right pointer.  I created several helper functions to make this work, which are all declared as static, so they don't conflict with the global namespace.</p>\n<p>The structure of the node looks like:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">node_print_item_s</span> <span class=\"token punctuation\">{</span>\n  size_t position<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>printed_key<span class=\"token punctuation\">;</span>\n  size_t length<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">int</span> depth<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">node_print_item_s</span> <span class=\"token operator\">*</span>parent<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">node_print_item_s</span> <span class=\"token operator\">*</span>left<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>right<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> node_print_item_t<span class=\"token punctuation\">;</span></code></pre></div>\n<p>The copy_tree function looks like</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">copy_tree</span><span class=\"token punctuation\">(</span>ac_pool_t <span class=\"token operator\">*</span>pool<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span>node<span class=\"token punctuation\">,</span>\n                      node_print_item_t <span class=\"token operator\">*</span><span class=\"token operator\">*</span>res<span class=\"token punctuation\">,</span> node_print_item_t <span class=\"token operator\">*</span>parent <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  node_print_item_t <span class=\"token operator\">*</span>copy <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>node_print_item_t <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">ac_pool_alloc</span><span class=\"token punctuation\">(</span>pool<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>node_print_item_t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token operator\">*</span>res <span class=\"token operator\">=</span> copy<span class=\"token punctuation\">;</span>\n\n  copy<span class=\"token operator\">-></span>printed_key <span class=\"token operator\">=</span> <span class=\"token function\">get_printed_key</span><span class=\"token punctuation\">(</span>pool<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  copy<span class=\"token operator\">-></span>length <span class=\"token operator\">=</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span>copy<span class=\"token operator\">-></span>printed_key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  copy<span class=\"token operator\">-></span>position <span class=\"token operator\">=</span> parent <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">==</span> copy<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> parent<span class=\"token operator\">-></span>position <span class=\"token operator\">:</span> parent<span class=\"token operator\">-></span>position <span class=\"token operator\">+</span> parent<span class=\"token operator\">-></span>length <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  copy<span class=\"token operator\">-></span>depth <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  copy<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n  copy<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n  copy<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>left<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">copy_tree</span><span class=\"token punctuation\">(</span>pool<span class=\"token punctuation\">,</span> node<span class=\"token operator\">-></span>left<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>copy<span class=\"token operator\">-></span>left<span class=\"token punctuation\">,</span> copy <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">copy_tree</span><span class=\"token punctuation\">(</span>pool<span class=\"token punctuation\">,</span> node<span class=\"token operator\">-></span>right<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>copy<span class=\"token operator\">-></span>right<span class=\"token punctuation\">,</span> copy <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I'm using the pool to allocate each node.  copy<em>tree is a recursive function that allocates nodes and puts them into the 3rd parameter.  The printed</em>key is printed using the following function.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">static</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token function\">get_printed_key</span><span class=\"token punctuation\">(</span>ac_pool_t <span class=\"token operator\">*</span>pool<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span>n <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// return ac_pool_strdupf(pool, \"%c%d\", n->key, get_depth(n));</span>\n\n  <span class=\"token keyword\">int</span> r<span class=\"token operator\">=</span><span class=\"token function\">rand</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">15</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>res <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">ac_pool_ualloc</span><span class=\"token punctuation\">(</span>pool<span class=\"token punctuation\">,</span> r<span class=\"token operator\">+</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;=</span>r<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span> <span class=\"token punctuation\">)</span>\n    res<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> n<span class=\"token operator\">-></span>key<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">sprintf</span><span class=\"token punctuation\">(</span>res<span class=\"token operator\">+</span>r<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"%d\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">get_depth</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The normal get<em>printed</em>key function would just use the ac<em>pool</em>strdupf function and print the character, followed by the depth.  The depth is calculated using the following function.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">get_depth</span><span class=\"token punctuation\">(</span>node_t <span class=\"token operator\">*</span>n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">int</span> depth <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    depth<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    n <span class=\"token operator\">=</span> n<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> depth<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>All that the depth function does is count how many parents a node has.  The rest of the get<em>printed</em>key method is below.  It prints the key from 1 to 15 times and then appends the depth to the key.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> r<span class=\"token operator\">=</span><span class=\"token function\">rand</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">15</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>res <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">ac_pool_ualloc</span><span class=\"token punctuation\">(</span>pool<span class=\"token punctuation\">,</span> r<span class=\"token operator\">+</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;=</span>r<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span> <span class=\"token punctuation\">)</span>\n  res<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> n<span class=\"token operator\">-></span>key<span class=\"token punctuation\">;</span>\n<span class=\"token function\">sprintf</span><span class=\"token punctuation\">(</span>res<span class=\"token operator\">+</span>r<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"%d\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">get_depth</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">return</span> res<span class=\"token punctuation\">;</span></code></pre></div>\n<p>copy->length is set by simply getting the length of the printed_key.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">copy<span class=\"token operator\">-></span>length <span class=\"token operator\">=</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span>copy<span class=\"token operator\">-></span>printed_key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol>\n<li>If the copy doesn't have a parent, then the position is 0 because it is the root node.</li>\n<li>If the copy has a parent and the copy is the left child, then the position is the same as the parent's position.</li>\n<li>\n<p>Otherwise, the copy is the right child of the parent, and the position is the parent's position plus its length + 1.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">copy<span class=\"token operator\">-></span>position <span class=\"token operator\">=</span> parent <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>parent<span class=\"token operator\">-></span>left <span class=\"token operator\">==</span> copy<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> parent<span class=\"token operator\">-></span>position <span class=\"token operator\">:</span> parent<span class=\"token operator\">-></span>position <span class=\"token operator\">+</span> parent<span class=\"token operator\">-></span>length <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ol>\n<p>Each node is initially a depth of 1 away from its parent.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">copy<span class=\"token operator\">-></span>depth <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The left and right pointers are initially NULL and the parent is set to the parent that is passed into the function.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">copy<span class=\"token operator\">-></span>left <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\ncopy<span class=\"token operator\">-></span>right <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\ncopy<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">;</span></code></pre></div>\n<p>If the node has a left, recurse to the left</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>left<span class=\"token punctuation\">)</span>\n  <span class=\"token function\">copy_tree</span><span class=\"token punctuation\">(</span>pool<span class=\"token punctuation\">,</span> node<span class=\"token operator\">-></span>left<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>copy<span class=\"token operator\">-></span>left<span class=\"token punctuation\">,</span> copy <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>If the node has a right, recurse to the right</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span>\n  <span class=\"token function\">copy_tree</span><span class=\"token punctuation\">(</span>pool<span class=\"token punctuation\">,</span> node<span class=\"token operator\">-></span>right<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>copy<span class=\"token operator\">-></span>right<span class=\"token punctuation\">,</span> copy <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The copy<em>tree method copies the node</em>t tree.  </p>\n<p>A few helper functions are needed to make the print work.  </p>\n<h2 id=\"finding-peers\"><a href=\"#finding-peers\" aria-label=\"finding peers permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Finding Peers</h2>\n<p>The first finds the first parent who is a left parent that also has a right node.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">   A\n    \\\n     D\n     |\\\n     B E\n      \\\n       C</code></pre></div>\n<p>In the above example, if C is the start node, then D would be the first node that is a left parent and that also has a right node (E).  In addition to finding the parent, the depth is summed up along the path to the parent node that is the left parent with a right child.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">static</span> node_print_item_t <span class=\"token operator\">*</span><span class=\"token function\">find_left_parent_with_right_child</span><span class=\"token punctuation\">(</span> node_print_item_t <span class=\"token operator\">*</span> item<span class=\"token punctuation\">,</span>\n                                                             <span class=\"token keyword\">int</span> <span class=\"token operator\">*</span>depth <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>item<span class=\"token operator\">-></span>parent <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>item<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>right <span class=\"token operator\">==</span> item <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>item<span class=\"token operator\">-></span>parent<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">*</span>depth <span class=\"token operator\">+=</span> item<span class=\"token operator\">-></span>depth<span class=\"token punctuation\">;</span>\n    item <span class=\"token operator\">=</span> item<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">*</span>depth <span class=\"token operator\">+=</span> item<span class=\"token operator\">-></span>depth<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> item<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The next function seeks to find the leftmost node at or deeper than a given depth.  This will seek from an item until the depth is less than or equal to the depth on the given node.  It recurses to the left first and only seeks to the right only if left doesn't exist.  If the path doesn't reach the given depth, the function returns NULL and through recursion, chooses another path unless none exists (at which point NULL is returned).</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">static</span> node_print_item_t <span class=\"token operator\">*</span><span class=\"token function\">find_left_most_at_depth</span><span class=\"token punctuation\">(</span> node_print_item_t <span class=\"token operator\">*</span> item<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> depth <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>item<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>depth <span class=\"token operator\">&lt;=</span> item<span class=\"token operator\">-></span>depth<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> item<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>item<span class=\"token operator\">-></span>left<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    node_print_item_t <span class=\"token operator\">*</span>r <span class=\"token operator\">=</span> <span class=\"token function\">find_left_most_at_depth</span><span class=\"token punctuation\">(</span>item<span class=\"token operator\">-></span>left<span class=\"token punctuation\">,</span> depth<span class=\"token operator\">-</span>item<span class=\"token operator\">-></span>depth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span> r<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>item<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    node_print_item_t <span class=\"token operator\">*</span>r <span class=\"token operator\">=</span> <span class=\"token function\">find_left_most_at_depth</span><span class=\"token punctuation\">(</span>item<span class=\"token operator\">-></span>right<span class=\"token punctuation\">,</span> depth<span class=\"token operator\">-</span>item<span class=\"token operator\">-></span>depth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span> r<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>To find the next peer, find the first left parent with a right child and check if there is a leftmost node at the same level.  If none exists, find the next left parent with a right child (of the current left parent with a right child) and repeat the check for the leftmost node at the same level.  Repeat until the root is reached (and NULL is returned) or until a leftmost node is found at the same level.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">static</span> node_print_item_t <span class=\"token operator\">*</span><span class=\"token function\">find_next_peer</span><span class=\"token punctuation\">(</span> node_print_item_t <span class=\"token operator\">*</span> item<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> depth <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    node_print_item_t <span class=\"token operator\">*</span>p <span class=\"token operator\">=</span> <span class=\"token function\">find_left_parent_with_right_child</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>depth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>p<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n    node_print_item_t <span class=\"token operator\">*</span>np <span class=\"token operator\">=</span> <span class=\"token function\">find_left_most_at_depth</span><span class=\"token punctuation\">(</span> p<span class=\"token operator\">-></span>right<span class=\"token punctuation\">,</span> depth <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span> np<span class=\"token punctuation\">;</span>\n    item <span class=\"token operator\">=</span> p<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Finally, get<em>node</em>depth sums the depth all the way to the root node</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">get_node_depth</span><span class=\"token punctuation\">(</span> node_print_item_t <span class=\"token operator\">*</span>item <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">int</span> r<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    r <span class=\"token operator\">+=</span> item<span class=\"token operator\">-></span>depth<span class=\"token punctuation\">;</span>\n    item <span class=\"token operator\">=</span> item<span class=\"token operator\">-></span>parent<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> r<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now we are ready to print the binary search tree.  Below is the node_print method, which will be followed by it being broken down.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token function\">node_print</span><span class=\"token punctuation\">(</span>ac_pool_t <span class=\"token operator\">*</span>pool<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span>root<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>root<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n  node_print_item_t <span class=\"token operator\">*</span>printable <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">copy_tree</span><span class=\"token punctuation\">(</span>pool<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>printable<span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  node_print_item_t <span class=\"token operator\">*</span>sn<span class=\"token punctuation\">,</span><span class=\"token operator\">*</span>n<span class=\"token punctuation\">,</span><span class=\"token operator\">*</span>n2<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">int</span> actual_depth<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">int</span> depth<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    sn <span class=\"token operator\">=</span> <span class=\"token function\">find_left_most_at_depth</span><span class=\"token punctuation\">(</span>printable<span class=\"token punctuation\">,</span> depth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sn<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> position <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    n <span class=\"token operator\">=</span> sn<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">;</span> position<span class=\"token operator\">&lt;</span>n<span class=\"token operator\">-></span>position<span class=\"token punctuation\">;</span> position<span class=\"token operator\">++</span> <span class=\"token punctuation\">)</span>\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      actual_depth<span class=\"token operator\">=</span><span class=\"token function\">get_node_depth</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>actual_depth <span class=\"token operator\">==</span> depth<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        n2 <span class=\"token operator\">=</span> <span class=\"token function\">find_next_peer</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> extra <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span>\n          extra <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>n2 <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>n<span class=\"token operator\">-></span>position<span class=\"token operator\">+</span>n<span class=\"token operator\">-></span>length<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token operator\">+</span>extra <span class=\"token operator\">></span> n2<span class=\"token operator\">-></span>position<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          n<span class=\"token operator\">-></span>depth<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n          <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"|\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          position<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\"</span><span class=\"token punctuation\">,</span> n<span class=\"token operator\">-></span>printed_key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          position <span class=\"token operator\">+=</span> n<span class=\"token operator\">-></span>length<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        n <span class=\"token operator\">=</span> n2<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        n <span class=\"token operator\">=</span> <span class=\"token function\">find_next_peer</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">,</span> depth<span class=\"token operator\">-</span>actual_depth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"|\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        position<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    position <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    n <span class=\"token operator\">=</span> sn<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">;</span> position<span class=\"token operator\">&lt;</span>n<span class=\"token operator\">-></span>position<span class=\"token punctuation\">;</span> position<span class=\"token operator\">++</span> <span class=\"token punctuation\">)</span>\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      actual_depth<span class=\"token operator\">=</span><span class=\"token function\">get_node_depth</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>actual_depth <span class=\"token operator\">==</span> depth<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">-></span>left<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"|\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          position<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">;</span> position<span class=\"token operator\">&lt;</span>n<span class=\"token operator\">-></span>position<span class=\"token operator\">+</span>n<span class=\"token operator\">-></span>length<span class=\"token punctuation\">;</span> position<span class=\"token operator\">++</span> <span class=\"token punctuation\">)</span>\n          <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"\\\\\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          position<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"|\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        position<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      n <span class=\"token operator\">=</span> <span class=\"token function\">find_next_peer</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">,</span> depth<span class=\"token operator\">-</span>actual_depth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    depth<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>If the root is NULL, there is nothing to print</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token function\">node_print</span><span class=\"token punctuation\">(</span>ac_pool_t <span class=\"token operator\">*</span>pool<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span>root<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>root<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The copy<em>tree expects the root of a tree and a pointer, which is initially pointing to NULL.  When copy</em>tree is complete, printable will be a complete replica of the tree referenced by root.  From this point forward, root will no longer be used.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">  node_print_item_t <span class=\"token operator\">*</span>printable <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">copy_tree</span><span class=\"token punctuation\">(</span>pool<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>printable<span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>A few variables are declared that will be needed during the process of printing the tree.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">node_print_item_t <span class=\"token operator\">*</span>sn<span class=\"token punctuation\">,</span><span class=\"token operator\">*</span>n<span class=\"token punctuation\">,</span><span class=\"token operator\">*</span>n2<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> actual_depth<span class=\"token punctuation\">;</span></code></pre></div>\n<p>At each level, there must be at one node that can be printed.  If there isn't a left most node at the given depth, we are done printing the tree.  The leftmost node might be deeper than the current depth.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> depth<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  sn <span class=\"token operator\">=</span> <span class=\"token function\">find_left_most_at_depth</span><span class=\"token punctuation\">(</span>printable<span class=\"token punctuation\">,</span> depth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sn<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n  depth<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>sn is the starting node.  Find all of the nodes that are on the same level and print the nodes and vertical bars (as necessary).</p>\n<ol>\n<li>print spaces until the position is equal to n->position</li>\n<li>get the actual depth of n (n might be below the current level)</li>\n<li>if the node is at the current depth\na. find the next peer at the same level.\nb. compute an extra length of 2 if there is a right child of n (one for the backslash and one for the vertical bar if the node needs to be pushed down).\nc. if there is a next peer and n's position + n's length + 1 + extra is greater than n2's position, push down the current node by increasing its depth and printing a vertical bar (and incrementing position because we wrote 1 byte).\nd. otherwise, print the key and add the length of the key to the position.\ne. set n to n2 (n2 may be NULL)</li>\n<li>otherwise, the node is deeper than the current depth, find the next peer, print the vertical bar, and increment position.  Note that when finding the next peer, the depth we are looking for needs to offset by the difference between the current depth and the actual depth of the node.</li>\n<li>\n<p>loop until n is NULL</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> position <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\nn <span class=\"token operator\">=</span> sn<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">;</span> position<span class=\"token operator\">&lt;</span>n<span class=\"token operator\">-></span>position<span class=\"token punctuation\">;</span> position<span class=\"token operator\">++</span> <span class=\"token punctuation\">)</span>\n<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nactual_depth<span class=\"token operator\">=</span><span class=\"token function\">get_node_depth</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>actual_depth <span class=\"token operator\">==</span> depth<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\nn2 <span class=\"token operator\">=</span> <span class=\"token function\">find_next_peer</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> extra <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span>\n  extra <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>n2 <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>n<span class=\"token operator\">-></span>position<span class=\"token operator\">+</span>n<span class=\"token operator\">-></span>length<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token operator\">+</span>extra <span class=\"token operator\">></span> n2<span class=\"token operator\">-></span>position<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  n<span class=\"token operator\">-></span>depth<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"|\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  position<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\"</span><span class=\"token punctuation\">,</span> n<span class=\"token operator\">-></span>printed_key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  position <span class=\"token operator\">+=</span> n<span class=\"token operator\">-></span>length<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\nn <span class=\"token operator\">=</span> n2<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\nn <span class=\"token operator\">=</span> <span class=\"token function\">find_next_peer</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">,</span> depth<span class=\"token operator\">-</span>actual_depth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"|\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nposition<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ol>\n<p>Restart the loop to print the left and right connection bars.  This is simpler because collisions have already been detected, and nodes have been pushed down.  For every character that is printed, position must be incremented.  If a node is at the actual depth, print the left vertical bar if needed, fill in spaces, and print the right backslash if needed.  If the node is below the actual level, simply print the vertical bar.  Finally, find the next peer at the level and repeat until no more peers exist.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">position <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\nn <span class=\"token operator\">=</span> sn<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">;</span> position<span class=\"token operator\">&lt;</span>n<span class=\"token operator\">-></span>position<span class=\"token punctuation\">;</span> position<span class=\"token operator\">++</span> <span class=\"token punctuation\">)</span>\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  actual_depth<span class=\"token operator\">=</span><span class=\"token function\">get_node_depth</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>actual_depth <span class=\"token operator\">==</span> depth<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">-></span>left<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"|\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      position<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">;</span> position<span class=\"token operator\">&lt;</span>n<span class=\"token operator\">-></span>position<span class=\"token operator\">+</span>n<span class=\"token operator\">-></span>length<span class=\"token punctuation\">;</span> position<span class=\"token operator\">++</span> <span class=\"token punctuation\">)</span>\n      <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">-></span>right<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"\\\\\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      position<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"|\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    position<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  n <span class=\"token operator\">=</span> <span class=\"token function\">find_next_peer</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">,</span> depth<span class=\"token operator\">-</span>actual_depth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>To finalize the work, we will remove the random number of prints in the get<em>printed</em>key function.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token function\">get_printed_key</span><span class=\"token punctuation\">(</span>ac_pool_t <span class=\"token operator\">*</span>pool<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span>n <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// return ac_pool_strdupf(pool, \"%c%d\", n->key, get_depth(n));</span>\n\n  <span class=\"token keyword\">int</span> r<span class=\"token operator\">=</span><span class=\"token function\">rand</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">15</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>res <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">ac_pool_ualloc</span><span class=\"token punctuation\">(</span>pool<span class=\"token punctuation\">,</span> r<span class=\"token operator\">+</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;=</span>r<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span> <span class=\"token punctuation\">)</span>\n    res<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> n<span class=\"token operator\">-></span>key<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">sprintf</span><span class=\"token punctuation\">(</span>res<span class=\"token operator\">+</span>r<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"%d\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">get_depth</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>becomes</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token function\">get_printed_key</span><span class=\"token punctuation\">(</span>ac_pool_t <span class=\"token operator\">*</span>pool<span class=\"token punctuation\">,</span> node_t <span class=\"token operator\">*</span>n <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">ac_pool_strdupf</span><span class=\"token punctuation\">(</span>pool<span class=\"token punctuation\">,</span> <span class=\"token string\">\"%c%d\"</span><span class=\"token punctuation\">,</span> n<span class=\"token operator\">-></span>key<span class=\"token punctuation\">,</span> <span class=\"token function\">get_depth</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><b>A quick note on how the ac<em>pool was useful:</b> The copy of the tree was constructed and never had to free any of the nodes associated with it.  Both nodes and the printed keys were allocated.  If we didn't have the pool (or something like it), we would have needed to free each node in the tree.  The node</em>init and node<em>destroy methods use ac</em>malloc and ac<em>free.  If we weren't concerned with destroying the tree or erasing nodes, we could have used the pool for the allocation and never had to erase the tree at all.  A call to ac</em>pool_clear would make the memory reusable for another purpose (such as building another tree).  Technically, it takes as long to construct a binary search tree as it does to destroy one.  If you use the pool, you can avoid all of the destruction time.  This will be explored further once the red-black tree (a balanced binary search tree is complete).</p>\n<h2 id=\"quick-recap\"><a href=\"#quick-recap\" aria-label=\"quick recap permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Quick Recap</h2>\n<ul>\n<li>To find the first node in a binary tree, find the leftmost node from the root.</li>\n<li>To find the last node, find the rightmost node from the root.</li>\n<li>To find the next node, consider if the current node has a right node.  If it does, then find the leftmost node from the right node.  Otherwise, find the first parent where the child is on the left.</li>\n<li>Finding the previous node is the same as finding the next node if you swap the words left and right in all places.</li>\n<li>To find a given node, recursively choose the left node if the given node is less than the current node (where the left node becomes the current node), the right node if the given node is greater than the current node (where the right node becomes the current node), and if the current node is equal to the given node, return the given node.  If a NULL leaf is reached, the given node doesn't exist in the tree.</li>\n<li>To insert a given node, find where the parent node where the given node should go (similar to find), and link the given node's parent to that parent.  Also, link the parent node's left or right child to the given node.</li>\n<li>Erasing a node is a bit more complex.  It involves finding the successor and replacing it (perhaps look back if you don't understand it).</li>\n<li>Printing a binary search tree is largely challenging because of the need to fit in a two-dimensional space.  It involves copying the binary tree into a print-friendly structure and pushing down nodes that don't fit.</li>\n<li>The pool can be useful for constructing nodes in a tree, especially if you don't want to worry about deconstructing the tree.</li>\n</ul>\n<h1 id=\"balancing-binary-search-trees\"><a href=\"#balancing-binary-search-trees\" aria-label=\"balancing binary search trees permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"11_balancing_binary_search_trees.md\">Balancing Binary Search Trees</a></h1>\n<p><a href=\"../README.md\">Table of Contents</a>  - Copyright 2019 Andy Curtis</p>","frontmatter":{"title":"10. Binary Search Trees","posttype":"ebook"}},"allMarkdownRemark":{"edges":[{"node":{"id":"5eb893ad-02cc-5749-b609-78f60bee9281","frontmatter":{"title":"1. Getting Started","path":"/1-getting-started"},"headings":[{"value":"A quick word about licensing"},{"value":"Getting Started"},{"value":"Timing Your Code (the first project)"}]}},{"node":{"id":"7084dd2c-2755-5268-918d-c3af4aea7e6d","frontmatter":{"title":"10. Binary Search Trees","path":"/10-binary-search-trees"},"headings":[{"value":"Binary Search Trees"},{"value":"Find"},{"value":"Insert"},{"value":"Balancing Binary Search Trees"}]}},{"node":{"id":"dceada54-0055-5815-9e8c-c4690446e7b3","frontmatter":{"title":"11. Balancing Binary Search Trees","path":"/11-balancing-binary-search-trees"},"headings":[{"value":"Balancing Binary Search Trees"},{"value":"The Red Black Tree"}]}},{"node":{"id":"4b274f94-d5cf-5356-9366-de54119f24ae","frontmatter":{"title":"12. The Red-Black Tree","path":"/12-red-black-tree"},"headings":[{"value":"The Red-Black Tree"}]}},{"node":{"id":"2fa9f726-8017-5017-a937-568efa05c69b","frontmatter":{"title":"13. The Map Object","path":"/13-map"},"headings":[{"value":"The Map Object"}]}},{"node":{"id":"89d27820-7837-5316-9a1c-8bd3e7485e3f","frontmatter":{"title":"14. The Set and Multimap","path":"/14-set-and-multimap"},"headings":[{"value":"The set and multimap"}]}},{"node":{"id":"d4776902-9b84-51f5-98db-836c22386aa5","frontmatter":{"title":"2. Timing Your Code","path":"/2-timing"},"headings":[{"value":"Timing Your Code (the first project)"},{"value":"Splitting up code into multiple files"},{"value":"include <stdlib.h> is added at the top of the file since it is needed for malloc.  All of the members are initialized to zero except repeat (which is set to the value passed into timer_init)."},{"value":"The Buffer Object"}]}},{"node":{"id":"334411a5-0313-5831-9193-0737c8e4122b","frontmatter":{"title":"3. The Buffer Object","path":"/3-buffer"},"headings":[{"value":"The Buffer Object"},{"value":"Linked Lists"}]}},{"node":{"id":"bafe1fd6-714d-58ac-8ab0-2f455f518e19","frontmatter":{"title":"4. Linked Lists","path":"/4-linked-lists"},"headings":[{"value":"Linked Lists"},{"value":"Threads"}]}},{"node":{"id":"1fbe840f-47a7-51f9-a94b-431a4b44f35c","frontmatter":{"title":"5. Introducing Threads","path":"/5-threads"},"headings":[{"value":"Macros"}]}},{"node":{"id":"09515fb4-be52-520c-b963-ef137ff19fc7","frontmatter":{"title":"6. Macros","path":"/6-macros"},"headings":[{"value":"Macros"},{"value":"The Global Allocator Object"}]}},{"node":{"id":"4a0dc1d8-476c-5792-a22b-44ab620ff631","frontmatter":{"title":"7. The Global Allocator Object","path":"/7-allocator"},"headings":[{"value":"The Global Allocator Object"},{"value":"A Quick Recap"},{"value":"Continue to build out the allocator implementation!"}]}},{"node":{"id":"b6765db4-1bbd-507d-bdf9-b245802b8d27","frontmatter":{"title":"8. The Global Allocator Implementation","path":"/8-allocator-implementation"},"headings":[{"value":"The Global Allocator Implementation"},{"value":"To Be Continued"},{"value":"The Pool Object"}]}},{"node":{"id":"793706d2-d368-5c56-90cb-12da63c2b7b1","frontmatter":{"title":"9. The Pool Object","path":"/9-pool"},"headings":[{"value":"The Pool Object"},{"value":"The Simplest Implementation"},{"value":"A better implementation"},{"value":"TO BE CONTINUED"},{"value":"Binary Search Trees"}]}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/ebook/10-binary-search-trees/","previous":{"fields":{"slug":"/ebook/1-getting-started/"},"frontmatter":{"title":"1. Getting Started","posttype":"ebook"}},"next":{"fields":{"slug":"/ebook/11-balancing-binary-search-trees/"},"frontmatter":{"title":"11. Balancing Binary Search Trees","posttype":"ebook"}}}}}