{"componentChunkName":"component---src-templates-md-page-js","path":"/ebook/7-allocator/","result":{"data":{"site":{"siteMetadata":{"title":"Another C Library"}},"markdownRemark":{"id":"1f7d377b-cb76-56c9-ab8e-65e6f347a63b","html":"<p>A quick note about C allocation methods:</p>\n<p>In C, there are five basic functions for allocating memory (technically there are more, but they are rarely used).</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span>size_t len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">calloc</span><span class=\"token punctuation\">(</span>size_t num<span class=\"token punctuation\">,</span> size_t len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">realloc</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">,</span> size_t len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token function\">strdup</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The middle three functions essentially work as follows (although the internal implementation is more complex for performance reasons).</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">calloc</span><span class=\"token punctuation\">(</span>size_t num<span class=\"token punctuation\">,</span> size_t len<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>res <span class=\"token operator\">=</span> <span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span>num<span class=\"token operator\">*</span>len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">memset</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> num<span class=\"token operator\">*</span>len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">realloc</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">,</span> size_t len<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  size_t old_len <span class=\"token operator\">=</span> <span class=\"token function\">extract_length</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// details of this function depend upon how malloc is implemented</span>\n  <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>res <span class=\"token operator\">=</span> <span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span>len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>len <span class=\"token operator\">&lt;</span> old_len<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">,</span> len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">else</span>\n    <span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">,</span> old_len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">free</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token function\">strdup</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  size_t len <span class=\"token operator\">=</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>res <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span>len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">,</span> len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>It's important to realize that malloc (memory alloc) is the core behind all of these functions or at a minimum, they are derivates of malloc.</p>\n<p>One of the reasons that people tend to steer clear of C is because you must maintain pointers to memory that you allocate so that it can later be freed.  In the last chapter, I introduced doubly-linked lists.  We can implement a way of tracking allocations using a doubly-linked list.  The functions that we will implement are the ones defined above - so the interface will be pretty straight forward.  To prevent naming conflicts, we will use the ac prefix.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">ifndef</span> _ac_allocator_H</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> _ac_allocator_H</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ac_common.h\"</span></span>\n\n<span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">ac_malloc</span><span class=\"token punctuation\">(</span>size_t len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">ac_calloc</span><span class=\"token punctuation\">(</span>size_t len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">ac_realloc</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">,</span> size_t len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token function\">ac_strdup</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">ac_free</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span></code></pre></div>\n<p>You may notice that I don't use two parameters for ac_calloc.  This is intentional as I don't see a benefit in changing the signature from malloc.  </p>\n<p>We could redefine our interface as</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">ifndef</span> _ac_allocator_H</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> _ac_allocator_H</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span> </span><span class=\"token comment\">/* for size_t */</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">ac_malloc</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>filename<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> line<span class=\"token punctuation\">,</span> size_t len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">ac_calloc</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>filename<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> line<span class=\"token punctuation\">,</span> size_t len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">ac_realloc</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>filename<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> line<span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">,</span> size_t len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token function\">ac_strdup</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>filename<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> line<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">ac_free</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>filename<span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span></code></pre></div>\n<p>and then call our functions like this.</p>\n<p>sample.c (this won't work - because I'm not building the object this way in the end)</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ac_allocator.h\"</span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>s <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">ac_malloc</span><span class=\"token punctuation\">(</span><span class=\"token constant\">__FILE__</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">__LINE__</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">ac_free</span><span class=\"token punctuation\">(</span><span class=\"token constant\">__FILE__</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">__LINE__</span><span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>There is a pattern above in that every time we call ac_malloc (and others), we would call it with <strong>FILE</strong>, <strong>LINE</strong>, as the first two parameters.  </p>\n<p>In creating the global allocator, maybe we only want line numbers and malloc to be passed in when the software is defined as being in debug mode.  To define ac_malloc, we might want to do the following.  Considering that we have just identified how to merge the <strong>FILE</strong> and <strong>LINE</strong>, we will use that.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">ifdef</span> _AC_DEBUG_MEMORY_</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_malloc(len) _ac_malloc_d(__AC_FILE_LINE__, len)</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">else</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_malloc(len) malloc(len)</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span>\n\n<span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">_ac_malloc_d</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>caller<span class=\"token punctuation\">,</span> size_t len <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>When defining functions this way, it is good to come up with a convention.  My convention is to use an underscore before the function and to suffix the debug function with _d.  In defining the final interface, I came up with a few additional features.  The first is based upon the idea that the allocator will use an internal object to represent its structure.  That object will be global, and all of the allocation functions will have to pass a pointer to the object.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">_ac_malloc_d</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>caller<span class=\"token punctuation\">,</span> size_t len <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>becomes</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">_ac_malloc_d</span><span class=\"token punctuation\">(</span> ac_allocator_t <span class=\"token operator\">*</span>a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>caller<span class=\"token punctuation\">,</span> size_t len <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The macro changes to.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_malloc(len) _ac_malloc_d(NULL, __AC_FILE_LINE__, len)</span></code></pre></div>\n<p>A NULL allocator simply means to use the global allocator.</p>\n<p>The second feature is to allow for a mechanism to allow for custom content in place of the caller.  For example, if we allocate a buffer and keep changing its size, we might want to know the following: where the buffer was initialized, the maximum size of the buffer, its initial size, etc. Passing a boolean at the end denotes this custom feature, which defaults to false.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">_ac_malloc_d</span><span class=\"token punctuation\">(</span> ac_allocator_t <span class=\"token operator\">*</span>a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>caller<span class=\"token punctuation\">,</span> size_t len <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>becomes</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">_ac_malloc_d</span><span class=\"token punctuation\">(</span> ac_allocator_t <span class=\"token operator\">*</span>a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>caller<span class=\"token punctuation\">,</span> size_t len<span class=\"token punctuation\">,</span> bool custom <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The macro changes to.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_malloc(len) _ac_malloc_d(NULL, __AC_FILE_LINE__, len, false)</span></code></pre></div>\n<p>If the custom feature is enabled, the objects need a way to dump their state to a file (or to the terminal).  In C, you can define a function pointer and then associate the pointer to functions programmatically.  An example is below.  The gist of it is that you specify the new function pointer type by surrounding the name in parenthesis and an extra asterisk.</p>\n<p>For example,</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>my_function<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>would declare a function pointer type named my_function, which took no arguments and didn't return anything (it has a void return type).  I recommend using a suffix for function pointers (I'm going to use _f).  The allocator needs to define a function pointer to allow other objects to dump their details.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>ac_dump_details_f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>FILE <span class=\"token operator\">*</span>out<span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">,</span> size_t length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In C, the order of the members of a structure is also the byte order of the structure.  This is often exploited to allow a structure to be able to be cast as a structure of a different type.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n  ac_dump_details_f dump<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>caller<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> ac_allocator_dump_t<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Another useful feature is to have the state of the memory usage dumped every so often.  All this means is that if <em>AC</em>DEBUG<em>MEMORY</em> is defined as a filename, any program which uses the allocator will record all of the memory allocations every N seconds and rotate the previous snapshot.  To maintain a smaller number of output files, the rotations will rotate files with an ever-expanding gap between them.</p>\n<p>The full allocator interface is below.</p>\n<p>$ac/src/ac_allocator.h</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">ifndef</span> _ac_allocator_H</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> _ac_allocator_H</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ac_common.h\"</span></span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;string.h></span></span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">ifdef</span> _AC_DEBUG_MEMORY_</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_malloc(len) _ac_malloc_d(NULL, __AC_FILE_LINE__, len, false)</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_calloc(len) _ac_calloc_d(NULL, __AC_FILE_LINE__, len, false)</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_realloc(p, len) _ac_realloc_d(NULL, __AC_FILE_LINE__, p, len, false)</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_strdup(p) _ac_strdup_d(NULL, __AC_FILE_LINE__, p)</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_free(p) _ac_free_d(NULL, __AC_FILE_LINE__, p)</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">else</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_malloc(len) malloc(len)</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_calloc(len) calloc(1, len)</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_realloc(p, len) realloc(p, len)</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_strdup(p) strdup(p)</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_free(p) free(p)</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span>\n\n<span class=\"token keyword\">typedef</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>ac_dump_details_f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>FILE <span class=\"token operator\">*</span>out<span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">,</span> size_t length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n  ac_dump_details_f dump<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>caller<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> ac_allocator_dump_t<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ac_allocator_s</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">ac_allocator_s</span> ac_allocator_t<span class=\"token punctuation\">;</span>\n\nac_allocator_t <span class=\"token operator\">*</span><span class=\"token function\">ac_allocator_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">ac_allocator_destroy</span><span class=\"token punctuation\">(</span>ac_allocator_t <span class=\"token operator\">*</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">ac_dump_global_allocations</span><span class=\"token punctuation\">(</span>ac_allocator_t <span class=\"token operator\">*</span>a<span class=\"token punctuation\">,</span> FILE <span class=\"token operator\">*</span>out<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">_ac_malloc_d</span><span class=\"token punctuation\">(</span>ac_allocator_t <span class=\"token operator\">*</span>a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>caller<span class=\"token punctuation\">,</span> size_t len<span class=\"token punctuation\">,</span> bool custom <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">_ac_calloc_d</span><span class=\"token punctuation\">(</span>ac_allocator_t <span class=\"token operator\">*</span>a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>caller<span class=\"token punctuation\">,</span> size_t len<span class=\"token punctuation\">,</span> bool custom <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">_ac_realloc_d</span><span class=\"token punctuation\">(</span>ac_allocator_t <span class=\"token operator\">*</span>a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>caller<span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">,</span> size_t len<span class=\"token punctuation\">,</span> bool custom<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token function\">_ac_strdup_d</span><span class=\"token punctuation\">(</span>ac_allocator_t <span class=\"token operator\">*</span>a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>caller<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>p <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">_ac_free_d</span><span class=\"token punctuation\">(</span>ac_allocator_t <span class=\"token operator\">*</span>a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>caller<span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span></code></pre></div>\n<p>Before understanding the implementation, let's see how other objects and code use this.  The ac_timer.h/c will change in the following way:</p>\n<p>Include ac_common.h</p>\n<p>ac_timer.h</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ac_common.h\"</span></span></code></pre></div>\n<p>Replace</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">ac_timer_t <span class=\"token operator\">*</span><span class=\"token function\">ac_timer_init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> repeat<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>with</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">ifdef</span> _AC_DEBUG_MEMORY_</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_timer_init(repeat) _ac_timer_init(repeat, AC_FILE_LINE_MACRO(\"ac_timer\"))</span>\nac_timer_t <span class=\"token operator\">*</span><span class=\"token function\">_ac_timer_init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> repeat<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>caller<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">else</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_timer_init(repeat) _ac_timer_init(repeat)</span>\nac_timer_t <span class=\"token operator\">*</span><span class=\"token function\">_ac_timer_init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> repeat<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span></code></pre></div>\n<p>The above code has two basic cases: one where <em>AC</em>DEBUG<em>MEMORY</em> is defined, and one where it is not (#else).  It may be easier to break this into a couple of steps.</p>\n<ol>\n<li>convert the init function to be prefixed with an underscore</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">ac_timer_t <span class=\"token operator\">*</span><span class=\"token function\">ac_timer_init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> repeat<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>becomes</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">ac_timer_t <span class=\"token operator\">*</span><span class=\"token function\">_ac_timer_init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> repeat<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"2\">\n<li>\n<p>create a macro which defines ac<em>timer</em>init as <em>ac</em>timer_init</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_timer_init(repeat) _ac_timer_init(repeat)</span>\nac_timer_t <span class=\"token operator\">*</span><span class=\"token function\">_ac_timer_init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> repeat<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>define the macro if logic with the else part filled in.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">ifdef</span> _AC_DEBUG_MEMORY_</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">else</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_timer_init(repeat) _ac_timer_init(repeat)</span>\nac_timer_t <span class=\"token operator\">*</span><span class=\"token function\">_ac_timer_init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> repeat<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span></code></pre></div>\n</li>\n<li>\n<p>Add const char *caller to the debug version of <em>ac</em>timer_init</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">ac_timer_t <span class=\"token operator\">*</span><span class=\"token function\">_ac_timer_init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> repeat<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>caller<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>define the macro to call the init function.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_timer_init(repeat) _ac_timer_init(repeat, AC_FILE_LINE_MACRO(\"ac_timer\"))</span></code></pre></div>\n</li>\n<li>\n<p>put the two calls in the #ifdef <em>AC</em>DEBUG<em>MEMORY</em> section.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">ifdef</span> _AC_DEBUG_MEMORY_</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_timer_init(repeat) _ac_timer_init(repeat, AC_FILE_LINE_MACRO(\"ac_timer\"))</span>\nac_timer_t <span class=\"token operator\">*</span><span class=\"token function\">_ac_timer_init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> repeat<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>caller<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">else</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> ac_timer_init(repeat) _ac_timer_init(repeat)</span>\nac_timer_t <span class=\"token operator\">*</span><span class=\"token function\">_ac_timer_init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> repeat<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span></code></pre></div>\n</li>\n</ol>\n<p>Objects will typically use the AC<em>FILE</em>LINE<em>MACRO(\"object</em>name\") when defining the init call, as in step 5 above.</p>\n<p>Change ac_timer.c from</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">ac_timer_t <span class=\"token operator\">*</span><span class=\"token function\">ac_timer_init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> repeat<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  ac_timer_t <span class=\"token operator\">*</span>t <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ac_timer_t <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ac_timer_t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>to</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">ifdef</span> _AC_DEBUG_MEMORY_</span>\nac_timer_t <span class=\"token operator\">*</span><span class=\"token function\">_ac_timer_init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> repeat<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>caller<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  ac_timer_t <span class=\"token operator\">*</span>t <span class=\"token operator\">=</span>\n    <span class=\"token punctuation\">(</span>ac_timer_t <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">_ac_malloc_d</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> caller<span class=\"token punctuation\">,</span>\n                                   <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ac_timer_t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> false<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">else</span></span>\nac_timer_t <span class=\"token operator\">*</span><span class=\"token function\">_ac_timer_init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> repeat<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  ac_timer_t <span class=\"token operator\">*</span>t <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ac_timer_t <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">ac_malloc</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ac_timer_t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span></code></pre></div>\n<ol>\n<li>Change all malloc, calloc, strdup, realloc, and free calls to have ac_ prefix.<br/></li>\n<li>Change the function name from ac<em>timer</em>init to <em>ac</em>timer_init.<br/></li>\n<li>Wrap the block in a #ifdef <em>AC</em>DEBUG<em>MEMORY</em>/#else/#endif block<br/></li>\n<li>Define the <em>AC</em>DEBUG<em>MEMORY</em> portion.  The <em>ac</em>timer<em>init function has the extra const char *caller parameter.  The allocation uses _ac</em>malloc_d directly, as shown above.</li>\n</ol>\n<p>To test these changes out, I've modified code from $ac/illustrations/2<em>timing/13</em>timer</p>\n<p>The following code is found in <i>illustrations/6<em>allocator/1</em>timing</i></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cd $ac/illustrations/6_allocator/1_timing</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ make\ngcc -O3 -I../../../src -D_AC_DEBUG_MEMORY_=NULL ../../../src/ac_timer.c ../../../src/ac_allocator.c ../../../src/ac_buffer.c ../../../src/ac_pool.c test_timer.c -o test_timer\n./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse\nABCDEFGHIJKLMNOPQRSTUVWXYZ =&gt; ZYXWVUTSRQPONMLKJIHGFEDCBA\ntime_spent: 7.7260ns\nReverse =&gt; esreveR\ntime_spent: 1.8180ns\noverall time_spent: 9.5440ns\n99 byte(s) allocated in 4 allocations (160 byte(s) overhead)\ntest_timer.c:24: 27\ntest_timer.c:26 [ac_timer]: 32\ntest_timer.c:24: 8\ntest_timer.c:26 [ac_timer]: 32</code></pre></div>\n<p>Include ac<em>allocator.h in test</em>timer.c</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ac_allocator.h\"</span></span></code></pre></div>\n<p>and alter the malloc and free calls to ac<em>malloc and ac</em>free.  I've intentionally commented out several destroy calls and the ac_free call.</p>\n<p>When make was run above, the following extra lines were output</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">99 byte(s) allocated in 4 allocations (160 byte(s) overhead)\ntest_timer.c:24: 27\ntest_timer.c:26 [ac_timer]: 32\ntest_timer.c:24: 8\ntest_timer.c:26 [ac_timer]: 32</code></pre></div>\n<p>This indicates that 4 allocations were not properly freed.</p>\n<p>line 24</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>s <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">ac_malloc</span><span class=\"token punctuation\">(</span>len<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>line 26</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">ac_timer_t <span class=\"token operator\">*</span>copy_timer <span class=\"token operator\">=</span> <span class=\"token function\">ac_timer_init</span><span class=\"token punctuation\">(</span><span class=\"token function\">ac_timer_get_repeat</span><span class=\"token punctuation\">(</span>overall_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>To fix the code, we need to make sure that copy_timer is destroyed and s is freed.  Lines 47-48 are what need uncommented to make this work.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// ac_timer_destroy(copy_timer);</span>\n<span class=\"token comment\">// ac_free(s);</span></code></pre></div>\n<p>The error reported logged the ac<em>timer</em>init line as opposed to the ac<em>malloc inside of ac</em>timer_init.  This is likely more useful unless you are testing the individual object.</p>\n<p>Go ahead and uncomment those lines and run make again</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ make\ngcc -O3 -I../../../src -D_AC_DEBUG_MEMORY_=NULL ../../../src/ac_timer.c ../../../src/ac_allocator.c ../../../src/ac_buffer.c ../../../src/ac_pool.c test_timer.c -o test_timer\n./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse\nABCDEFGHIJKLMNOPQRSTUVWXYZ =&gt; ZYXWVUTSRQPONMLKJIHGFEDCBA\ntime_spent: 7.7260ns\nReverse =&gt; esreveR\ntime_spent: 1.8180ns\noverall time_spent: 9.5440ns</code></pre></div>\n<p>Go ahead and revert your changes.  You can revert your changes in the current directory by running the following git command.  If you don't specify the ., then it will revert all changes in the whole repo (so this command can be somewhat dangerous!)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">git checkout .</code></pre></div>\n<p>The lines indicating memory loss are no longer printed.  In this example, <em>AC</em>DEBUG<em>MEMORY</em> was defined as NULL in the Makefile using the following line.</p>\n<div class=\"gatsby-highlight\" data-language=\"makefile\"><pre class=\"language-makefile\"><code class=\"language-makefile\">FLAGS <span class=\"token operator\">+=</span> -D_AC_DEBUG_MEMORY_<span class=\"token operator\">=</span>NULL</code></pre></div>\n<p>If we change this to</p>\n<div class=\"gatsby-highlight\" data-language=\"makefile\"><pre class=\"language-makefile\"><code class=\"language-makefile\">FLAGS <span class=\"token operator\">+=</span> -D_AC_DEBUG_MEMORY_<span class=\"token operator\">=</span>\\\"memory.log\\\"</code></pre></div>\n<p>run</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">make clean</code></pre></div>\n<p>and then</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ make\ngcc -O3 -I../../../src -D_AC_DEBUG_MEMORY_=\\&quot;memory.log\\&quot; ../../../src/ac_timer.c ../../../src/ac_allocator.c ../../../src/ac_buffer.c ../../../src/ac_pool.c test_timer.c -o test_timer\n./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse\nABCDEFGHIJKLMNOPQRSTUVWXYZ =&gt; ZYXWVUTSRQPONMLKJIHGFEDCBA\ntime_spent: 5.9220ns\nReverse =&gt; esreveR\ntime_spent: 1.5720ns\noverall time_spent: 7.4940ns</code></pre></div>\n<p>There is a new file called memory.log in this directory.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ ls\nMakefile\tmemory.log\ttest_timer\ttest_timer.c</code></pre></div>\n<p>You can view memory.log by running</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ cat memory.log\n99 byte(s) allocated in 4 allocations (160 byte(s) overhead)\ntest_timer.c:24: 27\ntest_timer.c:26 [ac_timer]: 32\ntest_timer.c:24: 8\ntest_timer.c:26 [ac_timer]: 32</code></pre></div>\n<p>If you view the test<em>timer.c code, you will notice that a significant portion of the main function now has the ac</em> prefix.</p>\n<p>test_timer.c (main function)</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">int</span> repeat_test <span class=\"token operator\">=</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">;</span>\n  ac_timer_t <span class=\"token operator\">*</span>overall_timer <span class=\"token operator\">=</span> <span class=\"token function\">ac_timer_init</span><span class=\"token punctuation\">(</span>repeat_test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span>argc<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    size_t len <span class=\"token operator\">=</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>s <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">ac_malloc</span><span class=\"token punctuation\">(</span>len<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    ac_timer_t <span class=\"token operator\">*</span>copy_timer <span class=\"token operator\">=</span> <span class=\"token function\">ac_timer_init</span><span class=\"token punctuation\">(</span><span class=\"token function\">ac_timer_get_repeat</span><span class=\"token punctuation\">(</span>overall_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">ac_timer_start</span><span class=\"token punctuation\">(</span>copy_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">int</span> j<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j<span class=\"token operator\">&lt;</span>repeat_test<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">ac_timer_stop</span><span class=\"token punctuation\">(</span>copy_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    ac_timer_t <span class=\"token operator\">*</span>test_timer <span class=\"token operator\">=</span> <span class=\"token function\">ac_timer_init</span><span class=\"token punctuation\">(</span><span class=\"token function\">ac_timer_get_repeat</span><span class=\"token punctuation\">(</span>overall_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">ac_timer_start</span><span class=\"token punctuation\">(</span>test_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">int</span> j<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j<span class=\"token operator\">&lt;</span>repeat_test<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">reverse_string</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">ac_timer_stop</span><span class=\"token punctuation\">(</span>test_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">ac_timer_subtract</span><span class=\"token punctuation\">(</span>test_timer<span class=\"token punctuation\">,</span> copy_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">ac_timer_add</span><span class=\"token punctuation\">(</span>overall_timer<span class=\"token punctuation\">,</span> test_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s => %s\\n\"</span><span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"time_spent: %0.4fns\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">ac_timer_ns</span><span class=\"token punctuation\">(</span>test_timer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">ac_timer_destroy</span><span class=\"token punctuation\">(</span>test_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ac_timer_destroy(copy_timer);</span>\n    <span class=\"token comment\">// ac_free(s);</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"overall time_spent: %0.4fns\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">ac_timer_ns</span><span class=\"token punctuation\">(</span>overall_timer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">ac_timer_destroy</span><span class=\"token punctuation\">(</span>overall_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Breaking out all of the ac_ statements:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">  ac_timer_t <span class=\"token operator\">*</span>overall_timer <span class=\"token operator\">=</span> <span class=\"token function\">ac_timer_init</span><span class=\"token punctuation\">(</span>repeat_test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>s <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">ac_malloc</span><span class=\"token punctuation\">(</span>len<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    ac_timer_t <span class=\"token operator\">*</span>copy_timer <span class=\"token operator\">=</span> <span class=\"token function\">ac_timer_init</span><span class=\"token punctuation\">(</span><span class=\"token function\">ac_timer_get_repeat</span><span class=\"token punctuation\">(</span>overall_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">ac_timer_start</span><span class=\"token punctuation\">(</span>copy_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">ac_timer_stop</span><span class=\"token punctuation\">(</span>copy_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    ac_timer_t <span class=\"token operator\">*</span>test_timer <span class=\"token operator\">=</span> <span class=\"token function\">ac_timer_init</span><span class=\"token punctuation\">(</span><span class=\"token function\">ac_timer_get_repeat</span><span class=\"token punctuation\">(</span>overall_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">ac_timer_start</span><span class=\"token punctuation\">(</span>test_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">ac_timer_stop</span><span class=\"token punctuation\">(</span>test_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">ac_timer_subtract</span><span class=\"token punctuation\">(</span>test_timer<span class=\"token punctuation\">,</span> copy_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">ac_timer_add</span><span class=\"token punctuation\">(</span>overall_timer<span class=\"token punctuation\">,</span> test_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">ac_timer_destroy</span><span class=\"token punctuation\">(</span>test_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ac_timer_destroy(copy_timer);</span>\n    <span class=\"token comment\">// ac_free(s);</span>\n  <span class=\"token function\">ac_timer_destroy</span><span class=\"token punctuation\">(</span>overall_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>If you mentally note that ac is just a prefix and view the code as</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">timer_t <span class=\"token operator\">*</span>overall_timer <span class=\"token operator\">=</span> <span class=\"token function\">timer_init</span><span class=\"token punctuation\">(</span>repeat_test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>s <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span>len<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  timer_t <span class=\"token operator\">*</span>copy_timer <span class=\"token operator\">=</span> <span class=\"token function\">timer_init</span><span class=\"token punctuation\">(</span><span class=\"token function\">timer_get_repeat</span><span class=\"token punctuation\">(</span>overall_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">timer_start</span><span class=\"token punctuation\">(</span>copy_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">timer_stop</span><span class=\"token punctuation\">(</span>copy_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  timer_t <span class=\"token operator\">*</span>test_timer <span class=\"token operator\">=</span> <span class=\"token function\">timer_init</span><span class=\"token punctuation\">(</span><span class=\"token function\">timer_get_repeat</span><span class=\"token punctuation\">(</span>overall_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">timer_start</span><span class=\"token punctuation\">(</span>test_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">timer_stop</span><span class=\"token punctuation\">(</span>test_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">timer_subtract</span><span class=\"token punctuation\">(</span>test_timer<span class=\"token punctuation\">,</span> copy_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">timer_add</span><span class=\"token punctuation\">(</span>overall_timer<span class=\"token punctuation\">,</span> test_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">timer_destroy</span><span class=\"token punctuation\">(</span>test_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// timer_destroy(copy_timer);</span>\n  <span class=\"token comment\">// free(s);</span>\n<span class=\"token function\">timer_destroy</span><span class=\"token punctuation\">(</span>overall_timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>You can see that there are timer objects, malloc, and free.  Given that malloc, calloc, realloc, strdup, and free are so common in code, I opted not to provide any extra qualifiers other than ac.  I aim to make code highly optimized and very readable.  Another important feature of qualified naming is that it makes it possible to search for all places something exists.  For example, to find all cases where ac_timer are used, you can run..</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cd $ac/illustrations\ngrep -rn ac_timer .</code></pre></div>\n<p>and your output might look like...</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">./2_timing/12_timer/test_timer.c:1:#include &quot;ac_timer.h&quot;\n./2_timing/12_timer/test_timer.c:20:  ac_timer_t *overall_timer = ac_timer_init(repeat_test);\n./2_timing/12_timer/test_timer.c:25:    ac_timer_t *copy_timer = ac_timer_init(ac_timer_get_repeat(overall_timer));\n./2_timing/12_timer/test_timer.c:26:    ac_timer_start(copy_timer);\n./2_timing/12_timer/test_timer.c:30:    ac_timer_stop(copy_timer);\n./2_timing/12_timer/test_timer.c:32:    ac_timer_t *test_timer = ac_timer_init(ac_timer_get_repeat(overall_timer));\n./2_timing/12_timer/test_timer.c:33:    ac_timer_start(test_timer);\n./2_timing/12_timer/test_timer.c:38:    ac_timer_stop(test_timer);\n./2_timing/12_timer/test_timer.c:39:    ac_timer_subtract(test_timer, copy_timer);\n./2_timing/12_timer/test_timer.c:40:    ac_timer_add(overall_timer, test_timer);\n./2_timing/12_timer/test_timer.c:43:    printf( &quot;time_spent: %0.4fns\\n&quot;, ac_timer_ns(test_timer) );\n./2_timing/12_timer/test_timer.c:45:    ac_timer_destroy(test_timer);\n./2_timing/12_timer/test_timer.c:46:    ac_timer_destroy(copy_timer);\n./2_timing/12_timer/test_timer.c:49:  printf( &quot;overall time_spent: %0.4fns\\n&quot;, ac_timer_ns(overall_timer) );\n./2_timing/12_timer/test_timer.c:50:  ac_timer_destroy(overall_timer);\n./2_timing/12_timer/Makefile:2:OBJECTS=$(ROOT)/src/ac_timer.c\n./2_timing/12_timer/Makefile:3:HEADER_FILES=$(ROOT)/src/ac_timer.h\nBinary file ./2_timing/12_timer/test_timer matches\n./2_timing/13_timer/test_timer.c:1:#include &quot;ac_timer.h&quot;\n./2_timing/13_timer/test_timer.c:20:  ac_timer_t *overall_timer = ac_timer_init(repeat_test);\n./2_timing/13_timer/test_timer.c:25:    ac_timer_t *copy_timer = ac_timer_init(ac_timer_get_repeat(overall_timer));\n./2_timing/13_timer/test_timer.c:26:    ac_timer_start(copy_timer);\n./2_timing/13_timer/test_timer.c:30:    ac_timer_stop(copy_timer);\n...</code></pre></div>\n<p>This feature alone is extremely valuable when working with a large codebase.  It takes longer to write each line of code, but the reader can easily find every line of code where the object is used.  This makes it easier to find example code and to build upon the work of others.</p>\n<h2 id=\"a-quick-recap\"><a href=\"#a-quick-recap\" aria-label=\"a quick recap permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A Quick Recap</h2>\n<ol>\n<li>\n<p>The 5 basic allocation methods in C are...</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">malloc</span><span class=\"token punctuation\">(</span>size_t len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">calloc</span><span class=\"token punctuation\">(</span>size_t num<span class=\"token punctuation\">,</span> size_t len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token function\">realloc</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">,</span> size_t len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token function\">strdup</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">free</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>We define those functions with the ac_ prefix such that if we are debugging memory, we can track where the allocations are made.  This allows us to recognize memory leaks and potentially a couple of other common errors.</li>\n<li>Callback functions should have a suffix of _f</li>\n<li>We defined an approach to find when objects are created (and not destroyed).  The basic changes to ac<em>timer were outlined to make it support using the ac</em>allocator.</li>\n<li>When we are using the ac<em>allocator object outside of objects, the only change to the code is to replace the 5 basic allocation methods with `ac</em>...` If, for some reason, you do not wish to allocate memory using the ac method, then make sure that you don't free it with the ac method.</li>\n<li>We can define <em>AC</em>DEBUG<em>MEMORY</em> as NULL and have memory leaks reported to the terminal when the program exits.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"makefile\"><pre class=\"language-makefile\"><code class=\"language-makefile\">FLAGS <span class=\"token operator\">+=</span> -D_AC_DEBUG_MEMORY_<span class=\"token operator\">=</span>\\\"memory.log\\\"</code></pre></div>\n<ol start=\"7\">\n<li>We can define <em>AC</em>DEBUG<em>MEMORY</em> as a string and have memory leaks reported to a file periodically.  The period is defined in seconds as <em>AC</em>DEBUG<em>MEMORY</em>SPEED_ and defaults to 60 in ac_common.h</li>\n<li>You can grep for any line of code which contains an object using the following approach.  The following grep line will search all subdirectories for the string ac_timer and report the filename and line number where the text is found.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">grep -rn ac_timer .</code></pre></div>\n<p>ac_timer can be replaced with a function name or another object name (or whatever you want to find).</p>\n<p><a href=\"../../../README.md\">Table of Contents (only if viewing on Github)</a></p>","frontmatter":{"title":"7. The Global Allocator Object","posttype":"ebook"}},"allMarkdownRemark":{"edges":[{"node":{"id":"65ef6af8-db2b-5241-aabb-be94ecaa93a6","frontmatter":{"title":"","path":null,"posttype":null},"headings":[{"value":"Line spacing in markdown"},{"value":"Escape characters in markdown"},{"value":"Create multiline macro in C"},{"value":"Static inline vs inline"},{"value":"Regex find replace"},{"value":"Atom-beautify problems"}]}},{"node":{"id":"ea93de22-255a-510a-a3d6-e5ca71719254","frontmatter":{"title":"","path":null,"posttype":null},"headings":[{"value":"An important intuition to quicksort"}]}},{"node":{"id":"e92ffe3f-7ca9-5998-86d0-02a589e5a259","frontmatter":{"title":"1. Getting Started","path":"/1-getting-started","posttype":"tutorial"},"headings":[{"value":"A quick word about licensing"},{"value":"Getting Started"}]}},{"node":{"id":"b16eb4e9-d84b-5be6-84f7-61ebe2bcc410","frontmatter":{"title":"10. Binary Search Trees","path":"/10-binary-search-trees","posttype":"ebook"},"headings":[{"value":"The basic structure"},{"value":"Find"},{"value":"Insert"},{"value":"First, Last, Next, Previous"},{"value":"Erase"},{"value":"Postorder iteration"},{"value":"Printing a binary tree"},{"value":"Finding Peers"},{"value":"Quick Recap"}]}},{"node":{"id":"baba82da-4489-5fd7-9915-ef011f56a666","frontmatter":{"title":"11. Balancing Binary Search Trees","path":"/11-balancing-binary-search-trees","posttype":"ebook"},"headings":[{"value":"Why balancing is important"},{"value":"Properties of a red-black tree"},{"value":"Coloring"},{"value":"Rotations"}]}},{"node":{"id":"f2d454de-1f32-50a9-91a3-f3ed53776f11","frontmatter":{"title":"12. The Red-Black Tree","path":"/12-red-black-tree","posttype":"ebook"},"headings":[{"value":"The properties of a red-black tree"},{"value":"Testing the red-black tree properties"},{"value":"Insert"},{"value":"Erase"},{"value":"Quick recap of when tree becomes invalid"},{"value":"fixcolorfor_erase"},{"value":"Packing color into the parent node"}]}},{"node":{"id":"0229f92a-6f18-52a2-9a98-c536b17b48fa","frontmatter":{"title":"13. The Map Object","path":"/13-map","posttype":"ebook"},"headings":[]}},{"node":{"id":"d40dca2d-317c-5be1-96bb-1a1ce5aa709b","frontmatter":{"title":"14. The Set and Multimap","path":"/14-set-and-multimap","posttype":"ebook"},"headings":[{"value":"The set"},{"value":"The multimap"}]}},{"node":{"id":"dda89e39-e139-5921-b61e-3428acc8db29","frontmatter":{"title":"2. Timing Your Code (First Project)","path":"/2-timing","posttype":"tutorial"},"headings":[{"value":"A brief introduction to C"},{"value":"What happens during compilation"},{"value":"How to time code"},{"value":"Reversing a string"},{"value":"The basic Makefile"},{"value":"More accurately timing code"},{"value":"Compiler optimizations"},{"value":"Separating the implementation from the interface"},{"value":"Defining an object"},{"value":"The timer interface"},{"value":"Making the timer object reusable"},{"value":"Splitting up a project into multiple directories"},{"value":"Splitting up the Makefile"}]}},{"node":{"id":"9801a3af-8f22-5982-94c5-35f6112eb823","frontmatter":{"title":"3. The Buffer Object","path":"/3-buffer","posttype":"tutorial"},"headings":[{"value":"How it compares to other languages"},{"value":"A bit of history and setup"},{"value":"The buffer interface"},{"value":"The implementation"}]}},{"node":{"id":"711af732-1367-5fd2-9136-ab310ae70a1c","frontmatter":{"title":"4. Linked Lists","path":"/4-linked-lists","posttype":"tutorial"},"headings":[{"value":"A data structure interface"},{"value":"The data structure interface test driver"},{"value":"The singly linked list"},{"value":"The doubly linked list"}]}},{"node":{"id":"3f9e59fa-f5a7-5d87-95d8-40c4b5a27155","frontmatter":{"title":"5. Threads","path":"/5-threads","posttype":"tutorial"},"headings":[{"value":"Introducing Threads"},{"value":"Creating threads"},{"value":"Threads and optimizing code"},{"value":"Avoid global variables when you can"},{"value":"Mutexes"},{"value":"Timing considerations"}]}},{"node":{"id":"14b23037-d39b-5c6a-8575-87c49f29e5bf","frontmatter":{"title":"6. Macros","path":"/6-macros","posttype":"tutorial"},"headings":[]}},{"node":{"id":"1f7d377b-cb76-56c9-ab8e-65e6f347a63b","frontmatter":{"title":"7. The Global Allocator Object","path":"/7-allocator","posttype":"ebook"},"headings":[{"value":"A Quick Recap"}]}},{"node":{"id":"836c39a4-58c3-5e44-973e-2eaee112e590","frontmatter":{"title":"8. The Global Allocator Implementation","path":"/8-allocator-implementation","posttype":"ebook"},"headings":[{"value":"Keywords used"},{"value":"Symbols used"}]}},{"node":{"id":"c0fc3845-5a1d-5561-b1ce-e06b57e99af8","frontmatter":{"title":"9. The Pool Object","path":"/9-pool","posttype":"ebook"},"headings":[]}},{"node":{"id":"065c3ab5-419a-554d-a220-4897a1a6534e","frontmatter":{"title":"ac_allocator","path":"/ac-allocator","posttype":"docs"},"headings":[{"value":"Dependencies"},{"value":"Documentation"},{"value":"Detecting Memory Errors"},{"value":"Detecting Memory Loss"},{"value":"Double Free"},{"value":"Freeing the Wrong Memory"},{"value":"Tracking Memory Loss Over Time"},{"value":"Advanced Usage"}]}},{"node":{"id":"fab92a85-30fc-5a12-9164-22ce6f6fa580","frontmatter":{"title":"ac_pool","path":"/ac-pool","posttype":"docs"},"headings":[{"value":"Commonly used functions"},{"value":"More advanced functions or less used"},{"value":"Dependencies"}]}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/ebook/7-allocator/"}}}