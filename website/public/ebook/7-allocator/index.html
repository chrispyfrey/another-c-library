<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.45 'georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'georgia',serif;font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}ul{margin-left:1.45rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.45rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;font-size:0.85rem;line-height:1.45rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}blockquote{margin-left:1.45rem;margin-right:1.45rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.45rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.45rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.45rem;margin-bottom:calc(1.45rem / 2);margin-top:calc(1.45rem / 2);}li > ul{margin-left:1.45rem;margin-bottom:calc(1.45rem / 2);margin-top:calc(1.45rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.45rem / 2);}code{font-size:0.85rem;line-height:1.45rem;}kbd{font-size:0.85rem;line-height:1.45rem;}samp{font-size:0.85rem;line-height:1.45rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:0.96667rem;padding-right:0.96667rem;padding-top:0.725rem;padding-bottom:calc(0.725rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}</style><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><title data-react-helmet="true">7. The Global Allocator Object | Another C Library</title><meta data-react-helmet="true" name="description" content="A documentation site for Another C Library."/><meta data-react-helmet="true" property="og:title" content="7. The Global Allocator Object"/><meta data-react-helmet="true" property="og:description" content="A documentation site for Another C Library."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Daniel Curtis"/><meta data-react-helmet="true" name="twitter:title" content="7. The Global Allocator Object"/><meta data-react-helmet="true" name="twitter:description" content="A documentation site for Another C Library."/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="shortcut icon" href="/icons/icon-48x48.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="generator" content="Gatsby 2.16.1"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><style data-href="/styles.1fda8d1dee77beeb7dae.css">code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}a{text-decoration:none;cursor:pointer;color:#3182ce}a:hover{text-decoration:underline}button:hover{-webkit-transition:.6s;transition:.6s;-webkit-filter:brightness(115%);filter:brightness(115%)}nav{display:flex;align-items:center}pre[class*=language-]{background:#1a202c;overflow-x:scroll}:not(pre)>code[class*=language-],pre[class*=language-]{border-radius:0;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;text-shadow:none}:not(pre)>code[class*=language-]{background:#edf2f7;color:#000;padding:3px}.Footer{max-width:1200px;margin:30px auto;display:flex;justify-content:space-between}.Flex{display:grid;grid-template-columns:auto auto;grid-column-gap:50px}.Content{max-width:950px;width:72vw}@media only screen and (max-width:600px){.Footer,nav{flex-direction:column}.Flex{grid-template-columns:auto}.Sidebar{display:none}.Content{width:100%}}</style><link as="script" rel="preload" href="/component---src-templates-ebook-page-js-fe8bc0f2c932eda75c4a.js"/><link as="script" rel="preload" href="/commons-0ae7f027867ef630b05a.js"/><link as="script" rel="preload" href="/app-95ebc95ba4fb3bc2dd23.js"/><link as="script" rel="preload" href="/styles-8648ad68e26f3992ff5c.js"/><link as="script" rel="preload" href="/webpack-runtime-3090066330befb922a07.js"/><link as="fetch" rel="preload" href="/page-data/ebook/7-allocator/page-data.json" crossorigin="anonymous"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div style="background-color:white"><header style="position:sticky;top:0;background-color:#1A202C;z-index:1"><nav style="margin:auto;max-width:1200px"><a style="color:white;font-size:1.25rem;padding:1rem 1.5rem;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif" href="/"><span style="font-weight:700">Another C Library</span></a><a style="color:white;font-size:1.25rem;padding:1rem 1.5rem;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif" href="/docs/">Documentation</a><a style="color:#38A169;font-size:1.25rem;padding:1rem 1.5rem;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif;border-bottom:solid 4px #2F855A;background-color:#2D3748" class="" href="/ebook/">A C eBook</a><a style="color:white;font-size:1.25rem;padding:1rem 1.5rem;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif" target="_blank" rel="noopener noreferrer" href="https://github.com/contactandyc/another-c-library">Github <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" style="padding-top:5px" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"></path></svg></a></nav></header><main><div style="margin:0 auto;max-width:1200px;display:flex"><div style="color:black;margin:0;padding:20px" class="Content"><h1>7. The Global Allocator Object</h1><div><p>Copyright 2019 Andy Curtis &#x26; Daniel Curtis</p>
<h1 id="the-global-allocator-object"><a href="#the-global-allocator-object" aria-label="the global allocator object permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Global Allocator Object</h1>
<p>A quick note about C allocation methods:</p>
<p>In C, there are five basic functions for allocating memory (technically there are more, but they are rarely used).</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">malloc</span><span class="token punctuation">(</span>size_t len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">calloc</span><span class="token punctuation">(</span>size_t num<span class="token punctuation">,</span> size_t len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">realloc</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">,</span> size_t len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">strdup</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">free</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The middle three functions essentially work as follows (although the internal implementation is more complex for performance reasons).</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">calloc</span><span class="token punctuation">(</span>size_t num<span class="token punctuation">,</span> size_t len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>res <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>num<span class="token operator">*</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">memset</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> num<span class="token operator">*</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">realloc</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">,</span> size_t len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  size_t old_len <span class="token operator">=</span> <span class="token function">extract_length</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// details of this function depend upon how malloc is implemented</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>res <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">&lt;</span> old_len<span class="token punctuation">)</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> p<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> p<span class="token punctuation">,</span> old_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">free</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">strdup</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  size_t len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>res <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">memcpy</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> p<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>It's important to realize that malloc (memory alloc) is the core behind all of these functions or at a minimum, they are derivates of malloc.</p>
<p>One of the reasons that people tend to steer clear of C is because you must maintain pointers to memory that you allocate so that it can later be freed.  In the last chapter, I introduced doubly-linked lists.  We can implement a way of tracking allocations using a doubly-linked list.  The functions that we will implement are the ones defined above - so the interface will be pretty straight forward.  To prevent naming conflicts, we will use the ac prefix.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">ifndef</span> _ac_allocator_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> _ac_allocator_H</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ac_common.h"</span></span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">ac_malloc</span><span class="token punctuation">(</span>size_t len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">ac_calloc</span><span class="token punctuation">(</span>size_t len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">ac_realloc</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">,</span> size_t len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">ac_strdup</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">ac_free</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span></code></pre></div>
<p>You may notice that I don't use two parameters for ac_calloc.  This is intentional as I don't see a benefit in changing the signature from malloc.  </p>
<p>We could redefine our interface as</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">ifndef</span> _ac_allocator_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> _ac_allocator_H</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span> </span><span class="token comment">/* for size_t */</span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">ac_malloc</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">,</span> <span class="token keyword">int</span> line<span class="token punctuation">,</span> size_t len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">ac_calloc</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">,</span> <span class="token keyword">int</span> line<span class="token punctuation">,</span> size_t len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">ac_realloc</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">,</span> <span class="token keyword">int</span> line<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">,</span> size_t len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">ac_strdup</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">,</span> <span class="token keyword">int</span> line<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">ac_free</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span></code></pre></div>
<p>and then call our functions like this.</p>
<p>sample.c (this won't work - because I'm not building the object this way in the end)</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ac_allocator.h"</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">ac_malloc</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">,</span> <span class="token constant">__LINE__</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ac_free</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">,</span> <span class="token constant">__LINE__</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>There is a pattern above in that every time we call ac_malloc (and others), we would call it with <strong>FILE</strong>, <strong>LINE</strong>, as the first two parameters.  </p>
<p>In creating the global allocator, maybe we only want line numbers and malloc to be passed in when the software is defined as being in debug mode.  To define ac_malloc, we might want to do the following.  Considering that we have just identified how to merge the <strong>FILE</strong> and <strong>LINE</strong>, we will use that.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">ifdef</span> _AC_DEBUG_MEMORY_</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ac_malloc(len) _ac_malloc_d(__AC_FILE_LINE__, len)</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
<span class="token macro property">#<span class="token directive keyword">define</span> ac_malloc(len) malloc(len)</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">_ac_malloc_d</span><span class="token punctuation">(</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>caller<span class="token punctuation">,</span> size_t len <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>When defining functions this way, it is good to come up with a convention.  My convention is to use an underscore before the function and to suffix the debug function with _d.  In defining the final interface, I came up with a few additional features.  The first is based upon the idea that the allocator will use an internal object to represent its structure.  That object will be global, and all of the allocation functions will have to pass a pointer to the object.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">_ac_malloc_d</span><span class="token punctuation">(</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>caller<span class="token punctuation">,</span> size_t len <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>becomes</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">_ac_malloc_d</span><span class="token punctuation">(</span> ac_allocator_t <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>caller<span class="token punctuation">,</span> size_t len <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The macro changes to.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">define</span> ac_malloc(len) _ac_malloc_d(NULL, __AC_FILE_LINE__, len)</span></code></pre></div>
<p>A NULL allocator simply means to use the global allocator.</p>
<p>The second feature is to allow for a mechanism to allow for custom content in place of the caller.  For example, if we allocate a buffer and keep changing its size, we might want to know the following: where the buffer was initialized, the maximum size of the buffer, its initial size, etc. Passing a boolean at the end denotes this custom feature, which defaults to false.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">_ac_malloc_d</span><span class="token punctuation">(</span> ac_allocator_t <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>caller<span class="token punctuation">,</span> size_t len <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>becomes</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">_ac_malloc_d</span><span class="token punctuation">(</span> ac_allocator_t <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>caller<span class="token punctuation">,</span> size_t len<span class="token punctuation">,</span> bool custom <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The macro changes to.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">define</span> ac_malloc(len) _ac_malloc_d(NULL, __AC_FILE_LINE__, len, false)</span></code></pre></div>
<p>If the custom feature is enabled, the objects need a way to dump their state to a file (or to the terminal).  In C, you can define a function pointer and then associate the pointer to functions programmatically.  An example is below.  The gist of it is that you specify the new function pointer type by surrounding the name in parenthesis and an extra asterisk.</p>
<p>For example,</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>my_function<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>would declare a function pointer type named my_function, which took no arguments and didn't return anything (it has a void return type).  I recommend using a suffix for function pointers (I'm going to use _f).  The allocator needs to define a function pointer to allow other objects to dump their details.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>ac_dump_details_f<span class="token punctuation">)</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>out<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>In C, the order of the members of a structure is also the byte order of the structure.  This is often exploited to allow a structure to be able to be cast as a structure of a different type.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  ac_dump_details_f dump<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>caller<span class="token punctuation">;</span>
<span class="token punctuation">}</span> ac_allocator_dump_t<span class="token punctuation">;</span></code></pre></div>
<p>Another useful feature is to have the state of the memory usage dumped every so often.  All this means is that if <em>AC</em>DEBUG<em>MEMORY</em> is defined as a filename, any program which uses the allocator will record all of the memory allocations every N seconds and rotate the previous snapshot.  To maintain a smaller number of output files, the rotations will rotate files with an ever-expanding gap between them.</p>
<p>The full allocator interface is below.</p>
<p>$ac/src/ac_allocator.h</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">ifndef</span> _ac_allocator_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> _ac_allocator_H</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ac_common.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token macro property">#<span class="token directive keyword">ifdef</span> _AC_DEBUG_MEMORY_</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ac_malloc(len) _ac_malloc_d(NULL, __AC_FILE_LINE__, len, false)</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ac_calloc(len) _ac_calloc_d(NULL, __AC_FILE_LINE__, len, false)</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ac_realloc(p, len) _ac_realloc_d(NULL, __AC_FILE_LINE__, p, len, false)</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ac_strdup(p) _ac_strdup_d(NULL, __AC_FILE_LINE__, p)</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ac_free(p) _ac_free_d(NULL, __AC_FILE_LINE__, p)</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
<span class="token macro property">#<span class="token directive keyword">define</span> ac_malloc(len) malloc(len)</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ac_calloc(len) calloc(1, len)</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ac_realloc(p, len) realloc(p, len)</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ac_strdup(p) strdup(p)</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ac_free(p) free(p)</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>ac_dump_details_f<span class="token punctuation">)</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>out<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  ac_dump_details_f dump<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>caller<span class="token punctuation">;</span>
<span class="token punctuation">}</span> ac_allocator_dump_t<span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">ac_allocator_s</span><span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">ac_allocator_s</span> ac_allocator_t<span class="token punctuation">;</span>

ac_allocator_t <span class="token operator">*</span><span class="token function">ac_allocator_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">ac_allocator_destroy</span><span class="token punctuation">(</span>ac_allocator_t <span class="token operator">*</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">ac_dump_global_allocations</span><span class="token punctuation">(</span>ac_allocator_t <span class="token operator">*</span>a<span class="token punctuation">,</span> FILE <span class="token operator">*</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">_ac_malloc_d</span><span class="token punctuation">(</span>ac_allocator_t <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>caller<span class="token punctuation">,</span> size_t len<span class="token punctuation">,</span> bool custom <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">_ac_calloc_d</span><span class="token punctuation">(</span>ac_allocator_t <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>caller<span class="token punctuation">,</span> size_t len<span class="token punctuation">,</span> bool custom <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">_ac_realloc_d</span><span class="token punctuation">(</span>ac_allocator_t <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>caller<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">,</span> size_t len<span class="token punctuation">,</span> bool custom<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">_ac_strdup_d</span><span class="token punctuation">(</span>ac_allocator_t <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>caller<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>p <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">_ac_free_d</span><span class="token punctuation">(</span>ac_allocator_t <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>caller<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span></code></pre></div>
<p>Before understanding the implementation, let's see how other objects and code use this.  The ac_timer.h/c will change in the following way:</p>
<p>Include ac_common.h</p>
<p>ac_timer.h</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ac_common.h"</span></span></code></pre></div>
<p>Replace</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">ac_timer_t <span class="token operator">*</span><span class="token function">ac_timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>with</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">ifdef</span> _AC_DEBUG_MEMORY_</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ac_timer_init(repeat) _ac_timer_init(repeat, AC_FILE_LINE_MACRO("ac_timer"))</span>
ac_timer_t <span class="token operator">*</span><span class="token function">_ac_timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>caller<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
<span class="token macro property">#<span class="token directive keyword">define</span> ac_timer_init(repeat) _ac_timer_init(repeat)</span>
ac_timer_t <span class="token operator">*</span><span class="token function">_ac_timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span></code></pre></div>
<p>The above code has two basic cases: one where <em>AC</em>DEBUG<em>MEMORY</em> is defined, and one where it is not (#else).  It may be easier to break this into a couple of steps.</p>
<ol>
<li>convert the init function to be prefixed with an underscore</li>
</ol>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">ac_timer_t <span class="token operator">*</span><span class="token function">ac_timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>becomes</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">ac_timer_t <span class="token operator">*</span><span class="token function">_ac_timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<ol start="2">
<li>
<p>create a macro which defines ac<em>timer</em>init as <em>ac</em>timer_init</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">define</span> ac_timer_init(repeat) _ac_timer_init(repeat)</span>
ac_timer_t <span class="token operator">*</span><span class="token function">_ac_timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
</li>
<li>
<p>define the macro if logic with the else part filled in.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">ifdef</span> _AC_DEBUG_MEMORY_</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
<span class="token macro property">#<span class="token directive keyword">define</span> ac_timer_init(repeat) _ac_timer_init(repeat)</span>
ac_timer_t <span class="token operator">*</span><span class="token function">_ac_timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span></code></pre></div>
</li>
<li>
<p>Add const char *caller to the debug version of <em>ac</em>timer_init</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">ac_timer_t <span class="token operator">*</span><span class="token function">_ac_timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>caller<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
</li>
<li>
<p>define the macro to call the init function.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">define</span> ac_timer_init(repeat) _ac_timer_init(repeat, AC_FILE_LINE_MACRO("ac_timer"))</span></code></pre></div>
</li>
<li>
<p>put the two calls in the #ifdef <em>AC</em>DEBUG<em>MEMORY</em> section.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">ifdef</span> _AC_DEBUG_MEMORY_</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ac_timer_init(repeat) _ac_timer_init(repeat, AC_FILE_LINE_MACRO("ac_timer"))</span>
ac_timer_t <span class="token operator">*</span><span class="token function">_ac_timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>caller<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
<span class="token macro property">#<span class="token directive keyword">define</span> ac_timer_init(repeat) _ac_timer_init(repeat)</span>
ac_timer_t <span class="token operator">*</span><span class="token function">_ac_timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span></code></pre></div>
</li>
</ol>
<p>Objects will typically use the AC<em>FILE</em>LINE<em>MACRO("object</em>name") when defining the init call, as in step 5 above.</p>
<p>Change ac_timer.c from</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">ac_timer_t <span class="token operator">*</span><span class="token function">ac_timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ac_timer_t <span class="token operator">*</span>t <span class="token operator">=</span> <span class="token punctuation">(</span>ac_timer_t <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>ac_timer_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>to</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">ifdef</span> _AC_DEBUG_MEMORY_</span>
ac_timer_t <span class="token operator">*</span><span class="token function">_ac_timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>caller<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ac_timer_t <span class="token operator">*</span>t <span class="token operator">=</span>
    <span class="token punctuation">(</span>ac_timer_t <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">_ac_malloc_d</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> caller<span class="token punctuation">,</span>
                                   <span class="token keyword">sizeof</span><span class="token punctuation">(</span>ac_timer_t<span class="token punctuation">)</span><span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
ac_timer_t <span class="token operator">*</span><span class="token function">_ac_timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ac_timer_t <span class="token operator">*</span>t <span class="token operator">=</span> <span class="token punctuation">(</span>ac_timer_t <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">ac_malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>ac_timer_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span></code></pre></div>
<ol>
<li>Change all malloc, calloc, strdup, realloc, and free calls to have ac_ prefix.<br/></li>
<li>Change the function name from ac<em>timer</em>init to <em>ac</em>timer_init.<br/></li>
<li>Wrap the block in a #ifdef <em>AC</em>DEBUG<em>MEMORY</em>/#else/#endif block<br/></li>
<li>Define the <em>AC</em>DEBUG<em>MEMORY</em> portion.  The <em>ac</em>timer<em>init function has the extra const char *caller parameter.  The allocation uses _ac</em>malloc_d directly, as shown above.</li>
</ol>
<p>To test these changes out, I've modified code from $ac/illustrations/2<em>timing/13</em>timer</p>
<p>The following code is found in <i>illustrations/6<em>allocator/1</em>timing</i></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token variable">$ac</span>/illustrations/6_allocator/1_timing</code></pre></div>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span>
gcc -O3 -I<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src -D_AC_DEBUG_MEMORY_<span class="token operator">=</span>NULL <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src/ac_timer.c <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src/ac_allocator.c <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src/ac_buffer.c <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src/ac_pool.c test_timer.c -o test_timer
./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse
ABCDEFGHIJKLMNOPQRSTUVWXYZ <span class="token operator">=</span><span class="token operator">></span> ZYXWVUTSRQPONMLKJIHGFEDCBA
time_spent: <span class="token number">7</span>.7260ns
Reverse <span class="token operator">=</span><span class="token operator">></span> esreveR
time_spent: <span class="token number">1</span>.8180ns
overall time_spent: <span class="token number">9</span>.5440ns
<span class="token number">99</span> byte<span class="token punctuation">(</span>s<span class="token punctuation">)</span> allocated <span class="token keyword">in</span> <span class="token number">4</span> allocations <span class="token punctuation">(</span><span class="token number">160</span> byte<span class="token punctuation">(</span>s<span class="token punctuation">)</span> overhead<span class="token punctuation">)</span>
test_timer.c:24: <span class="token number">27</span>
test_timer.c:26 <span class="token punctuation">[</span>ac_timer<span class="token punctuation">]</span>: <span class="token number">32</span>
test_timer.c:24: <span class="token number">8</span>
test_timer.c:26 <span class="token punctuation">[</span>ac_timer<span class="token punctuation">]</span>: <span class="token number">32</span></code></pre></div>
<p>Include ac<em>allocator.h in test</em>timer.c</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ac_allocator.h"</span></span></code></pre></div>
<p>and alter the malloc and free calls to ac<em>malloc and ac</em>free.  I've intentionally commented out several destroy calls and the ac_free call.</p>
<p>When make was run above, the following extra lines were output</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">99 byte(s) allocated in 4 allocations (160 byte(s) overhead)
test_timer.c:24: 27
test_timer.c:26 [ac_timer]: 32
test_timer.c:24: 8
test_timer.c:26 [ac_timer]: 32</code></pre></div>
<p>This indicates that 4 allocations were not properly freed.</p>
<p>line 24</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">ac_malloc</span><span class="token punctuation">(</span>len<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>line 26</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">ac_timer_t <span class="token operator">*</span>copy_timer <span class="token operator">=</span> <span class="token function">ac_timer_init</span><span class="token punctuation">(</span><span class="token function">ac_timer_get_repeat</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>To fix the code, we need to make sure that copy_timer is destroyed and s is freed.  Lines 47-48 are what need uncommented to make this work.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// ac_timer_destroy(copy_timer);</span>
<span class="token comment">// ac_free(s);</span></code></pre></div>
<p>The error reported logged the ac<em>timer</em>init line as opposed to the ac<em>malloc inside of ac</em>timer_init.  This is likely more useful unless you are testing the individual object.</p>
<p>Go ahead and uncomment those lines and run make again</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span>
gcc -O3 -I<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src -D_AC_DEBUG_MEMORY_<span class="token operator">=</span>NULL <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src/ac_timer.c <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src/ac_allocator.c <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src/ac_buffer.c <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src/ac_pool.c test_timer.c -o test_timer
./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse
ABCDEFGHIJKLMNOPQRSTUVWXYZ <span class="token operator">=</span><span class="token operator">></span> ZYXWVUTSRQPONMLKJIHGFEDCBA
time_spent: <span class="token number">7</span>.7260ns
Reverse <span class="token operator">=</span><span class="token operator">></span> esreveR
time_spent: <span class="token number">1</span>.8180ns
overall time_spent: <span class="token number">9</span>.5440ns</code></pre></div>
<p>Go ahead and revert your changes.  You can revert your changes in the current directory by running the following git command.  If you don't specify the ., then it will revert all changes in the whole repo (so this command can be somewhat dangerous!)</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> checkout <span class="token builtin class-name">.</span></code></pre></div>
<p>The lines indicating memory loss are no longer printed.  In this example, <em>AC</em>DEBUG<em>MEMORY</em> was defined as NULL in the Makefile using the following line.</p>
<div class="gatsby-highlight" data-language="makefile"><pre class="language-makefile"><code class="language-makefile">FLAGS <span class="token operator">+=</span> -D_AC_DEBUG_MEMORY_<span class="token operator">=</span>NULL</code></pre></div>
<p>If we change this to</p>
<div class="gatsby-highlight" data-language="makefile"><pre class="language-makefile"><code class="language-makefile">FLAGS <span class="token operator">+=</span> -D_AC_DEBUG_MEMORY_<span class="token operator">=</span>\"memory.log\"</code></pre></div>
<p>run</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">make</span> clean</code></pre></div>
<p>and then</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span>
gcc -O3 -I<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src -D_AC_DEBUG_MEMORY_<span class="token operator">=</span><span class="token punctuation">\</span>"memory.log<span class="token punctuation">\</span>" <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src/ac_timer.c <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src/ac_allocator.c <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src/ac_buffer.c <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src/ac_pool.c test_timer.c -o test_timer
./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse
ABCDEFGHIJKLMNOPQRSTUVWXYZ <span class="token operator">=</span><span class="token operator">></span> ZYXWVUTSRQPONMLKJIHGFEDCBA
time_spent: <span class="token number">5</span>.9220ns
Reverse <span class="token operator">=</span><span class="token operator">></span> esreveR
time_spent: <span class="token number">1</span>.5720ns
overall time_spent: <span class="token number">7</span>.4940ns</code></pre></div>
<p>There is a new file called memory.log in this directory.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">ls</span>
Makefile	memory.log	test_timer	test_timer.c</code></pre></div>
<p>You can view memory.log by running</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">cat</span> memory.log
<span class="token number">99</span> byte<span class="token punctuation">(</span>s<span class="token punctuation">)</span> allocated <span class="token keyword">in</span> <span class="token number">4</span> allocations <span class="token punctuation">(</span><span class="token number">160</span> byte<span class="token punctuation">(</span>s<span class="token punctuation">)</span> overhead<span class="token punctuation">)</span>
test_timer.c:24: <span class="token number">27</span>
test_timer.c:26 <span class="token punctuation">[</span>ac_timer<span class="token punctuation">]</span>: <span class="token number">32</span>
test_timer.c:24: <span class="token number">8</span>
test_timer.c:26 <span class="token punctuation">[</span>ac_timer<span class="token punctuation">]</span>: <span class="token number">32</span></code></pre></div>
<p>If you view the test<em>timer.c code, you will notice that a significant portion of the main function now has the ac</em> prefix.</p>
<p>test_timer.c (main function)</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> repeat_test <span class="token operator">=</span> <span class="token number">1000000</span><span class="token punctuation">;</span>
  ac_timer_t <span class="token operator">*</span>overall_timer <span class="token operator">=</span> <span class="token function">ac_timer_init</span><span class="token punctuation">(</span>repeat_test<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>argc<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    size_t len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">ac_malloc</span><span class="token punctuation">(</span>len<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    ac_timer_t <span class="token operator">*</span>copy_timer <span class="token operator">=</span> <span class="token function">ac_timer_init</span><span class="token punctuation">(</span><span class="token function">ac_timer_get_repeat</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ac_timer_start</span><span class="token punctuation">(</span>copy_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>repeat_test<span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">strcpy</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">ac_timer_stop</span><span class="token punctuation">(</span>copy_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    ac_timer_t <span class="token operator">*</span>test_timer <span class="token operator">=</span> <span class="token function">ac_timer_init</span><span class="token punctuation">(</span><span class="token function">ac_timer_get_repeat</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ac_timer_start</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>repeat_test<span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">strcpy</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">reverse_string</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">ac_timer_stop</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ac_timer_subtract</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">,</span> copy_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ac_timer_add</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">,</span> test_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s => %s\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"time_spent: %0.4fns\n"</span><span class="token punctuation">,</span> <span class="token function">ac_timer_ns</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">ac_timer_destroy</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ac_timer_destroy(copy_timer);</span>
    <span class="token comment">// ac_free(s);</span>
  <span class="token punctuation">}</span>
  <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"overall time_spent: %0.4fns\n"</span><span class="token punctuation">,</span> <span class="token function">ac_timer_ns</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ac_timer_destroy</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Breaking out all of the ac_ statements:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">  ac_timer_t <span class="token operator">*</span>overall_timer <span class="token operator">=</span> <span class="token function">ac_timer_init</span><span class="token punctuation">(</span>repeat_test<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">ac_malloc</span><span class="token punctuation">(</span>len<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    ac_timer_t <span class="token operator">*</span>copy_timer <span class="token operator">=</span> <span class="token function">ac_timer_init</span><span class="token punctuation">(</span><span class="token function">ac_timer_get_repeat</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ac_timer_start</span><span class="token punctuation">(</span>copy_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">ac_timer_stop</span><span class="token punctuation">(</span>copy_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    ac_timer_t <span class="token operator">*</span>test_timer <span class="token operator">=</span> <span class="token function">ac_timer_init</span><span class="token punctuation">(</span><span class="token function">ac_timer_get_repeat</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ac_timer_start</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">ac_timer_stop</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ac_timer_subtract</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">,</span> copy_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ac_timer_add</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">,</span> test_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">ac_timer_destroy</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ac_timer_destroy(copy_timer);</span>
    <span class="token comment">// ac_free(s);</span>
  <span class="token function">ac_timer_destroy</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>If you mentally note that ac is just a prefix and view the code as</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">timer_t <span class="token operator">*</span>overall_timer <span class="token operator">=</span> <span class="token function">timer_init</span><span class="token punctuation">(</span>repeat_test<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>len<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  timer_t <span class="token operator">*</span>copy_timer <span class="token operator">=</span> <span class="token function">timer_init</span><span class="token punctuation">(</span><span class="token function">timer_get_repeat</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">timer_start</span><span class="token punctuation">(</span>copy_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">timer_stop</span><span class="token punctuation">(</span>copy_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>

  timer_t <span class="token operator">*</span>test_timer <span class="token operator">=</span> <span class="token function">timer_init</span><span class="token punctuation">(</span><span class="token function">timer_get_repeat</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">timer_start</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">timer_stop</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">timer_subtract</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">,</span> copy_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">timer_add</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">,</span> test_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">timer_destroy</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// timer_destroy(copy_timer);</span>
  <span class="token comment">// free(s);</span>
<span class="token function">timer_destroy</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>You can see that there are timer objects, malloc, and free.  Given that malloc, calloc, realloc, strdup, and free are so common in code, I opted not to provide any extra qualifiers other than ac.  I aim to make code highly optimized and very readable.  Another important feature of qualified naming is that it makes it possible to search for all places something exists.  For example, to find all cases where ac_timer are used, you can run..</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token variable">$ac</span>/illustrations
<span class="token function">grep</span> -rn ac_timer <span class="token builtin class-name">.</span></code></pre></div>
<p>and your output might look like...</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">./2_timing/12_timer/test_timer.c:1:#include &quot;ac_timer.h&quot;
./2_timing/12_timer/test_timer.c:20:  ac_timer_t *overall_timer = ac_timer_init(repeat_test);
./2_timing/12_timer/test_timer.c:25:    ac_timer_t *copy_timer = ac_timer_init(ac_timer_get_repeat(overall_timer));
./2_timing/12_timer/test_timer.c:26:    ac_timer_start(copy_timer);
./2_timing/12_timer/test_timer.c:30:    ac_timer_stop(copy_timer);
./2_timing/12_timer/test_timer.c:32:    ac_timer_t *test_timer = ac_timer_init(ac_timer_get_repeat(overall_timer));
./2_timing/12_timer/test_timer.c:33:    ac_timer_start(test_timer);
./2_timing/12_timer/test_timer.c:38:    ac_timer_stop(test_timer);
./2_timing/12_timer/test_timer.c:39:    ac_timer_subtract(test_timer, copy_timer);
./2_timing/12_timer/test_timer.c:40:    ac_timer_add(overall_timer, test_timer);
./2_timing/12_timer/test_timer.c:43:    printf( &quot;time_spent: %0.4fns\n&quot;, ac_timer_ns(test_timer) );
./2_timing/12_timer/test_timer.c:45:    ac_timer_destroy(test_timer);
./2_timing/12_timer/test_timer.c:46:    ac_timer_destroy(copy_timer);
./2_timing/12_timer/test_timer.c:49:  printf( &quot;overall time_spent: %0.4fns\n&quot;, ac_timer_ns(overall_timer) );
./2_timing/12_timer/test_timer.c:50:  ac_timer_destroy(overall_timer);
./2_timing/12_timer/Makefile:2:OBJECTS=$(ROOT)/src/ac_timer.c
./2_timing/12_timer/Makefile:3:HEADER_FILES=$(ROOT)/src/ac_timer.h
Binary file ./2_timing/12_timer/test_timer matches
./2_timing/13_timer/test_timer.c:1:#include &quot;ac_timer.h&quot;
./2_timing/13_timer/test_timer.c:20:  ac_timer_t *overall_timer = ac_timer_init(repeat_test);
./2_timing/13_timer/test_timer.c:25:    ac_timer_t *copy_timer = ac_timer_init(ac_timer_get_repeat(overall_timer));
./2_timing/13_timer/test_timer.c:26:    ac_timer_start(copy_timer);
./2_timing/13_timer/test_timer.c:30:    ac_timer_stop(copy_timer);
...</code></pre></div>
<p>This feature alone is extremely valuable when working with a large codebase.  It takes longer to write each line of code, but the reader can easily find every line of code where the object is used.  This makes it easier to find example code and to build upon the work of others.</p>
<h1 id="a-quick-recap"><a href="#a-quick-recap" aria-label="a quick recap permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A Quick Recap</h1>
<ol>
<li>
<p>The 5 basic allocation methods in C are...</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">malloc</span><span class="token punctuation">(</span>size_t len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">calloc</span><span class="token punctuation">(</span>size_t num<span class="token punctuation">,</span> size_t len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">realloc</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">,</span> size_t len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">strdup</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">free</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
</li>
<li>We define those functions with the ac_ prefix such that if we are debugging memory, we can track where the allocations are made.  This allows us to recognize memory leaks and potentially a couple of other common errors.</li>
<li>Callback functions should have a suffix of _f</li>
<li>We defined an approach to find when objects are created (and not destroyed).  The basic changes to ac<em>timer were outlined to make it support using the ac</em>allocator.</li>
<li>When we are using the ac<em>allocator object outside of objects, the only change to the code is to replace the 5 basic allocation methods with `ac</em>...` If, for some reason, you do not wish to allocate memory using the ac method, then make sure that you don't free it with the ac method.</li>
<li>We can define <em>AC</em>DEBUG<em>MEMORY</em> as NULL and have memory leaks reported to the terminal when the program exits.</li>
</ol>
<div class="gatsby-highlight" data-language="makefile"><pre class="language-makefile"><code class="language-makefile">FLAGS <span class="token operator">+=</span> -D_AC_DEBUG_MEMORY_<span class="token operator">=</span>\"memory.log\"</code></pre></div>
<ol start="7">
<li>We can define <em>AC</em>DEBUG<em>MEMORY</em> as a string and have memory leaks reported to a file periodically.  The period is defined in seconds as <em>AC</em>DEBUG<em>MEMORY</em>SPEED_ and defaults to 60 in ac_common.h</li>
<li>You can grep for any line of code which contains an object using the following approach.  The following grep line will search all subdirectories for the string ac_timer and report the filename and line number where the text is found.</li>
</ol>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">grep</span> -rn ac_timer <span class="token builtin class-name">.</span></code></pre></div>
<p>ac_timer can be replaced with a function name or another object name (or whatever you want to find).</p>
<h1 id="continue-to-build-out-the-allocator-implementation"><a href="#continue-to-build-out-the-allocator-implementation" aria-label="continue to build out the allocator implementation permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Continue to build out the <a href="8_allocator_impl.md">allocator implementation</a>!</h1>
<p><a href="../README.md">Table of Contents</a>  - Copyright 2019 Andy Curtis</p></div></div><div style="font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif;width:400px;height:100vh;padding:15px;color:#1E4E8C;position:sticky;top:62px;border-left:solid 1px #EDF2F7" class="Sidebar"><div><div><a href="/ebook/1-getting-started">1. Getting Started</a></div><div><a href="/ebook/10-binary-search-trees">10. Binary Search Trees</a></div><div><a href="/ebook/11-balancing-binary-search-trees">11. Balancing Binary Search Trees</a></div><div><a href="/ebook/12-red-black-tree">12. The Red-Black Tree</a></div><div><a href="/ebook/13-map">13. The Map Object</a></div><div><a href="/ebook/14-set-and-multimap">14. The Set and Multimap</a></div><div><a href="/ebook/2-timing">2. Timing Your Code</a></div><div><a href="/ebook/3-buffer">3. The Buffer Object</a></div><div><a href="/ebook/4-linked-lists">4. Linked Lists</a></div><div><a href="/ebook/5-threads">5. Introducing Threads</a></div><div><a href="/ebook/6-macros">6. Macros</a></div><div><a href="/ebook/7-allocator">7. The Global Allocator Object</a></div><div><a href="/ebook/8-allocator-implementation">8. The Global Allocator Implementation</a></div><div><a href="/ebook/9-pool">9. The Pool Object</a></div></div></div></div></main><footer style="background-color:#1A202C;padding:10px;color:white;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif"><div class="Footer"><div><h1 style="margin-bottom:5px">Another C Library</h1><p style="margin-bottom:15px">© <!-- -->2019<!-- --> Andy Curtis &amp; Daniel Curtis</p><ul style="list-style:none;margin-left:0"><li><a style="color:#3182CE" href="/contact">Contact</a></li><li><a style="color:#3182CE" href="/contributing">Contributing</a></li><li><a style="color:#3182CE" href="/license">License</a></li></ul></div><div><h2 style="margin:10px auto">A C eBook</h2><ul style="list-style:none;margin-left:0"><li><a href="/ebook/1-getting-started">1. Getting Started</a></li><li><a href="/ebook/10-binary-search-trees">10. Binary Search Trees</a></li><li><a href="/ebook/11-balancing-binary-search-trees">11. Balancing Binary Search Trees</a></li><li><a href="/ebook/12-red-black-tree">12. The Red-Black Tree</a></li><li><a href="/ebook/13-map">13. The Map Object</a></li><li><a href="/ebook/14-set-and-multimap">14. The Set and Multimap</a></li><li><a href="/ebook/2-timing">2. Timing Your Code</a></li><li><a href="/ebook/3-buffer">3. The Buffer Object</a></li><li><a href="/ebook/4-linked-lists">4. Linked Lists</a></li><li><a href="/ebook/5-threads">5. Introducing Threads</a></li><li><a href="/ebook/6-macros">6. Macros</a></li><li><a href="/ebook/7-allocator">7. The Global Allocator Object</a></li><li><a href="/ebook/8-allocator-implementation">8. The Global Allocator Implementation</a></li><li><a href="/ebook/9-pool">9. The Pool Object</a></li></ul></div><div><h2 style="margin:10px auto">Resources</h2><ul style="list-style:none;margin-left:0"><li><a href="https://medium.com/software-design/why-software-developers-should-care-about-cpu-caches-8da04355bb8a" target="_blank" rel="noopener noreferrer" style="color:#3182CE">Why software developers should care about CPU caches <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"></path></svg></a></li><li><a href="https://github.com/contactandyc/another-c-library/blob/master/docs/tips.md#create-multiline-macro-in-c" target="_blank" rel="noopener noreferrer" style="color:#3182CE">Helpful Tips for Formatting <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"></path></svg></a></li><li><a href="https://mitpress.mit.edu/books/introduction-algorithms-third-edition" target="_blank" rel="noopener noreferrer" style="color:#3182CE">Introduction to Alogorithms <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"></path></svg></a></li></ul></div></div></footer></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/ebook/7-allocator/";window.webpackCompilationHash="8913fc5500708dd393f4";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-95ebc95ba4fb3bc2dd23.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-2089f767561e6aa92a7f.js"],"component---src-templates-ebook-page-js":["/component---src-templates-ebook-page-js-fe8bc0f2c932eda75c4a.js"],"component---src-pages-404-js":["/component---src-pages-404-js-a5fd40ab0bd43785175c.js"],"component---src-pages-contact-js":["/component---src-pages-contact-js-fb76d9a5164a1f2eede1.js"],"component---src-pages-contributing-js":["/component---src-pages-contributing-js-80166a10b44da213f86c.js"],"component---src-pages-docs-js":["/component---src-pages-docs-js-5f1ad25153678f862f92.js"],"component---src-pages-ebook-js":["/component---src-pages-ebook-js-62ae33890356a1602f60.js"],"component---src-pages-index-js":["/component---src-pages-index-js-d1c647469039ae7263dc.js"],"component---src-pages-license-js":["/component---src-pages-license-js-5dac97904724019f2a51.js"]};/*]]>*/</script><script src="/webpack-runtime-3090066330befb922a07.js" async=""></script><script src="/styles-8648ad68e26f3992ff5c.js" async=""></script><script src="/app-95ebc95ba4fb3bc2dd23.js" async=""></script><script src="/commons-0ae7f027867ef630b05a.js" async=""></script><script src="/component---src-templates-ebook-page-js-fe8bc0f2c932eda75c4a.js" async=""></script></body></html>