<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.45 'georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'georgia',serif;font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}ul{margin-left:1.45rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.45rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;font-size:0.85rem;line-height:1.45rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}blockquote{margin-left:1.45rem;margin-right:1.45rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.45rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.45rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.45rem;margin-bottom:calc(1.45rem / 2);margin-top:calc(1.45rem / 2);}li > ul{margin-left:1.45rem;margin-bottom:calc(1.45rem / 2);margin-top:calc(1.45rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.45rem / 2);}code{font-size:0.85rem;line-height:1.45rem;}kbd{font-size:0.85rem;line-height:1.45rem;}samp{font-size:0.85rem;line-height:1.45rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:0.96667rem;padding-right:0.96667rem;padding-top:0.725rem;padding-bottom:calc(0.725rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}</style><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><title data-react-helmet="true">3. The Buffer Object | Another C Library</title><meta data-react-helmet="true" name="description" content="A documentation site for Another C Library."/><meta data-react-helmet="true" property="og:title" content="3. The Buffer Object"/><meta data-react-helmet="true" property="og:description" content="A documentation site for Another C Library."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Daniel Curtis"/><meta data-react-helmet="true" name="twitter:title" content="3. The Buffer Object"/><meta data-react-helmet="true" name="twitter:description" content="A documentation site for Another C Library."/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="shortcut icon" href="/icons/icon-48x48.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="generator" content="Gatsby 2.16.1"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><style data-href="/styles.76de3f2cf006b94d06b5.css">code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}a{text-decoration:none;cursor:pointer;color:#3182ce}a:hover{text-decoration:underline}button:hover{-webkit-transition:.6s;transition:.6s;-webkit-filter:brightness(115%);filter:brightness(115%)}nav{display:flex;align-items:center}li{margin-bottom:3px}pre[class*=language-]{background:#1a202c;overflow-x:scroll}:not(pre)>code[class*=language-],pre[class*=language-]{border-radius:0;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;text-shadow:none}:not(pre)>code[class*=language-]{background:#edf2f7;color:#000;padding:3px}.Footer{max-width:1200px;margin:30px auto;display:flex;justify-content:space-between}.Flex{display:grid;grid-template-columns:auto auto;grid-column-gap:50px}.Content{max-width:950px;width:72vw}@media only screen and (max-width:600px){.Footer,nav{flex-direction:column}.Flex{grid-template-columns:auto}.Sidebar{display:none}.Content{width:100%}}</style><link as="script" rel="preload" href="/component---src-templates-ebook-page-js-4e3a1b55402746ff3b7a.js"/><link as="script" rel="preload" href="/commons-0ae7f027867ef630b05a.js"/><link as="script" rel="preload" href="/app-95ebc95ba4fb3bc2dd23.js"/><link as="script" rel="preload" href="/styles-1b0337c96e7c47d59c08.js"/><link as="script" rel="preload" href="/webpack-runtime-bcb22306b53b567f461a.js"/><link as="fetch" rel="preload" href="/page-data/ebook/3-buffer/page-data.json" crossorigin="anonymous"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div style="background-color:white"><header style="position:sticky;top:0;background-color:#1A202C;z-index:1"><nav style="margin:auto;max-width:1200px"><a style="color:white;font-size:1.25rem;padding:1rem 1.5rem;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif" href="/"><span style="font-weight:700">Another C Library</span></a><a style="color:white;font-size:1.25rem;padding:1rem 1.5rem;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif" href="/docs/">Documentation</a><a style="color:#38A169;font-size:1.25rem;padding:1rem 1.5rem;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif;border-bottom:solid 4px #2F855A;background-color:#2D3748" class="" href="/ebook/">A C eBook</a><a style="color:white;font-size:1.25rem;padding:1rem 1.5rem;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif" target="_blank" rel="noopener noreferrer" href="https://github.com/contactandyc/another-c-library">Github <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" style="padding-top:5px" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"></path></svg></a></nav></header><main><div style="margin:0 auto;max-width:1200px;display:flex"><div style="color:black;margin:0;padding:20px" class="Content"><h1>3. The Buffer Object</h1><div><p>Copyright 2019 Andy Curtis &#x26; Daniel Curtis</p>
<h1 id="the-buffer-object"><a href="#the-buffer-object" aria-label="the buffer object permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Buffer Object</h1>
<h2 id="how-it-compares-to-other-languages"><a href="#how-it-compares-to-other-languages" aria-label="how it compares to other languages permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How it compares to other languages</h2>
<p>hello_buffer.c</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"buffer.h"</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  buffer_t <span class="token operator">*</span>bh <span class="token operator">=</span> <span class="token function">buffer_init</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">buffer_sets</span><span class="token punctuation">(</span>bh<span class="token punctuation">,</span> <span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">buffer_appendc</span><span class="token punctuation">(</span>bh<span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">buffer_appendf</span><span class="token punctuation">(</span>bh<span class="token punctuation">,</span> <span class="token string">"%s!"</span><span class="token punctuation">,</span> <span class="token string">"Buffer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/* print Hello Buffer! followed with a newline */</span>
  <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"%s\n"</span><span class="token punctuation">,</span> <span class="token function">buffer_data</span><span class="token punctuation">(</span>bh<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">buffer_destroy</span><span class="token punctuation">(</span>bh<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>building:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/contactandyc/realtime.git
<span class="token builtin class-name">cd</span> illustrations/buffer/1_buffer
gcc hello_buffer.c buffer.c -o hello_buffer</code></pre></div>
<p>output</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ ./hello_buffer
Hello Buffer<span class="token operator">!</span>
$</code></pre></div>
<p>Instead of <i>gcc hello...</i>, you can run</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">make</span></code></pre></div>
<p>make will build and run hello_buffer along with a few more example programs.  If git, gcc, or make fail, you may need to install them.  Refer to your favorite search engine and find a tutorial on how to install them on your platform.</p>
<p>If the code above were written in other languages, it might look like</p>
<p>Python</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">bh <span class="token operator">=</span> <span class="token string">"Hello"</span>
bh <span class="token operator">+=</span> <span class="token string">" "</span>
bh <span class="token operator">+=</span> <span class="token string">"{0}!"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"Buffer"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>bh<span class="token punctuation">)</span></code></pre></div>
<p>Javascript</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> bh <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span>
bh <span class="token operator">+=</span> <span class="token string">" "</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token string">"Buffer"</span><span class="token punctuation">;</span>
bh <span class="token operator">+=</span> buffer <span class="token operator">+</span> <span class="token string">"!"</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bh<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>C++</p>
<div class="gatsby-highlight" data-language="cpp"><pre class="language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  std<span class="token operator">::</span>string s <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  s <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  s <span class="token operator">+=</span> std<span class="token operator">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  s <span class="token operator">+=</span> std<span class="token operator">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">"Buffer"</span><span class="token punctuation">)</span> <span class="token operator">+</span> std<span class="token operator">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">"!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> s <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>and so on.</p>
<p>buffer.h is part of this project (it'll later be changed to ac_buffer.h).  ac stands for another c library.  C doesn't have a built-in mechanism to handle growing strings or arrays.  Anyone who has done C will have created an object like buffer or reused someone else's code.  I'm just attempting to create standardized objects which others can use.</p>
<h2 id="a-bit-of-history-and-setup"><a href="#a-bit-of-history-and-setup" aria-label="a bit of history and setup permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A bit of history and setup</h2>
<p>To build solid C code, you need to build reusable objects.  Those objects will then often be used to build larger objects.  The buffer has been one of the most used objects throughout my career.  In other languages, it would generally replace the string and the array.  This object will change in its final form as this object ultimately will build upon another object, which I've called <b>pool</b> that is also one of my goto objects.  The pool will be described after the section on linked structures.  This object plays an important role in printing binary search trees (described in the linked structures section).  </p>
<p>The interface for buffer is found in buffer.h.  This interface must be included for the c compiler to be able to prepare the code to be converted to a binary properly.  The implementation for buffer is found in buffer.c, and in our example above, we include that in the gcc compilation.  It isn't my goal to explain C in this book, but I will cover some of the language aspects as I go.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"buffer.h"</span></span></code></pre></div>
<p>Every good C program that is capable of being executed has the main function.  The main function is typically implemented with the following two parameters to allow command-line arguments to be passed to the program.  argc represents the number of arguments (the name of the program is the 1st argument).  argv represents the arguments.  argv[0] references the name of the program as called from the command line.  The main function returns an integer.  If the program executes successfully, it should return 0.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Most of the objects you will create throughout the book will be named <i>object<em>name</i></em>t.  Functions that pertain to the object will be named <i>object<em>name</i></em><i>function<em>name</i>.  Many of the objects can be created through <i>object</em>name</i><em>init and destroyed using <i>object</em>name</i>_destroy.  Sometimes there will be alternate init functions, and less frequently alternate destroy functions.  In general, if you init an object, you are expected to destroy the object later.  Objects will not just automatically disappear (unless the pool is used, which we will discuss later).</p>
<p>The init function expects that you provide a hint as to how much memory your application might need.  If you specify too many bytes, your program will consume extra memory needlessly.  If you specify too small of a number, the buffer object will automatically grow as needed.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">buffer_t <span class="token operator">*</span>bh <span class="token operator">=</span> <span class="token function">buffer_init</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token function">buffer_destroy</span><span class="token punctuation">(</span>bh<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Set the buffer (bh) to have the string "Hello"</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token function">buffer_sets</span><span class="token punctuation">(</span>bh<span class="token punctuation">,</span> <span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Append a space to the buffer (bh)</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token function">buffer_appendc</span><span class="token punctuation">(</span>bh<span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Append a formatted string where %s gets replaced with the word "Buffer" to the buffer (bh)</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token function">buffer_appendf</span><span class="token punctuation">(</span>bh<span class="token punctuation">,</span> <span class="token string">"%s!"</span><span class="token punctuation">,</span> <span class="token string">"Buffer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>This is just a comment in C.  You can also have comments that extend to the end of the line using // comment</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">/* print Hello Buffer! followed with a newline */</span></code></pre></div>
<p>Print the contents of the buffer (bh) by using the buffer_data(bh) to access its contents.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"%s\n"</span><span class="token punctuation">,</span> <span class="token function">buffer_data</span><span class="token punctuation">(</span>bh<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2 id="the-buffer-interface"><a href="#the-buffer-interface" aria-label="the buffer interface permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The buffer interface</h2>
<p>Buffer defines several other functions which will be described shortly.  Here is the full interface used for this tutorial.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">ifndef</span> _buffer_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> _buffer_H</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdarg.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdbool.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">struct</span> <span class="token class-name">buffer_s</span><span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">buffer_s</span> buffer_t<span class="token punctuation">;</span>

<span class="token comment">/* initial size of the buffer, buffer will grow as needed */</span>
buffer_t <span class="token operator">*</span><span class="token function">buffer_init</span><span class="token punctuation">(</span>size_t initial_size<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* clear the buffer */</span>
<span class="token keyword">void</span> <span class="token function">buffer_clear</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* get the contents of the buffer */</span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">buffer_data</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* get the length of the buffer */</span>
size_t <span class="token function">buffer_length</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* append bytes to the current buffer */</span>
<span class="token keyword">void</span> <span class="token function">buffer_append</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* append a string to the current buffer */</span>
<span class="token keyword">void</span> <span class="token function">buffer_appends</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* append a character to the current buffer */</span>
<span class="token keyword">void</span> <span class="token function">buffer_appendc</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">char</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* append a character n times to the current buffer */</span>
<span class="token keyword">void</span> <span class="token function">buffer_appendn</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">char</span> ch<span class="token punctuation">,</span> ssize_t n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* append bytes in current buffer using va_args and formatted string */</span>
<span class="token keyword">void</span> <span class="token function">buffer_appendvf</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>fmt<span class="token punctuation">,</span> va_list args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* append bytes in current buffer using a formatted string -similar to printf */</span>
<span class="token keyword">void</span> <span class="token function">buffer_appendf</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>fmt<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* set bytes to the current buffer */</span>
<span class="token keyword">void</span> <span class="token function">buffer_set</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* set a string to the current buffer */</span>
<span class="token keyword">void</span> <span class="token function">buffer_sets</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* set a character to the current buffer */</span>
<span class="token keyword">void</span> <span class="token function">buffer_setc</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">char</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* set a character n times to the current buffer */</span>
<span class="token keyword">void</span> <span class="token function">buffer_setn</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">char</span> ch<span class="token punctuation">,</span> ssize_t n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* set bytes in current buffer using va_args and formatted string */</span>
<span class="token keyword">void</span> <span class="token function">buffer_setvf</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>fmt<span class="token punctuation">,</span> va_list args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* set bytes in current buffer using a formatted string -similar to printf */</span>
<span class="token keyword">void</span> <span class="token function">buffer_setf</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>fmt<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* resize the buffer and return a pointer to the beginning of the buffer.  This
   will retain the original data in the buffer for up to length bytes. */</span>
<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">buffer_resize</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* grow the buffer by length bytes and return pointer to the new memory.  This
   will retain the original data in the buffer for up to length bytes. */</span>
<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">buffer_append_alloc</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* resize the buffer and return a pointer to the beginning of the buffer.  This
   will NOT retain the original data in the buffer for up to length bytes. */</span>
<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">buffer_alloc</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* destroy the buffer */</span>
<span class="token keyword">void</span> <span class="token function">buffer_destroy</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span></code></pre></div>
<p>Notice there aren't any details as to how the buffer is implemented in the interface.  It is very important to separate interfaces from implementations.  If you do this, you continually improve upon the interface.  If hardware changes over time, you can reimplement the implementation part as needed without affecting the rest of the codebases.  Getting interfaces right is somewhat of an art.  There is a balance between getting specific work done and creating reusable objects.  One element of the coding style that I use is that you can use <b>grep</b> to find every line where a given object is used.  I'm not alone in using this coding style.  Projects like libcurl, libuv (behind Google Chrome), and others use similar approaches.</p>
<h2 id="the-implementation"><a href="#the-implementation" aria-label="the implementation permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The implementation</h2>
<p>buffer.c</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"buffer.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token keyword">struct</span> <span class="token class-name">buffer_s</span> <span class="token punctuation">{</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>data<span class="token punctuation">;</span>
  size_t length<span class="token punctuation">;</span>
  size_t size<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

buffer_t <span class="token operator">*</span><span class="token function">buffer_init</span><span class="token punctuation">(</span>size_t initial_size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  buffer_t <span class="token operator">*</span>h <span class="token operator">=</span> <span class="token punctuation">(</span>buffer_t <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>initial_size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>size <span class="token operator">=</span> initial_size<span class="token punctuation">;</span>
  <span class="token keyword">return</span> h<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">buffer_clear</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  h<span class="token operator">-></span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">buffer_destroy</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">free</span><span class="token punctuation">(</span>h<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">free</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">buffer_data</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> h<span class="token operator">-></span>data<span class="token punctuation">;</span> <span class="token punctuation">}</span>
size_t <span class="token function">buffer_length</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> h<span class="token operator">-></span>length<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">_buffer_grow</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  size_t len <span class="token operator">=</span> <span class="token punctuation">(</span>length <span class="token operator">+</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>h<span class="token operator">-></span>size <span class="token operator">>></span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">memcpy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> h<span class="token operator">-></span>data<span class="token punctuation">,</span> h<span class="token operator">-></span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">free</span><span class="token punctuation">(</span>h<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>
  h<span class="token operator">-></span>size <span class="token operator">=</span> len<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">buffer_resize</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">></span> h<span class="token operator">-></span>size<span class="token punctuation">)</span>
    <span class="token function">_buffer_grow</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>length <span class="token operator">=</span> length<span class="token punctuation">;</span>
  h<span class="token operator">-></span>data<span class="token punctuation">[</span>h<span class="token operator">-></span>length<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> h<span class="token operator">-></span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">buffer_append_alloc</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">+</span> h<span class="token operator">-></span>length <span class="token operator">></span> h<span class="token operator">-></span>size<span class="token punctuation">)</span>
    <span class="token function">_buffer_grow</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> length <span class="token operator">+</span> h<span class="token operator">-></span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>r <span class="token operator">=</span> h<span class="token operator">-></span>data <span class="token operator">+</span> h<span class="token operator">-></span>length<span class="token punctuation">;</span>
  h<span class="token operator">-></span>length <span class="token operator">+=</span> length<span class="token punctuation">;</span>
  r<span class="token punctuation">[</span>h<span class="token operator">-></span>length<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> r<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">_buffer_append</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">,</span>
                                  size_t length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>h<span class="token operator">-></span>length <span class="token operator">+</span> length <span class="token operator">></span> h<span class="token operator">-></span>size<span class="token punctuation">)</span>
    <span class="token function">_buffer_grow</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> h<span class="token operator">-></span>length <span class="token operator">+</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">memcpy</span><span class="token punctuation">(</span>h<span class="token operator">-></span>data <span class="token operator">+</span> h<span class="token operator">-></span>length<span class="token punctuation">,</span> data<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>length <span class="token operator">+=</span> length<span class="token punctuation">;</span>
  h<span class="token operator">-></span>data<span class="token punctuation">[</span>h<span class="token operator">-></span>length<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">buffer_append</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">_buffer_append</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> data<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">buffer_appends</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">_buffer_append</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">buffer_appendc</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">char</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>h<span class="token operator">-></span>length <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">></span> h<span class="token operator">-></span>size<span class="token punctuation">)</span>
    <span class="token function">_buffer_grow</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> h<span class="token operator">-></span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">char</span> <span class="token operator">*</span>d <span class="token operator">=</span> h<span class="token operator">-></span>data <span class="token operator">+</span> h<span class="token operator">-></span>length<span class="token punctuation">;</span>
  <span class="token operator">*</span>d<span class="token operator">++</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span>
  <span class="token operator">*</span>d <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>length<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">buffer_appendn</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">char</span> ch<span class="token punctuation">,</span> ssize_t n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>h<span class="token operator">-></span>length <span class="token operator">+</span> n <span class="token operator">></span> h<span class="token operator">-></span>size<span class="token punctuation">)</span>
    <span class="token function">_buffer_grow</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> h<span class="token operator">-></span>length <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">char</span> <span class="token operator">*</span>d <span class="token operator">=</span> h<span class="token operator">-></span>data <span class="token operator">+</span> h<span class="token operator">-></span>length<span class="token punctuation">;</span>
  <span class="token function">memset</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
  d <span class="token operator">+=</span> n<span class="token punctuation">;</span>
  <span class="token operator">*</span>d <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>length <span class="token operator">+=</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">_buffer_alloc</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  size_t len <span class="token operator">=</span> <span class="token punctuation">(</span>length <span class="token operator">+</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>h<span class="token operator">-></span>size <span class="token operator">>></span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">free</span><span class="token punctuation">(</span>h<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>size <span class="token operator">=</span> len<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">buffer_alloc</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">></span> h<span class="token operator">-></span>size<span class="token punctuation">)</span>
    <span class="token function">_buffer_alloc</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>length <span class="token operator">=</span> length<span class="token punctuation">;</span>
  h<span class="token operator">-></span>data<span class="token punctuation">[</span>h<span class="token operator">-></span>length<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> h<span class="token operator">-></span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">_buffer_set</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">></span> h<span class="token operator">-></span>size<span class="token punctuation">)</span>
    <span class="token function">_buffer_alloc</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">memcpy</span><span class="token punctuation">(</span>h<span class="token operator">-></span>data<span class="token punctuation">,</span> data<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>length <span class="token operator">=</span> length<span class="token punctuation">;</span>
  h<span class="token operator">-></span>data<span class="token punctuation">[</span>length<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">buffer_set</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">_buffer_set</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> data<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">buffer_sets</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">_buffer_set</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">buffer_setc</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">char</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">_buffer_set</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token operator">&amp;</span>c<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">buffer_setn</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">char</span> ch<span class="token punctuation">,</span> ssize_t n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  h<span class="token operator">-></span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">buffer_appendn</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">buffer_setvf</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>fmt<span class="token punctuation">,</span> va_list args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  h<span class="token operator">-></span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">buffer_appendvf</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> fmt<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">buffer_setf</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>fmt<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  h<span class="token operator">-></span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  va_list args<span class="token punctuation">;</span>
  <span class="token function">va_start</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> fmt<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">buffer_appendvf</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> fmt<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">va_end</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">buffer_appendvf</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>fmt<span class="token punctuation">,</span> va_list args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  va_list args_copy<span class="token punctuation">;</span>
  <span class="token function">va_copy</span><span class="token punctuation">(</span>args_copy<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  size_t leftover <span class="token operator">=</span> h<span class="token operator">-></span>size <span class="token operator">-</span> h<span class="token operator">-></span>length<span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>r <span class="token operator">=</span> h<span class="token operator">-></span>data <span class="token operator">+</span> h<span class="token operator">-></span>length<span class="token punctuation">;</span>
  <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token function">vsnprintf</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> leftover<span class="token punctuation">,</span> fmt<span class="token punctuation">,</span> args_copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">va_end</span><span class="token punctuation">(</span>args_copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> leftover<span class="token punctuation">)</span>
    h<span class="token operator">-></span>length <span class="token operator">+=</span> n<span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">_buffer_grow</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> h<span class="token operator">-></span>length <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    r <span class="token operator">=</span> h<span class="token operator">-></span>data <span class="token operator">+</span> h<span class="token operator">-></span>length<span class="token punctuation">;</span>
    <span class="token function">va_copy</span><span class="token punctuation">(</span>args_copy<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> n2 <span class="token operator">=</span> <span class="token function">vsnprintf</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> fmt<span class="token punctuation">,</span> args_copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">!=</span> n2<span class="token punctuation">)</span>
      <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// should never happen!</span>
    <span class="token function">va_end</span><span class="token punctuation">(</span>args_copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
    h<span class="token operator">-></span>length <span class="token operator">+=</span> n<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">buffer_appendf</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>fmt<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  va_list args<span class="token punctuation">;</span>
  <span class="token function">va_start</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> fmt<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">buffer_appendvf</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> fmt<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">va_end</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Most objects and code will manipulate data.  Buffer isn't an exception.  It is often the case that I will design software around data.  The buffer<em>t structure is the input to all of the functions except buffer</em>init, which creates it.  In C, it is common to name a structure <i>name</i><em>s and then typedef that to be <i>name</i></em>t.  <i>name</i><em>s and <i>name</i></em>t are the same thing.  To refer to <i>name</i><em>s, you must include the keyword struct before it.  The <i>name</i></em>t doesn't require the struct keyword to precede the name (it doesn't work).  </p>
<p>The code in buffer.h indicates that the buffer<em>t is a new type (struct buffer</em>s) and that the members of buffer<em>s are hidden.  By hiding the members of buffer</em>s in the implementation, one can force users to only work through the interface.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">buffer_s</span><span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">buffer_s</span> buffer_t<span class="token punctuation">;</span></code></pre></div>
<p>The buffer<em>s structure is defined as follows in buffer.c.  buffer</em>s maintains both a length and a size (and data).  data is always size bytes in length (+1).  length is the number of bytes that are currently in use by the buffer within data.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">buffer_s</span> <span class="token punctuation">{</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>data<span class="token punctuation">;</span>
  size_t length<span class="token punctuation">;</span>
  size_t size<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>The buffer<em>init function will initialize the object as being empty (length=0), with data being assigned to the initial</em>size (+1).  In C, strings are terminated with a zero byte.  I've found it handy in the buffer object to keep a zero character at the end of the buffer.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">buffer_t <span class="token operator">*</span><span class="token function">buffer_init</span><span class="token punctuation">(</span>size_t initial_size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  buffer_t <span class="token operator">*</span>h <span class="token operator">=</span> <span class="token punctuation">(</span>buffer_t <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/* notice the +1 to allow for zero terminator */</span>
  h<span class="token operator">-></span>data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>initial_size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>size <span class="token operator">=</span> initial_size<span class="token punctuation">;</span>
  <span class="token keyword">return</span> h<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Objects will typically be allocated as</p>
<p><i>object<em>name</i></em>t *h = (<i>object<em>name</i> *)malloc(sizeof(<i>object</em>name</i>_t));</p>
<p>This allocates the space needed (the size of the buffer_t structure) from the heap.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">buffer_t <span class="token operator">*</span>h <span class="token operator">=</span> <span class="token punctuation">(</span>buffer_t <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The data member needs to be initially allocated to be initial_size + 1 bytes.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">h<span class="token operator">-></span>data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>initial_size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Because the initial value of length is zero, set the first byte to zero.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">h<span class="token operator">-></span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code></pre></div>
<p>Set the initial length to zero</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">h<span class="token operator">-></span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code></pre></div>
<p>Set the size to the initial<em>size passed into the buffer</em>init function.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">h<span class="token operator">-></span>size <span class="token operator">=</span> initial_size<span class="token punctuation">;</span></code></pre></div>
<p>Return the buffer_t object now that it has been properly initialized.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">return</span> h<span class="token punctuation">;</span></code></pre></div>
<p>You may notice that I don't check the return from malloc.  If malloc fails, it will return NULL.  The line after both malloc calls will cause the program to abort, which is the only thing I'd want to do anyway.  For this reason, there isn't a point in having a line like <i>if(!h) abort();</i>.</p>
<p>The buffer<em>destroy method frees up the resources used by buffer</em>init.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">buffer_destroy</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">free</span><span class="token punctuation">(</span>h<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">free</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>In C, you must keep track of the pointer to memory that you allocate through malloc so that it can be freed later using free.  We will develop objects which will keep track of allocation for us.  These objects will follow a common pattern, which reduces the chance that end users will make a mistake in this regard.</p>
<p>The buffer maintains a single contiguous block of memory that may change as you add more data to it (if the current block of memory is too small, for example).  Clearing the buffer doesn't free memory.  It only resets the length counter to 0 and sets the zero terminator to the 0th byte.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">buffer_clear</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  h<span class="token operator">-></span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>To access the data, call buffer_data.  The implementation simply returns the data member from the structure.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">buffer_data</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> h<span class="token operator">-></span>data<span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></div>
<p>Similarly, you can get the length of your data by calling buffer_length.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">size_t <span class="token function">buffer_length</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> h<span class="token operator">-></span>length<span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></div>
<p>To set bytes into the buffer, you can use buffer_set, which is implemented as follows.  The buffer doesn't make a distinction between binary data and text.  You can set (or append) binary data or text through this function.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">buffer_set</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">_buffer_set</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> data<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The function above simply calls an internal inlined function to set bytes into the buffer.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">_buffer_set</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">></span> h<span class="token operator">-></span>size<span class="token punctuation">)</span>
    <span class="token function">_buffer_alloc</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">memcpy</span><span class="token punctuation">(</span>h<span class="token operator">-></span>data<span class="token punctuation">,</span> data<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>length <span class="token operator">=</span> length<span class="token punctuation">;</span>
  h<span class="token operator">-></span>data<span class="token punctuation">[</span>length<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>If length is greater than the size member (h->size), then the buffer needs to be resized using <em>buffer</em>alloc</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">></span> h<span class="token operator">-></span>size<span class="token punctuation">)</span>
  <span class="token function">_buffer_alloc</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The inline <em>buffer</em>alloc method.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">_buffer_alloc</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  size_t len <span class="token operator">=</span> <span class="token punctuation">(</span>length <span class="token operator">+</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>h<span class="token operator">-></span>size <span class="token operator">>></span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">free</span><span class="token punctuation">(</span>h<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>size <span class="token operator">=</span> len<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Our new length will be the requested length + 50 + (the old size / 8).  size_t is a type that is defined in stdio.h.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">size_t len <span class="token operator">=</span> <span class="token punctuation">(</span>length <span class="token operator">+</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>h<span class="token operator">-></span>size <span class="token operator">>></span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Because we are setting the value, we don't need to retain the old data.  We can just free it.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token function">free</span><span class="token punctuation">(</span>h<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Allocate data to the new size and set the size parameter accordingly.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">h<span class="token operator">-></span>data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
h<span class="token operator">-></span>size <span class="token operator">=</span> len<span class="token punctuation">;</span></code></pre></div>
<p>In <em>buffer</em>set again, copy data which is length bytes long into h->data.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token function">memcpy</span><span class="token punctuation">(</span>h<span class="token operator">-></span>data<span class="token punctuation">,</span> data<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Set the length of the buffer to be length and set the zero terminator.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">h<span class="token operator">-></span>length <span class="token operator">=</span> length<span class="token punctuation">;</span>
h<span class="token operator">-></span>data<span class="token punctuation">[</span>length<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code></pre></div>
<p>Similar to buffer<em>set, buffer</em>append just calls <em>buffer</em>append.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">buffer_append</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">_buffer_append</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> data<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The key differences are that the new size will be h->length + length instead of just length.  <em>buffer</em>grow makes a copy of the old data if the memory has to be reallocated.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">_buffer_append</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">,</span>
                                  size_t length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>h<span class="token operator">-></span>length <span class="token operator">+</span> length <span class="token operator">></span> h<span class="token operator">-></span>size<span class="token punctuation">)</span>
    <span class="token function">_buffer_grow</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> h<span class="token operator">-></span>length <span class="token operator">+</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">memcpy</span><span class="token punctuation">(</span>h<span class="token operator">-></span>data <span class="token operator">+</span> h<span class="token operator">-></span>length<span class="token punctuation">,</span> data<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>length <span class="token operator">+=</span> length<span class="token punctuation">;</span>
  h<span class="token operator">-></span>data<span class="token punctuation">[</span>h<span class="token operator">-></span>length<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The new length is the same as <em>buffer</em>alloc (length+50+(h->size/8)).  The new memory is malloced into data, and the current h->data is copied to the new memory before h->data is freed.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">_buffer_grow</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  size_t len <span class="token operator">=</span> <span class="token punctuation">(</span>length <span class="token operator">+</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>h<span class="token operator">-></span>size <span class="token operator">>></span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">memcpy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> h<span class="token operator">-></span>data<span class="token punctuation">,</span> h<span class="token operator">-></span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">free</span><span class="token punctuation">(</span>h<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>
  h<span class="token operator">-></span>size <span class="token operator">=</span> len<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>buffer<em>sets uses _buffer</em>set for its implementation using strlen to determine length.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">buffer_sets</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">_buffer_set</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></div>
<p>buffer<em>appends appends a string.  buffer</em>appends calls <em>buffer</em>append with the strlen of s.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">buffer_appends</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">_buffer_append</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>buffer<em>setc uses _buffer</em>set and takes the address of c and passes a length of 1.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">buffer_setc</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">char</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">_buffer_set</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token operator">&amp;</span>c<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></div>
<p>This method is optimized a bit since we are only adding exactly one byte.  Appending is done far more frequently than setting, so it is optimized.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">buffer_appendc</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">char</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>h<span class="token operator">-></span>length <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">></span> h<span class="token operator">-></span>size<span class="token punctuation">)</span>
    <span class="token function">_buffer_grow</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> h<span class="token operator">-></span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">char</span> <span class="token operator">*</span>d <span class="token operator">=</span> h<span class="token operator">-></span>data <span class="token operator">+</span> h<span class="token operator">-></span>length<span class="token punctuation">;</span>
  <span class="token operator">*</span>d<span class="token operator">++</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span>
  <span class="token operator">*</span>d <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>length<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>buffer<em>setn sets the length to zero (clearing buffer) and then calls buffer</em>appendn.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">buffer_setn</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">char</span> ch<span class="token punctuation">,</span> ssize_t n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  h<span class="token operator">-></span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">buffer_appendn</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>buffer_appendn appends ch n times to the buffer.  Using memset instead of memcpy to repeat character n times.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">void buffer_appendn(buffer_t *h, char ch, ssize_t n) {
  if (n &lt;= 0)
    return;

  if (h-&gt;length + n &gt; h-&gt;size)
    _buffer_grow(h, h-&gt;length + n);

  char *d = h-&gt;data + h-&gt;length;
  memset(d, ch, n);
  d += n;
  *d = 0;
  h-&gt;length += n;
}</code></pre></div>
<p>buffer<em>setvf sets the length to zero (clearing buffer) and then calls buffer</em>appendvf.  va_list is defined in stdarg.h</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">void buffer_setvf(buffer_t *h, const char *fmt, va_list args) {
  h-&gt;length = 0;
  buffer_appendvf(h, fmt, args);
}</code></pre></div>
<p>buffer<em>setf sets the length to zero (clearing buffer).  It then associates a va</em>list variable to the parameter fmt (which is considered a format string).  The format string is ultimately used much like printf (search for "c printf tutorial" to find more about it).  buffer<em>appendvf is called, and then the args variable's resources are freed up.  You can make custom functions that set/append to a buffer in much the same way as the setf/appendf methods.  Of course, you will use buffer</em>clear before buffer_appendvf if you wish to implement a custom set method.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">buffer_setf</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>fmt<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  h<span class="token operator">-></span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  va_list args<span class="token punctuation">;</span>
  <span class="token function">va_start</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> fmt<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">buffer_appendvf</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> fmt<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">va_end</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>buffer<em>appendf is identical to buffer</em>setf, except that the length isn't reset (h->length = 0 doesn't exist).</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">buffer_appendf</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>fmt<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  va_list args<span class="token punctuation">;</span>
  <span class="token function">va_start</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> fmt<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">buffer_appendvf</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> fmt<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">va_end</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This method is used to append a formatted string to a buffer and probably one of the more complex functions in buffer.  vsnprintf returns the number of bytes needed to print a given string.  Because the buffer has reserve memory, the leftover (or reserved) memory is frequently enough, and the buffer doesn't need to grow.  I'll break it down afterward.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">buffer_appendvf</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>fmt<span class="token punctuation">,</span> va_list args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  va_list args_copy<span class="token punctuation">;</span>
  <span class="token function">va_copy</span><span class="token punctuation">(</span>args_copy<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  size_t leftover <span class="token operator">=</span> h<span class="token operator">-></span>size <span class="token operator">-</span> h<span class="token operator">-></span>length<span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>r <span class="token operator">=</span> h<span class="token operator">-></span>data <span class="token operator">+</span> h<span class="token operator">-></span>length<span class="token punctuation">;</span>
  <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token function">vsnprintf</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> leftover<span class="token punctuation">,</span> fmt<span class="token punctuation">,</span> args_copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">va_end</span><span class="token punctuation">(</span>args_copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> leftover<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    r<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    h<span class="token operator">-></span>length <span class="token operator">+=</span> n<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">_buffer_grow</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> h<span class="token operator">-></span>length <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    r <span class="token operator">=</span> h<span class="token operator">-></span>data <span class="token operator">+</span> h<span class="token operator">-></span>length<span class="token punctuation">;</span>
    <span class="token function">va_copy</span><span class="token punctuation">(</span>args_copy<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> n2 <span class="token operator">=</span> <span class="token function">vsnprintf</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> fmt<span class="token punctuation">,</span> args_copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">!=</span> n2<span class="token punctuation">)</span>
      <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// should never happen!</span>
    <span class="token function">va_end</span><span class="token punctuation">(</span>args_copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
    h<span class="token operator">-></span>length <span class="token operator">+=</span> n<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Before calling vsnprintf, a copy of the args should be made as follows.  The va_end should be called once done with the copy of the args.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">va_list args_copy<span class="token punctuation">;</span>
<span class="token function">va_copy</span><span class="token punctuation">(</span>args_copy<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">// call vsnprintf</span>
<span class="token function">va_end</span><span class="token punctuation">(</span>args_copy<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Get the number of bytes leftover in the buffer.  Maybe vsnprintf will only have to be called once!</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">size_t leftover <span class="token operator">=</span> h<span class="token operator">-></span>size <span class="token operator">-</span> h<span class="token operator">-></span>length<span class="token punctuation">;</span></code></pre></div>
<p>Get a pointer to the end of the current data (to append the string)</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">char</span> <span class="token operator">*</span>r <span class="token operator">=</span> h<span class="token operator">-></span>data <span class="token operator">+</span> h<span class="token operator">-></span>length<span class="token punctuation">;</span></code></pre></div>
<p>vsnprintf requires a buffer (r), and a length of the buffer (leftover), and the fmt, and va<em>list (args</em>copy).  It returns the number of bytes needed to be successful.  If n is -1, something bad went wrong.  Just abort (maybe this isn't the best decision???)</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token function">vsnprintf</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> leftover<span class="token punctuation">,</span> fmt<span class="token punctuation">,</span> args_copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>If n is less than leftover, then the write was successful, and we are done.  Add n bytes to the overall length.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> leftover<span class="token punctuation">)</span>
  h<span class="token operator">-></span>length <span class="token operator">+=</span> n<span class="token punctuation">;</span></code></pre></div>
<p>If n is greater or equal to leftover, the buffer size must be increased to the current length + n bytes.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token function">_buffer_grow</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> h<span class="token operator">-></span>length <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Get a pointer to the end of the current data (to append the string)</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">  r <span class="token operator">=</span> h<span class="token operator">-></span>data <span class="token operator">+</span> h<span class="token operator">-></span>length<span class="token punctuation">;</span></code></pre></div>
<p>Copy the args like before.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">  <span class="token function">va_copy</span><span class="token punctuation">(</span>args_copy<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The memory needed for this to complete is 1 byte more than n because vsnprintf returns the number of bytes - 1 for the zero terminator.  Once this is done, add n bytes to length.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">  <span class="token keyword">int</span> n2 <span class="token operator">=</span> <span class="token function">vsnprintf</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> fmt<span class="token punctuation">,</span> args_copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">!=</span> n2<span class="token punctuation">)</span>
    <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// should never happen!</span>
  <span class="token function">va_end</span><span class="token punctuation">(</span>args_copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>length <span class="token operator">+=</span> n<span class="token punctuation">;</span></code></pre></div>
<p>buffer_alloc resizes the buffer to length bytes and returns you a pointer to the data.  The old data may be overridden.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">buffer_alloc</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">></span> h<span class="token operator">-></span>size<span class="token punctuation">)</span>
    <span class="token function">_buffer_alloc</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>length <span class="token operator">=</span> length<span class="token punctuation">;</span>
  h<span class="token operator">-></span>data<span class="token punctuation">[</span>h<span class="token operator">-></span>length<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> h<span class="token operator">-></span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>buffer_resize allows you to alter the size of the buffer and then returns a pointer to the data.  The resize will not overwrite old data (except if resizing to a smaller length).  If resizing to a smaller length, a zero is written to the length byte.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">buffer_resize</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">></span> h<span class="token operator">-></span>size<span class="token punctuation">)</span>
    <span class="token function">_buffer_grow</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>length <span class="token operator">=</span> length<span class="token punctuation">;</span>
  h<span class="token operator">-></span>data<span class="token punctuation">[</span>h<span class="token operator">-></span>length<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> h<span class="token operator">-></span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>buffer<em>append</em>alloc is like buffer_resize, except that it allocates length more bytes and returns a pointer to those new bytes.  It is safe to assume that the byte after length is set to zero.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">buffer_append_alloc</span><span class="token punctuation">(</span>buffer_t <span class="token operator">*</span>h<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">+</span> h<span class="token operator">-></span>length <span class="token operator">></span> h<span class="token operator">-></span>size<span class="token punctuation">)</span>
    <span class="token function">_buffer_grow</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> length <span class="token operator">+</span> h<span class="token operator">-></span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>r <span class="token operator">=</span> h<span class="token operator">-></span>data <span class="token operator">+</span> h<span class="token operator">-></span>length<span class="token punctuation">;</span>
  h<span class="token operator">-></span>length <span class="token operator">+=</span> length<span class="token punctuation">;</span>
  r<span class="token punctuation">[</span>h<span class="token operator">-></span>length<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> r<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>If you followed everything in this, that is great.  Otherwise, it might make more sense as the buffer object is used throughout the project.  Next up is /2<em>linked</em>structures.md</p>
<h1 id="linked-lists"><a href="#linked-lists" aria-label="linked lists permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><a href="4_linked_lists.md">Linked Lists</a></h1>
<p><a href="../README.md">Table of Contents</a>  - Copyright 2019 Andy Curtis</p></div></div><div style="font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif;width:400px;height:100vh;padding:15px;color:#1E4E8C;position:sticky;top:62px;border-left:solid 1px #EDF2F7" class="Sidebar"><div><div><a href="/ebook/1-getting-started">1. Getting Started</a></div><div><a href="/ebook/10-binary-search-trees">10. Binary Search Trees</a></div><div><a href="/ebook/11-balancing-binary-search-trees">11. Balancing Binary Search Trees</a></div><div><a href="/ebook/12-red-black-tree">12. The Red-Black Tree</a></div><div><a href="/ebook/13-map">13. The Map Object</a></div><div><a href="/ebook/14-set-and-multimap">14. The Set and Multimap</a></div><div><a href="/ebook/2-timing">2. Timing Your Code</a></div><div><a href="/ebook/3-buffer">3. The Buffer Object</a></div><div><a href="/ebook/4-linked-lists">4. Linked Lists</a></div><div><a href="/ebook/5-threads">5. Introducing Threads</a></div><div><a href="/ebook/6-macros">6. Macros</a></div><div><a href="/ebook/7-allocator">7. The Global Allocator Object</a></div><div><a href="/ebook/8-allocator-implementation">8. The Global Allocator Implementation</a></div><div><a href="/ebook/9-pool">9. The Pool Object</a></div></div></div></div></main><footer style="background-color:#1A202C;padding:10px;color:white;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif"><div class="Footer"><div><h1 style="margin-bottom:5px">Another C Library</h1><p style="margin-bottom:15px">© <!-- -->2019<!-- --> Andy Curtis &amp; Daniel Curtis</p><ul style="list-style:none;margin-left:0"><li><a style="color:#3182CE" href="/contact">Contact</a></li><li><a style="color:#3182CE" href="/contributing">Contributing</a></li><li><a style="color:#3182CE" href="/license">License</a></li></ul></div><div><h2 style="margin:10px auto">A C eBook</h2><ul style="list-style:none;margin-left:0"><li><a href="/ebook/1-getting-started">1. Getting Started</a></li><li><a href="/ebook/10-binary-search-trees">10. Binary Search Trees</a></li><li><a href="/ebook/11-balancing-binary-search-trees">11. Balancing Binary Search Trees</a></li><li><a href="/ebook/12-red-black-tree">12. The Red-Black Tree</a></li><li><a href="/ebook/13-map">13. The Map Object</a></li><li><a href="/ebook/14-set-and-multimap">14. The Set and Multimap</a></li><li><a href="/ebook/2-timing">2. Timing Your Code</a></li><li><a href="/ebook/3-buffer">3. The Buffer Object</a></li><li><a href="/ebook/4-linked-lists">4. Linked Lists</a></li><li><a href="/ebook/5-threads">5. Introducing Threads</a></li><li><a href="/ebook/6-macros">6. Macros</a></li><li><a href="/ebook/7-allocator">7. The Global Allocator Object</a></li><li><a href="/ebook/8-allocator-implementation">8. The Global Allocator Implementation</a></li><li><a href="/ebook/9-pool">9. The Pool Object</a></li></ul></div><div><h2 style="margin:10px auto">Resources</h2><ul style="list-style:none;margin-left:0"><li><a href="https://medium.com/software-design/why-software-developers-should-care-about-cpu-caches-8da04355bb8a" target="_blank" rel="noopener noreferrer" style="color:#3182CE">Why software developers should care about CPU caches <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"></path></svg></a></li><li><a href="https://github.com/contactandyc/another-c-library/blob/master/docs/tips.md#create-multiline-macro-in-c" target="_blank" rel="noopener noreferrer" style="color:#3182CE">Helpful Tips for Formatting <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"></path></svg></a></li><li><a href="https://mitpress.mit.edu/books/introduction-algorithms-third-edition" target="_blank" rel="noopener noreferrer" style="color:#3182CE">Introduction to Alogorithms <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"></path></svg></a></li></ul></div></div></footer></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/ebook/3-buffer/";window.webpackCompilationHash="3295078aa60067aa1188";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-95ebc95ba4fb3bc2dd23.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-2089f767561e6aa92a7f.js"],"component---src-templates-ebook-page-js":["/component---src-templates-ebook-page-js-4e3a1b55402746ff3b7a.js"],"component---src-pages-404-js":["/component---src-pages-404-js-a5fd40ab0bd43785175c.js"],"component---src-pages-contact-js":["/component---src-pages-contact-js-fb76d9a5164a1f2eede1.js"],"component---src-pages-contributing-js":["/component---src-pages-contributing-js-80166a10b44da213f86c.js"],"component---src-pages-docs-js":["/component---src-pages-docs-js-975d0febbab235872219.js"],"component---src-pages-ebook-js":["/component---src-pages-ebook-js-6f015fdd8e327552f239.js"],"component---src-pages-index-js":["/component---src-pages-index-js-d1c647469039ae7263dc.js"],"component---src-pages-license-js":["/component---src-pages-license-js-5dac97904724019f2a51.js"]};/*]]>*/</script><script src="/webpack-runtime-bcb22306b53b567f461a.js" async=""></script><script src="/styles-1b0337c96e7c47d59c08.js" async=""></script><script src="/app-95ebc95ba4fb3bc2dd23.js" async=""></script><script src="/commons-0ae7f027867ef630b05a.js" async=""></script><script src="/component---src-templates-ebook-page-js-4e3a1b55402746ff3b7a.js" async=""></script></body></html>