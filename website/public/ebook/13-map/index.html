<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.45 'georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'georgia',serif;font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}ul{margin-left:1.45rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.45rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;font-size:0.85rem;line-height:1.45rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}blockquote{margin-left:1.45rem;margin-right:1.45rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.45rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.45rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.45rem;margin-bottom:calc(1.45rem / 2);margin-top:calc(1.45rem / 2);}li > ul{margin-left:1.45rem;margin-bottom:calc(1.45rem / 2);margin-top:calc(1.45rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.45rem / 2);}code{font-size:0.85rem;line-height:1.45rem;}kbd{font-size:0.85rem;line-height:1.45rem;}samp{font-size:0.85rem;line-height:1.45rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:0.96667rem;padding-right:0.96667rem;padding-top:0.725rem;padding-bottom:calc(0.725rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}</style><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><title data-react-helmet="true">13. The Map Object | Another C Library</title><meta data-react-helmet="true" name="description" content="A documentation site for Another C Library."/><meta data-react-helmet="true" property="og:title" content="13. The Map Object"/><meta data-react-helmet="true" property="og:description" content="A documentation site for Another C Library."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Daniel Curtis"/><meta data-react-helmet="true" name="twitter:title" content="13. The Map Object"/><meta data-react-helmet="true" name="twitter:description" content="A documentation site for Another C Library."/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="shortcut icon" href="/icons/icon-48x48.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="generator" content="Gatsby 2.16.1"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><style data-href="/styles.1fda8d1dee77beeb7dae.css">code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}a{text-decoration:none;cursor:pointer;color:#3182ce}a:hover{text-decoration:underline}button:hover{-webkit-transition:.6s;transition:.6s;-webkit-filter:brightness(115%);filter:brightness(115%)}nav{display:flex;align-items:center}pre[class*=language-]{background:#1a202c;overflow-x:scroll}:not(pre)>code[class*=language-],pre[class*=language-]{border-radius:0;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;text-shadow:none}:not(pre)>code[class*=language-]{background:#edf2f7;color:#000;padding:3px}.Footer{max-width:1200px;margin:30px auto;display:flex;justify-content:space-between}.Flex{display:grid;grid-template-columns:auto auto;grid-column-gap:50px}.Content{max-width:950px;width:72vw}@media only screen and (max-width:600px){.Footer,nav{flex-direction:column}.Flex{grid-template-columns:auto}.Sidebar{display:none}.Content{width:100%}}</style><link as="script" rel="preload" href="/component---src-templates-ebook-page-js-fe8bc0f2c932eda75c4a.js"/><link as="script" rel="preload" href="/commons-0ae7f027867ef630b05a.js"/><link as="script" rel="preload" href="/app-95ebc95ba4fb3bc2dd23.js"/><link as="script" rel="preload" href="/styles-8648ad68e26f3992ff5c.js"/><link as="script" rel="preload" href="/webpack-runtime-3090066330befb922a07.js"/><link as="fetch" rel="preload" href="/page-data/ebook/13-map/page-data.json" crossorigin="anonymous"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div style="background-color:white"><header style="position:sticky;top:0;background-color:#1A202C;z-index:1"><nav style="margin:auto;max-width:1200px"><a style="color:white;font-size:1.25rem;padding:1rem 1.5rem;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif" href="/"><span style="font-weight:700">Another C Library</span></a><a style="color:white;font-size:1.25rem;padding:1rem 1.5rem;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif" href="/docs/">Documentation</a><a style="color:#38A169;font-size:1.25rem;padding:1rem 1.5rem;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif;border-bottom:solid 4px #2F855A;background-color:#2D3748" class="" href="/ebook/">A C eBook</a><a style="color:white;font-size:1.25rem;padding:1rem 1.5rem;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif" target="_blank" rel="noopener noreferrer" href="https://github.com/contactandyc/another-c-library">Github <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" style="padding-top:5px" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"></path></svg></a></nav></header><main><div style="margin:0 auto;max-width:1200px;display:flex"><div style="color:black;margin:0;padding:20px" class="Content"><h1>13. The Map Object</h1><div><p>Copyright 2019 Andy Curtis &#x26; Daniel Curtis</p>
<h1 id="the-map-object"><a href="#the-map-object" aria-label="the map object permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Map Object</h1>
<ul>
<li>Turning the red black tree into a map</li>
</ul>
<p><em>This and the src/ac_map.h/c files were started on Monday 9/23/19 and are still a work in progress.</em></p>
<p>The code for this section is found in <i>illustrations/13<em>map/1</em>map</i></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token variable">$ac</span>/illustrations/13_map/1_map</code></pre></div>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span>
gcc -O3 -I<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src -D_AC_DEBUG_MEMORY_<span class="token operator">=</span>NULL <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src/ac_timer.c <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src/ac_allocator.c <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src/ac_buffer.c <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src/ac_pool.c <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/src/ac_map.c test_data_structure.c -o test_data_structure
./test_data_structure ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 <span class="token number">10000</span>
Creating ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 using map
P-1
<span class="token operator">|</span>  <span class="token punctuation">\</span>
<span class="token operator">|</span>   X-2
<span class="token operator">|</span>   <span class="token operator">|</span>  <span class="token punctuation">\</span>
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token punctuation">(</span>f-2<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>    <span class="token punctuation">\</span>
<span class="token operator">|</span>   <span class="token operator">|</span>   b-3   n-3
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>  <span class="token punctuation">\</span>  <span class="token operator">|</span>  <span class="token punctuation">\</span>
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token punctuation">(</span>r-3<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span>    <span class="token punctuation">\</span>
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>   p-4   v-4
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span>  <span class="token punctuation">\</span>  <span class="token operator">|</span>  <span class="token punctuation">\</span>
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>   o-5 <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token punctuation">(</span>x-4<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>       <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span>    <span class="token punctuation">\</span>
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token punctuation">(</span>j-3<span class="token punctuation">)</span>   <span class="token operator">|</span> <span class="token operator">|</span>   w-5   y-5
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>    <span class="token punctuation">\</span>  <span class="token operator">|</span> <span class="token operator">|</span>            <span class="token punctuation">\</span>
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span> h-4   <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>t-4<span class="token punctuation">)</span>         <span class="token punctuation">(</span>z-5<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>  <span class="token punctuation">\</span>  <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>    <span class="token punctuation">\</span>             
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span> g-5 <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> s-5   u-5
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>          
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>   d-4   <span class="token operator">|</span> <span class="token operator">|</span> q-5
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>  <span class="token punctuation">\</span>  <span class="token operator">|</span> <span class="token operator">|</span>    
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>   c-5 <span class="token operator">|</span> <span class="token operator">|</span> l-4
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>       <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>  <span class="token punctuation">\</span>
<span class="token operator">|</span>   <span class="token operator">|</span>   Z-4     <span class="token operator">|</span> <span class="token operator">|</span> k-5 m-5
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>  <span class="token punctuation">\</span>    <span class="token operator">|</span> <span class="token operator">|</span>        
<span class="token operator">|</span>   <span class="token operator">|</span>   Y-5 a-5 <span class="token operator">|</span> i-5
<span class="token operator">|</span>   <span class="token operator">|</span>           <span class="token operator">|</span>    
<span class="token operator">|</span>   T-3         e-5
<span class="token operator">|</span>   <span class="token operator">|</span>  <span class="token punctuation">\</span>           
<span class="token operator">|</span>   <span class="token operator">|</span>   V-4
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>  <span class="token punctuation">\</span>
<span class="token operator">|</span>   <span class="token operator">|</span>   U-5 W-5
<span class="token operator">|</span>   <span class="token operator">|</span>          
<span class="token operator">|</span>   R-4
<span class="token operator">|</span>   <span class="token operator">|</span>  <span class="token punctuation">\</span>
<span class="token operator">|</span>   Q-5 S-5
<span class="token operator">|</span>          
H-2
<span class="token operator">|</span>  <span class="token punctuation">\</span>
<span class="token operator">|</span>   L-3
<span class="token operator">|</span>   <span class="token operator">|</span>  <span class="token punctuation">\</span>
<span class="token operator">|</span>   <span class="token operator">|</span>   N-4
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>  <span class="token punctuation">\</span>
<span class="token operator">|</span>   <span class="token operator">|</span>   M-5 O-5
<span class="token operator">|</span>   <span class="token operator">|</span>          
<span class="token operator">|</span>   J-4
<span class="token operator">|</span>   <span class="token operator">|</span>  <span class="token punctuation">\</span>
<span class="token operator">|</span>   I-5 K-5
<span class="token operator">|</span>          
D-3
<span class="token operator">|</span>  <span class="token punctuation">\</span>
<span class="token operator">|</span>   F-4
<span class="token operator">|</span>   <span class="token operator">|</span>  <span class="token punctuation">\</span>
<span class="token operator">|</span>   E-5 G-5
<span class="token operator">|</span>          
<span class="token punctuation">(</span><span class="token number">3</span>-3<span class="token punctuation">)</span>
<span class="token operator">|</span>    <span class="token punctuation">\</span>
<span class="token number">1</span>-4   <span class="token number">7</span>-4
<span class="token operator">|</span>  <span class="token punctuation">\</span>  <span class="token operator">|</span>  <span class="token punctuation">\</span>
<span class="token number">0</span>-5 <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token punctuation">(</span>B-4<span class="token punctuation">)</span>
    <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span>    <span class="token punctuation">\</span>
    <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token number">9</span>-5   C-5
    <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span>  <span class="token punctuation">\</span>     
    <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token punctuation">(</span>A-5<span class="token punctuation">)</span>
    <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span>        
    <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token punctuation">(</span><span class="token number">8</span>-5<span class="token punctuation">)</span>
    <span class="token operator">|</span> <span class="token operator">|</span>        
    <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">5</span>-4<span class="token punctuation">)</span>
    <span class="token operator">|</span> <span class="token operator">|</span>    <span class="token punctuation">\</span>
    <span class="token operator">|</span> <span class="token number">4</span>-5   <span class="token number">6</span>-5
    <span class="token operator">|</span>          
    <span class="token number">2</span>-5</code></pre></div>
<p>The third parameter to test<em>data</em>structure is 10000, which means to build the tree 10,000 times, randomly, inserting and deleting the values in the second argument.</p>
<p>A good first step in designing any object is to understand the requirements.</p>
<ol>
<li>find, insert, update, remove</li>
<li>find less than (or equal if equal exists)</li>
<li>find greater (or equal if equal exists)</li>
<li>iteration from nodes</li>
<li>a copy function</li>
<li>a print function</li>
<li>any data type should be supported</li>
<li>multiple data structures should be able to be embedded to the same node</li>
<li>once a node is inserted, its memory location should not change</li>
</ol>
<p>The code for the interface follows</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">/*
Copyright 2019 Andy Curtis

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/</span>
<span class="token macro property">#<span class="token directive keyword">ifndef</span> _ac_map_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> _ac_map_H</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ac_common.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ac_pool.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ac_buffer.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">ac_map_node_s</span> <span class="token punctuation">{</span>
  size_t parent_color<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token class-name">ac_map_node_s</span> <span class="token operator">*</span>left<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token class-name">ac_map_node_s</span> <span class="token operator">*</span>right<span class="token punctuation">;</span>
<span class="token punctuation">}</span> ac_map_node_t<span class="token punctuation">;</span>

<span class="token comment">/* iteration */</span>
ac_map_node_t <span class="token operator">*</span> <span class="token function">ac_map_first</span><span class="token punctuation">(</span> ac_map_node_t <span class="token operator">*</span>n <span class="token punctuation">)</span><span class="token punctuation">;</span>
ac_map_node_t <span class="token operator">*</span> <span class="token function">ac_map_last</span><span class="token punctuation">(</span> ac_map_node_t <span class="token operator">*</span>n <span class="token punctuation">)</span><span class="token punctuation">;</span>
ac_map_node_t <span class="token operator">*</span> <span class="token function">ac_map_next</span><span class="token punctuation">(</span> ac_map_node_t <span class="token operator">*</span>n <span class="token punctuation">)</span><span class="token punctuation">;</span>
ac_map_node_t <span class="token operator">*</span> <span class="token function">ac_map_previous</span><span class="token punctuation">(</span> ac_map_node_t <span class="token operator">*</span>n <span class="token punctuation">)</span><span class="token punctuation">;</span>
ac_map_node_t <span class="token operator">*</span> <span class="token function">ac_map_postorder_first</span><span class="token punctuation">(</span> ac_map_node_t <span class="token operator">*</span>n <span class="token punctuation">)</span><span class="token punctuation">;</span>
ac_map_node_t <span class="token operator">*</span> <span class="token function">ac_map_postorder_next</span><span class="token punctuation">(</span> ac_map_node_t <span class="token operator">*</span>n <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
  ac_map_copy_node_f is a callback meant to be used with ac_map_copy to
  copy one map to another given a root node.  The tag will typically be an
  allocator such as the pool.
*/</span>
<span class="token keyword">typedef</span> ac_map_node_t <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">*</span>ac_map_copy_node_f<span class="token punctuation">)</span><span class="token punctuation">(</span> ac_map_node_t <span class="token operator">*</span>n<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>tag <span class="token punctuation">)</span><span class="token punctuation">;</span>

ac_map_node_t <span class="token operator">*</span> <span class="token function">ac_map_copy</span><span class="token punctuation">(</span> ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">,</span> ac_map_copy_node_f copy<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>tag<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
  print_node_to_string_f is a callback meant to print the value of the node n.
  There is an expectation that the value will be printed on a single line.
  Printing the internal representation of the tree is largely meant for testing
  and doesn't need to be complete.
*/</span>
<span class="token keyword">typedef</span> <span class="token keyword">char</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">*</span>print_node_to_string_f<span class="token punctuation">)</span><span class="token punctuation">(</span>ac_pool_t <span class="token operator">*</span>pool<span class="token punctuation">,</span> ac_map_node_t <span class="token operator">*</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>

bool <span class="token function">ac_map_valid_to_buffer</span><span class="token punctuation">(</span>ac_buffer_t <span class="token operator">*</span>bh<span class="token punctuation">,</span> ac_pool_t <span class="token operator">*</span>pool<span class="token punctuation">,</span>
                              ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">,</span> print_node_to_string_f print_node <span class="token punctuation">)</span><span class="token punctuation">;</span>

bool <span class="token function">ac_map_valid</span><span class="token punctuation">(</span>ac_pool_t <span class="token operator">*</span>pool<span class="token punctuation">,</span>
                    ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">,</span>
                    print_node_to_string_f print_node<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">define</span> AC_MAP_DONT_PRINT_RED 1</span>
<span class="token macro property">#<span class="token directive keyword">define</span> AC_MAP_DONT_PRINT_BLACK_HEIGHT 2</span>

<span class="token keyword">void</span> <span class="token function">ac_map_print_to_buffer</span><span class="token punctuation">(</span>ac_buffer_t <span class="token operator">*</span>bh<span class="token punctuation">,</span>
                              ac_pool_t <span class="token operator">*</span>pool<span class="token punctuation">,</span> ac_map_node_t <span class="token operator">*</span>node<span class="token punctuation">,</span>
                              print_node_to_string_f print_node<span class="token punctuation">,</span>
                              <span class="token keyword">int</span> flags <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">ac_map_print</span><span class="token punctuation">(</span>ac_pool_t <span class="token operator">*</span>pool<span class="token punctuation">,</span> ac_map_node_t <span class="token operator">*</span>node<span class="token punctuation">,</span>
                    print_node_to_string_f print_node<span class="token punctuation">,</span>
                    <span class="token keyword">int</span> flags <span class="token punctuation">)</span><span class="token punctuation">;</span>

bool <span class="token function">ac_map_erase</span><span class="token punctuation">(</span>ac_map_node_t <span class="token operator">*</span>node<span class="token punctuation">,</span> ac_map_node_t <span class="token operator">*</span><span class="token operator">*</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">ac_map_fix_insert</span><span class="token punctuation">(</span>ac_map_node_t <span class="token operator">*</span>node<span class="token punctuation">,</span>
                         ac_map_node_t <span class="token operator">*</span>parent<span class="token punctuation">,</span>
                         ac_map_node_t <span class="token operator">*</span><span class="token operator">*</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* find and insert macros */</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span></code></pre></div>
<p>The code in ac<em>map.c is largely not new.  The functions have been prefixed with ac</em>map<em>.  The node</em>t structure has been renamed to ac<em>map</em>node<em>t.  The internal knowledge of the value type (char key) has been eliminated from the code.  Finally, the ac</em>map<em>node</em>t structure is exposed in the header file.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">ac_map_node_s</span> <span class="token punctuation">{</span>
  size_t parent_color<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token class-name">ac_map_node_s</span> <span class="token operator">*</span>left<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token class-name">ac_map_node_s</span> <span class="token operator">*</span>right<span class="token punctuation">;</span>
<span class="token punctuation">}</span> ac_map_node_t<span class="token punctuation">;</span></code></pre></div>
<p>is similar to the node_t structure before, except it doesn't have <em>char key</em>.</p>
<p>To use the ac<em>map, this structure will be added to the custom structure.  test</em>data<em>structure.c defines the node</em>t structure as it was defined before (with a char key).  Most of the time, you will be able to make the <em>ac<em>map</em>node_t map</em> be the first member of your structure.  This makes it easy to cast between your structure and the ac<em>map</em>node_t structure since they both have the same memory address.  Having the map not be the first member will be explored later (including having multiple map members in a single structure).</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  ac_map_node_t map<span class="token punctuation">;</span>
  <span class="token keyword">char</span> key<span class="token punctuation">;</span>
<span class="token punctuation">}</span> node_t<span class="token punctuation">;</span></code></pre></div>
<p>The iteration methods still exist (first, last, next, previous).  They have just been renamed.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">ac_map_node_t <span class="token operator">*</span> <span class="token function">ac_map_first</span><span class="token punctuation">(</span> ac_map_node_t <span class="token operator">*</span>n <span class="token punctuation">)</span><span class="token punctuation">;</span>
ac_map_node_t <span class="token operator">*</span> <span class="token function">ac_map_last</span><span class="token punctuation">(</span> ac_map_node_t <span class="token operator">*</span>n <span class="token punctuation">)</span><span class="token punctuation">;</span>
ac_map_node_t <span class="token operator">*</span> <span class="token function">ac_map_next</span><span class="token punctuation">(</span> ac_map_node_t <span class="token operator">*</span>n <span class="token punctuation">)</span><span class="token punctuation">;</span>
ac_map_node_t <span class="token operator">*</span> <span class="token function">ac_map_previous</span><span class="token punctuation">(</span> ac_map_node_t <span class="token operator">*</span>n <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>If your structure is called node_t, you can call these functions as</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">print_using_iteration</span><span class="token punctuation">(</span>ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  node_t <span class="token operator">*</span>n <span class="token operator">=</span> <span class="token punctuation">(</span>node_t <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">ac_map_first</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"%c"</span><span class="token punctuation">,</span> n<span class="token operator">-></span>key <span class="token punctuation">)</span><span class="token punctuation">;</span>
    n <span class="token operator">=</span> <span class="token punctuation">(</span>node_t <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">ac_map_next</span><span class="token punctuation">(</span><span class="token punctuation">(</span>node_t <span class="token operator">*</span><span class="token punctuation">)</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"\n"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>or</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">print_using_iteration</span><span class="token punctuation">(</span>ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ac_map_node_t <span class="token operator">*</span>n <span class="token operator">=</span> <span class="token function">ac_map_first</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>node_t <span class="token operator">*</span><span class="token punctuation">)</span>n<span class="token punctuation">)</span><span class="token operator">-></span>key <span class="token punctuation">)</span><span class="token punctuation">;</span>
    n <span class="token operator">=</span> <span class="token function">ac_map_next</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"\n"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Both approaches are equivalent, assuming that the map is the first member of the node_t structure.</p>
<p>The node<em>first</em>to<em>erase and node</em>next<em>to</em>erase have been renamed.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">ac_map_node_t <span class="token operator">*</span> <span class="token function">ac_map_postorder_first</span><span class="token punctuation">(</span> ac_map_node_t <span class="token operator">*</span>n <span class="token punctuation">)</span><span class="token punctuation">;</span>
ac_map_node_t <span class="token operator">*</span> <span class="token function">ac_map_postorder_next</span><span class="token punctuation">(</span> ac_map_node_t <span class="token operator">*</span>n <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>ac<em>map</em>copy<em>node</em>f is a callback meant to be used with ac<em>map</em>copy to copy one map to another given a root node.  The tag will typically be an allocator, such as the pool.  ac<em>map</em>copy will make a complete copy of a map (or red-black tree) and return a pointer to it.  I like to suffix function typedefs with a <em>_f</em>.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">typedef</span> ac_map_node_t <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">*</span>ac_map_copy_node_f<span class="token punctuation">)</span><span class="token punctuation">(</span> ac_map_node_t <span class="token operator">*</span>n<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>tag <span class="token punctuation">)</span><span class="token punctuation">;</span>

ac_map_node_t <span class="token operator">*</span> <span class="token function">ac_map_copy</span><span class="token punctuation">(</span> ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">,</span> ac_map_copy_node_f copy<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>tag<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>ac<em>map</em>copy could be used in the following way...</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">ac_map_node_t <span class="token operator">*</span> <span class="token function">copy_node</span><span class="token punctuation">(</span> ac_map_node_t <span class="token operator">*</span>n<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>tag <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ac_pool_t <span class="token operator">*</span>pool <span class="token operator">=</span> <span class="token punctuation">(</span>ac_pool_t <span class="token operator">*</span><span class="token punctuation">)</span>tag<span class="token punctuation">;</span>
  node_t <span class="token operator">*</span>res <span class="token operator">=</span> <span class="token punctuation">(</span>node_t <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">ac_pool_alloc</span><span class="token punctuation">(</span>pool<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>node_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token operator">-></span>key <span class="token operator">=</span> n<span class="token operator">-></span>key<span class="token punctuation">;</span>
  <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

ac_map_node_t <span class="token operator">*</span>root <span class="token operator">=</span> <span class="token comment">/* a valid map with zero or more entries */</span><span class="token punctuation">;</span>
ac_map_node_t <span class="token operator">*</span>copy_of_root <span class="token operator">=</span> <span class="token function">ac_map_copy</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> copy_node<span class="token punctuation">,</span> pool<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>print<em>node</em>to<em>string</em>f is a callback meant to print the value of the node n.  There is an expectation that the value will be printed on a single line.  Printing the internal representation of the tree is used for testing and printing the tree and doesn't need to be complete.  It generally doesn't have practical use within applications.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">char</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">*</span>print_node_to_string_f<span class="token punctuation">)</span><span class="token punctuation">(</span>ac_pool_t <span class="token operator">*</span>pool<span class="token punctuation">,</span> ac_map_node_t <span class="token operator">*</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>For debugging, it is often nice to be able just to print something to the terminal.  Sometimes, it is also nice to print to a buffer and then have the output directed to some other location.  I provide both mechanisms below.  The first prints errors in the map (red-black violations) to a buffer and returns false if there are any errors.  The second function is like the first, except it outputs directly to the screen.  Both of these functions require the root of the tree and a pointer to a print<em>node</em>to<em>string</em>f function.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">bool <span class="token function">ac_map_valid_to_buffer</span><span class="token punctuation">(</span>ac_buffer_t <span class="token operator">*</span>bh<span class="token punctuation">,</span> ac_pool_t <span class="token operator">*</span>pool<span class="token punctuation">,</span>
                              ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">,</span> print_node_to_string_f print_node <span class="token punctuation">)</span><span class="token punctuation">;</span>

bool <span class="token function">ac_map_valid</span><span class="token punctuation">(</span>ac_pool_t <span class="token operator">*</span>pool<span class="token punctuation">,</span>
                    ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">,</span>
                    print_node_to_string_f print_node<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>ac<em>map</em>valid checks if the map is valid.  ac<em>map</em>print dumps the contents of a map in a tree-like manner.  It takes additional parameter flags, which would typically be zero unless you with to not print red nodes in the color red and/or you don't want the black height of a node suffixed in the print.  The flags are bit-oriented and can be or'ed together.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">define</span> AC_MAP_DONT_PRINT_RED 1</span>
<span class="token macro property">#<span class="token directive keyword">define</span> AC_MAP_DONT_PRINT_BLACK_HEIGHT 2</span>

<span class="token keyword">void</span> <span class="token function">ac_map_print_to_buffer</span><span class="token punctuation">(</span>ac_buffer_t <span class="token operator">*</span>bh<span class="token punctuation">,</span>
                              ac_pool_t <span class="token operator">*</span>pool<span class="token punctuation">,</span> ac_map_node_t <span class="token operator">*</span>node<span class="token punctuation">,</span>
                              print_node_to_string_f print_node<span class="token punctuation">,</span>
                              <span class="token keyword">int</span> flags <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">ac_map_print</span><span class="token punctuation">(</span>ac_pool_t <span class="token operator">*</span>pool<span class="token punctuation">,</span> ac_map_node_t <span class="token operator">*</span>node<span class="token punctuation">,</span>
                    print_node_to_string_f print_node<span class="token punctuation">,</span>
                    <span class="token keyword">int</span> flags <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>ac<em>map</em>erase unlinks node from the given map.  The node is expected to be a valid node within the tree (typically found via a find method).  ac<em>map</em>erase does not destroy the node (it simply unlinks it from the map).</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">bool <span class="token function">ac_map_erase</span><span class="token punctuation">(</span>ac_map_node_t <span class="token operator">*</span>node<span class="token punctuation">,</span> ac_map_node_t <span class="token operator">*</span><span class="token operator">*</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The find and insert methods were left to the end for a reason.  These are the only two groups of functions that need to understand the value of a node.  These functions end up being custom.  To aid in writing these functions, I've created the following macros.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token function">ac_map_find_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> keytype<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_map_find2_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> keytype<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> mapname<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_map_find_arg_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> keytype<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span>
                          <span class="token keyword">const</span> ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">,</span>
                          <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_map_find2_arg_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> keytype<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> mapname<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span>
                          <span class="token keyword">const</span> ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">,</span>
                          <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_map_find_least_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> keytype<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_map_find_least2_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> keytype<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> mapname<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_map_find_least_arg_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> keytype<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span>
                          <span class="token keyword">const</span> ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">,</span>
                          <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_map_find_least2_arg_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> keytype<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> mapname<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span>
                          <span class="token keyword">const</span> ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">,</span>
                          <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_map_find_least_or_next_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> keytype<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_map_find_least_or_next2_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> keytype<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> mapname<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_map_find_least_or_next_arg_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> keytype<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span>
                          <span class="token keyword">const</span> ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">,</span>
                          <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_map_find_least_or_next2_arg_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> keytype<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> mapname<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span>
                          <span class="token keyword">const</span> ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">,</span>
                          <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_map_find_greatest_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> keytype<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_map_find_greatest2_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> keytype<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> mapname<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_map_find_greatest_arg_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> keytype<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span>
                          <span class="token keyword">const</span> ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">,</span>
                          <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_map_find_greatest2_arg_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> keytype<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> mapname<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">const</span> keytype <span class="token operator">*</span>key<span class="token punctuation">,</span>
                          <span class="token keyword">const</span> ac_map_node_t <span class="token operator">*</span>root<span class="token punctuation">,</span>
                          <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>

The insert macros are listed below <span class="token punctuation">(</span>they are defined in impl<span class="token operator">/</span>ac_map<span class="token punctuation">.</span>h<span class="token punctuation">)</span>

<span class="token function">ac_map_insert_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> datatype <span class="token operator">*</span>node_to_insert<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span>datatype <span class="token operator">*</span>node_to_insert<span class="token punctuation">,</span> ac_map_node_t <span class="token operator">*</span><span class="token operator">*</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_map_insert2_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> mapname<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> datatype <span class="token operator">*</span>node_to_insert<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span>datatype <span class="token operator">*</span>node_to_insert<span class="token punctuation">,</span> ac_map_node_t <span class="token operator">*</span><span class="token operator">*</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_map_insert_arg_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> datatype <span class="token operator">*</span>node_to_insert<span class="token punctuation">,</span>
                       <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">,</span>
                       <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span>datatype <span class="token operator">*</span>node_to_insert<span class="token punctuation">,</span>
                          ac_map_node_t <span class="token operator">*</span><span class="token operator">*</span>root<span class="token punctuation">,</span>
                          <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_map_insert2_arg_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> mapname<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> datatype <span class="token operator">*</span>node_to_insert<span class="token punctuation">,</span>
                       <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">,</span>
                       <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span>datatype <span class="token operator">*</span>node_to_insert<span class="token punctuation">,</span>
                          ac_map_node_t <span class="token operator">*</span><span class="token operator">*</span>root<span class="token punctuation">,</span>
                          <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_multimap_insert_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> datatype <span class="token operator">*</span>node_to_insert<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span>datatype <span class="token operator">*</span>node_to_insert<span class="token punctuation">,</span> ac_map_node_t <span class="token operator">*</span><span class="token operator">*</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_multimap_insert2_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> mapname<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> datatype <span class="token operator">*</span>node_to_insert<span class="token punctuation">,</span> <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span>datatype <span class="token operator">*</span>node_to_insert<span class="token punctuation">,</span> ac_map_node_t <span class="token operator">*</span><span class="token operator">*</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_multimap_insert_arg_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> datatype <span class="token operator">*</span>node_to_insert<span class="token punctuation">,</span>
                       <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">,</span>
                       <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span>datatype <span class="token operator">*</span>node_to_insert<span class="token punctuation">,</span>
                          ac_map_node_t <span class="token operator">*</span><span class="token operator">*</span>root<span class="token punctuation">,</span>
                          <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ac_multimap_insert2_arg_m</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> datatype<span class="token punctuation">,</span> mapname<span class="token punctuation">,</span> compare<span class="token punctuation">)</span>
  expects<span class="token operator">:</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">const</span> datatype <span class="token operator">*</span>node_to_insert<span class="token punctuation">,</span>
                       <span class="token keyword">const</span> datatype <span class="token operator">*</span>value<span class="token punctuation">,</span>
                       <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  returns<span class="token operator">:</span> datatype <span class="token operator">*</span><span class="token function">name</span><span class="token punctuation">(</span>datatype <span class="token operator">*</span>node_to_insert<span class="token punctuation">,</span>
                          ac_map_node_t <span class="token operator">*</span><span class="token operator">*</span>root<span class="token punctuation">,</span>
                          <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div></div></div><div style="font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif;width:400px;height:100vh;padding:15px;color:#1E4E8C;position:sticky;top:62px;border-left:solid 1px #EDF2F7" class="Sidebar"><div><div><a href="/ebook/1-getting-started">1. Getting Started</a></div><div><a href="/ebook/10-binary-search-trees">10. Binary Search Trees</a></div><div><a href="/ebook/11-balancing-binary-search-trees">11. Balancing Binary Search Trees</a></div><div><a href="/ebook/12-red-black-tree">12. The Red-Black Tree</a></div><div><a href="/ebook/13-map">13. The Map Object</a></div><div><a href="/ebook/14-set-and-multimap">14. The Set and Multimap</a></div><div><a href="/ebook/2-timing">2. Timing Your Code</a></div><div><a href="/ebook/3-buffer">3. The Buffer Object</a></div><div><a href="/ebook/4-linked-lists">4. Linked Lists</a></div><div><a href="/ebook/5-threads">5. Introducing Threads</a></div><div><a href="/ebook/6-macros">6. Macros</a></div><div><a href="/ebook/7-allocator">7. The Global Allocator Object</a></div><div><a href="/ebook/8-allocator-implementation">8. The Global Allocator Implementation</a></div><div><a href="/ebook/9-pool">9. The Pool Object</a></div></div></div></div></main><footer style="background-color:#1A202C;padding:10px;color:white;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif"><div class="Footer"><div><h1 style="margin-bottom:5px">Another C Library</h1><p style="margin-bottom:15px">© <!-- -->2019<!-- --> Andy Curtis &amp; Daniel Curtis</p><ul style="list-style:none;margin-left:0"><li><a style="color:#3182CE" href="/contact">Contact</a></li><li><a style="color:#3182CE" href="/contributing">Contributing</a></li><li><a style="color:#3182CE" href="/license">License</a></li></ul></div><div><h2 style="margin:10px auto">A C eBook</h2><ul style="list-style:none;margin-left:0"><li><a href="/ebook/1-getting-started">1. Getting Started</a></li><li><a href="/ebook/10-binary-search-trees">10. Binary Search Trees</a></li><li><a href="/ebook/11-balancing-binary-search-trees">11. Balancing Binary Search Trees</a></li><li><a href="/ebook/12-red-black-tree">12. The Red-Black Tree</a></li><li><a href="/ebook/13-map">13. The Map Object</a></li><li><a href="/ebook/14-set-and-multimap">14. The Set and Multimap</a></li><li><a href="/ebook/2-timing">2. Timing Your Code</a></li><li><a href="/ebook/3-buffer">3. The Buffer Object</a></li><li><a href="/ebook/4-linked-lists">4. Linked Lists</a></li><li><a href="/ebook/5-threads">5. Introducing Threads</a></li><li><a href="/ebook/6-macros">6. Macros</a></li><li><a href="/ebook/7-allocator">7. The Global Allocator Object</a></li><li><a href="/ebook/8-allocator-implementation">8. The Global Allocator Implementation</a></li><li><a href="/ebook/9-pool">9. The Pool Object</a></li></ul></div><div><h2 style="margin:10px auto">Resources</h2><ul style="list-style:none;margin-left:0"><li><a href="https://medium.com/software-design/why-software-developers-should-care-about-cpu-caches-8da04355bb8a" target="_blank" rel="noopener noreferrer" style="color:#3182CE">Why software developers should care about CPU caches <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"></path></svg></a></li><li><a href="https://github.com/contactandyc/another-c-library/blob/master/docs/tips.md#create-multiline-macro-in-c" target="_blank" rel="noopener noreferrer" style="color:#3182CE">Helpful Tips for Formatting <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"></path></svg></a></li><li><a href="https://mitpress.mit.edu/books/introduction-algorithms-third-edition" target="_blank" rel="noopener noreferrer" style="color:#3182CE">Introduction to Alogorithms <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"></path></svg></a></li></ul></div></div></footer></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/ebook/13-map/";window.webpackCompilationHash="8913fc5500708dd393f4";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-95ebc95ba4fb3bc2dd23.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-2089f767561e6aa92a7f.js"],"component---src-templates-ebook-page-js":["/component---src-templates-ebook-page-js-fe8bc0f2c932eda75c4a.js"],"component---src-pages-404-js":["/component---src-pages-404-js-a5fd40ab0bd43785175c.js"],"component---src-pages-contact-js":["/component---src-pages-contact-js-fb76d9a5164a1f2eede1.js"],"component---src-pages-contributing-js":["/component---src-pages-contributing-js-80166a10b44da213f86c.js"],"component---src-pages-docs-js":["/component---src-pages-docs-js-5f1ad25153678f862f92.js"],"component---src-pages-ebook-js":["/component---src-pages-ebook-js-62ae33890356a1602f60.js"],"component---src-pages-index-js":["/component---src-pages-index-js-d1c647469039ae7263dc.js"],"component---src-pages-license-js":["/component---src-pages-license-js-5dac97904724019f2a51.js"]};/*]]>*/</script><script src="/webpack-runtime-3090066330befb922a07.js" async=""></script><script src="/styles-8648ad68e26f3992ff5c.js" async=""></script><script src="/app-95ebc95ba4fb3bc2dd23.js" async=""></script><script src="/commons-0ae7f027867ef630b05a.js" async=""></script><script src="/component---src-templates-ebook-page-js-fe8bc0f2c932eda75c4a.js" async=""></script></body></html>